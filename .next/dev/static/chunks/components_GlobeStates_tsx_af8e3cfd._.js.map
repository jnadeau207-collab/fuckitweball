{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jesse/Documents/cartfax_complete_v2/components/GlobeStates.tsx"],"sourcesContent":["\r\n// components/GlobeStates.tsx\r\nimport React, { useEffect, useRef, useState } from 'react';\r\nimport Globe from 'react-globe.gl';\r\nimport * as topojson from 'topojson-client';\r\nimport * as THREE from 'three';\r\n\r\ntype RegionId = 'unitedStates' | 'canada' | 'mexico' | 'netherlands';\r\n\r\ninterface GlobeStatesProps {\r\n  region: RegionId;\r\n  onStateSelect?: (id: string, name: string) => void;\r\n}\r\n\r\n// Where to aim the camera for each region (future-proofing)\r\nconst regionFocus: Record<\r\n  RegionId,\r\n  { lat: number; lng: number; altitude: number }\r\n> = {\r\n  unitedStates: { lat: 39, lng: -98, altitude: 2.3 },\r\n  canada: { lat: 62, lng: -96, altitude: 2.6 },\r\n  mexico: { lat: 23, lng: -102, altitude: 2.7 },\r\n  netherlands: { lat: 52.3, lng: 5.3, altitude: 4.0 },\r\n};\r\n\r\n// ðŸ”¥ IMPORTANT: update these if you use different filenames\r\nconst earthTextureUrl = '/uploads/earth-metal-atlas.png';\r\nconst earthBumpUrl = '/uploads/earth-metal-atlas-bump.png'; // optional\r\nconst metalTextureUrl = '/uploads/metal-cubes-texture.png';\r\n\r\n// Official US states topojson (tiny, cached, very fast)\r\nconst usStatesUrl =\r\n  'https://unpkg.com/us-atlas@3/states-10m.json';\r\n\r\nconst GlobeStates: React.FC<GlobeStatesProps> = ({ region, onStateSelect }) => {\r\n  const globeRef = useRef<any>(null);\r\n  const [usPolygons, setUsPolygons] = useState<any[]>([]);\r\n  const [hoverPoly, setHoverPoly] = useState<any | null>(null);\r\n  const [materials, setMaterials] = useState<{\r\n    cap: THREE.MeshStandardMaterial;\r\n    side: THREE.MeshStandardMaterial;\r\n  } | null>(null);\r\n\r\n  // 1. Load US state boundaries from official topojson\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        const res = await fetch(usStatesUrl);\r\n        const topo = await res.json();\r\n        const geo = topojson.feature(topo, topo.objects.states) as any;\r\n        setUsPolygons(geo.features);\r\n      } catch (err) {\r\n        console.error('Failed to load US states topojson', err);\r\n      }\r\n    })();\r\n  }, []);\r\n\r\n  // 2. Load your metal cubes texture & turn it into shiny materials\r\n  useEffect(() => {\r\n    const loader = new THREE.TextureLoader();\r\n    loader.load(\r\n      metalTextureUrl,\r\n      (tex) => {\r\n        tex.wrapS = tex.wrapT = THREE.RepeatWrapping;\r\n        tex.anisotropy = 8;\r\n        tex.repeat.set(1.7, 1.7);\r\n\r\n        const cap = new THREE.MeshStandardMaterial({\r\n          map: tex,\r\n          metalness: 1,\r\n          roughness: 0.18,\r\n        });\r\n\r\n        const side = new THREE.MeshStandardMaterial({\r\n          map: tex,\r\n          metalness: 0.9,\r\n          roughness: 0.25,\r\n        });\r\n\r\n        setMaterials({ cap, side });\r\n      },\r\n      undefined,\r\n      (err) => {\r\n        console.error('Failed to load metal texture', err);\r\n      }\r\n    );\r\n  }, []);\r\n\r\n  // 3. Configure controls & camera whenever region/data changes\r\n  useEffect(() => {\r\n    if (!globeRef.current) return;\r\n\r\n    const controls = globeRef.current.controls();\r\n    controls.autoRotate = true;\r\n    controls.autoRotateSpeed = 0.25;\r\n    controls.enableDamping = true;\r\n    controls.dampingFactor = 0.05;\r\n    controls.enableZoom = true;\r\n    controls.minDistance = 200;\r\n    controls.maxDistance = 800;\r\n\r\n    const focus = regionFocus[region];\r\n    globeRef.current.pointOfView(\r\n      {\r\n        lat: focus.lat,\r\n        lng: focus.lng,\r\n        altitude: focus.altitude,\r\n      },\r\n      1000 // ms animation\r\n    );\r\n  }, [region, usPolygons]);\r\n\r\n  const polygonsData = region === 'unitedStates' ? usPolygons : [];\r\n\r\n  return (\r\n    <Globe\r\n      ref={globeRef}\r\n      // we let the parent container handle layout; these just give a base size\r\n      width={960}\r\n      height={540}\r\n      backgroundColor=\"rgba(0,0,0,0)\"\r\n      globeImageUrl={earthTextureUrl}\r\n      bumpImageUrl={earthBumpUrl}\r\n      showAtmosphere={true}\r\n      atmosphereColor=\"#8fd5ff\"\r\n      atmosphereAltitude={0.32}\r\n      onGlobeReady={() => {\r\n        // Custom lights to make it feel like chrome + blue rim light\r\n        if (!globeRef.current) return;\r\n        const scene: THREE.Scene = globeRef.current.scene();\r\n\r\n        const existing = scene.getObjectByName('cartfaxLights');\r\n        if (existing) scene.remove(existing);\r\n\r\n        const group = new THREE.Group();\r\n        group.name = 'cartfaxLights';\r\n\r\n        const key = new THREE.DirectionalLight('#ffffff', 1.25);\r\n        key.position.set(2.5, 1.8, 3);\r\n        group.add(key);\r\n\r\n        const rim = new THREE.DirectionalLight('#5ecbff', 0.9);\r\n        rim.position.set(-2.2, -1.7, -2.4);\r\n        group.add(rim);\r\n\r\n        const fill = new THREE.AmbientLight('#ffffff', 0.65);\r\n        group.add(fill);\r\n\r\n        scene.add(group);\r\n      }}\r\n      // POLYGON LAYER â€“ US states extruding from globe\r\n      polygonsData={polygonsData}\r\n      polygonGeoJsonGeometry={(d: any) => d.geometry}\r\n      polygonLabel={(d: any) => d.properties?.name || ''}\r\n      polygonAltitude={(d: any) =>\r\n        hoverPoly && hoverPoly === d ? 0.17 : 0.10\r\n      }\r\n      polygonCapMaterial={materials?.cap}\r\n      polygonSideMaterial={materials?.side}\r\n      polygonStrokeColor={() => '#43c5ff'}\r\n      polygonCapCurvatureResolution={2}\r\n      polygonsTransitionDuration={260}\r\n      onPolygonHover={(poly: any) => setHoverPoly(poly)}\r\n      onPolygonClick={(poly: any) => {\r\n        if (onStateSelect) {\r\n          const id = poly.id ?? poly.properties?.postal;\r\n          const name = poly.properties?.name ?? '';\r\n          onStateSelect(id, name);\r\n        }\r\n      }}\r\n    />\r\n  );\r\n};\r\n\r\nexport default GlobeStates;\r\n"],"names":[],"mappings":"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"}}]
}