{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jesse/Documents/cartfax_complete_v2/components/GlobeStates.tsx"],"sourcesContent":["// components/GlobeStates.tsx\nimport React, {\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport Globe from 'react-globe.gl';\nimport * as topojson from 'topojson-client';\nimport * as THREE from 'three';\n\nexport type RegionId = 'unitedStates' | 'canada' | 'mexico' | 'netherlands';\n\ninterface GlobeStatesProps {\n  region: RegionId;\n  onStateSelect?: (\n    id: string | number | null,\n    name: string,\n    coords?: { x: number; y: number }\n  ) => void;\n  onViewChange?: (altitude: number) => void;\n  onRegionChange?: (region: RegionId) => void;\n}\n\n// Camera focus for each region\nconst regionFocus: Record<RegionId, { lat: number; lng: number; altitude: number }> = {\n  unitedStates: { lat: 39, lng: -98, altitude: 1.9 },\n  canada: { lat: 62, lng: -96, altitude: 2.1 },\n  mexico: { lat: 23, lng: -102, altitude: 2.1 },\n  netherlands: { lat: 52.3, lng: 5.3, altitude: 3.0 },\n};\n\nconst usStatesUrl = 'https://unpkg.com/us-atlas@3/states-10m.json';\n\n// local GeoJSONs you saved earlier\nconst caProvincesUrl = '/data/ca-provinces.json';\nconst mxStatesUrl = '/data/mx-states.json';\nconst nlProvincesUrl = '/data/nl-provinces.json';\n\nconst BASE_ALT = 0.02;\nconst EXTRA_SELECTED = 0.012;\nconst EXTRA_HOVER = 0.006;\n\nconst GlobeStates: React.FC<GlobeStatesProps> = ({\n  region,\n  onStateSelect,\n  onViewChange,\n  onRegionChange,\n}) => {\n  const globeRef = useRef<any>(null);\n\n  const [usPolygons, setUsPolygons] = useState<any[]>([]);\n  const [caPolygons, setCaPolygons] = useState<any[]>([]);\n  const [mxPolygons, setMxPolygons] = useState<any[]>([]);\n  const [nlPolygons, setNlPolygons] = useState<any[]>([]);\n\n  const [hoverPoly, setHoverPoly] = useState<any | null>(null);\n  const [selectedId, setSelectedId] = useState<string | null>(null);\n\n  // ---------- helpers ----------\n\n  const getSubregionId = (poly: any): string => {\n    const props = poly?.properties ?? {};\n    if (props.postal) return String(props.postal).toUpperCase();\n    if (props.id) return String(props.id);\n    if (poly.id) return String(poly.id);\n    return '';\n  };\n\n  const getSubregionName = (poly: any): string => {\n    const props = poly?.properties ?? {};\n    return (\n      props.name ||\n      props.NAME_1 ||\n      props.province ||\n      props.state ||\n      String(poly.id ?? '') ||\n      ''\n    );\n  };\n\n  // ---------- load geo data ----------\n\n  // US states from us-atlas\n  useEffect(() => {\n    (async () => {\n      try {\n        const res = await fetch(usStatesUrl);\n        const topo = await res.json();\n        const geo = topojson.feature(topo, topo.objects.states) as any;\n\n        const states = geo.features.map((f: any) => ({\n          ...f,\n          properties: {\n            ...f.properties,\n            // ensure postal code is present\n            postal: f.properties?.postal || f.id,\n          },\n        }));\n\n        setUsPolygons(states);\n      } catch (err) {\n        console.error('Error loading US states topojson', err);\n      }\n    })();\n  }, []);\n\n  // Canada provinces\n  useEffect(() => {\n    (async () => {\n      try {\n        const res = await fetch(caProvincesUrl);\n        const geo = await res.json();\n        const features = geo.features ?? geo;\n        setCaPolygons(features);\n      } catch (err) {\n        console.error('Error loading Canada provinces GeoJSON', err);\n      }\n    })();\n  }, []);\n\n  // Mexico states\n  useEffect(() => {\n    (async () => {\n      try {\n        const res = await fetch(mxStatesUrl);\n        const geo = await res.json();\n        const features = geo.features ?? geo;\n        setMxPolygons(features);\n      } catch (err) {\n        console.error('Error loading Mexico states GeoJSON', err);\n      }\n    })();\n  }, []);\n\n  // Netherlands provinces\n  useEffect(() => {\n    (async () => {\n      try {\n        const res = await fetch(nlProvincesUrl);\n        const geo = await res.json();\n        const features = geo.features ?? geo;\n        setNlPolygons(features);\n      } catch (err) {\n        console.error('Error loading Netherlands provinces GeoJSON', err);\n      }\n    })();\n  }, []);\n\n  // ---------- camera + controls ----------\n\n  // Set up controls once\n  useEffect(() => {\n    const globe = globeRef.current;\n    if (!globe) return;\n\n    const controls = globe.controls();\n    if (!controls) return;\n\n    controls.enableDamping = true;\n    controls.dampingFactor = 0.15;\n    controls.enablePan = true;\n    controls.enableZoom = true;\n    controls.minDistance = 180;\n    controls.maxDistance = 650;\n\n    // initial view\n    const focus = regionFocus[region];\n    globe.pointOfView(\n      { lat: focus.lat, lng: focus.lng, altitude: focus.altitude },\n      0\n    );\n  }, []); // run once on mount\n\n  // Re-focus when region changes\n  useEffect(() => {\n    const globe = globeRef.current;\n    if (!globe) return;\n\n    const focus = regionFocus[region];\n    globe.pointOfView(\n      { lat: focus.lat, lng: focus.lng, altitude: focus.altitude },\n      900\n    );\n\n    // clear selection on region change\n    setSelectedId(null);\n    setHoverPoly(null);\n  }, [region]);\n\n  // Report altitude back up when camera moves\n  useEffect(() => {\n    if (!globeRef.current || !onViewChange) return;\n\n    const globe = globeRef.current;\n    const controls = globe.controls();\n    if (!controls) return;\n\n    const handleChange = () => {\n      const { altitude } = globe.pointOfView();\n      onViewChange(altitude);\n    };\n\n    controls.addEventListener('change', handleChange);\n    return () => {\n      controls.removeEventListener('change', handleChange);\n    };\n  }, [onViewChange]);\n\n  // ---------- active polygons ----------\n\n  const activePolygons = useMemo(() => {\n    switch (region) {\n      case 'unitedStates':\n        return usPolygons;\n      case 'canada':\n        return caPolygons;\n      case 'mexico':\n        return mxPolygons;\n      case 'netherlands':\n        return nlPolygons;\n      default:\n        return [];\n    }\n  }, [region, usPolygons, caPolygons, mxPolygons, nlPolygons]);\n\n  const polygonAltitude = (poly: any) => {\n    const id = getSubregionId(poly);\n    const isSelected = selectedId && id === selectedId;\n    const isHovered = hoverPoly === poly;\n\n    let alt = BASE_ALT;\n    if (isSelected) alt += EXTRA_SELECTED;\n    if (isHovered) alt += EXTRA_HOVER;\n\n    return alt;\n  };\n\n  const polygonCapColor = (poly: any) => {\n    const id = getSubregionId(poly);\n    const isSelected = selectedId && id === selectedId;\n    const isHovered = hoverPoly === poly;\n\n    if (isSelected) return '#22c55e'; // bright green\n    if (isHovered) return '#4ade80'; // lighter on hover\n    return '#020617'; // dark slate\n  };\n\n  // ---------- render ----------\n\n  return (\n    <div className=\"h-full w-full\">\n      <Globe\n        ref={globeRef}\n        animateIn\n        backgroundColor=\"rgba(0,0,0,1)\"\n        showAtmosphere={false}\n        globeImageUrl=\"/textures/earth-night-2016.jpg\"\n        // keep resolution low enough to be fast; texture does the heavy lifting\n        polygonsData={activePolygons}\n        polygonAltitude={polygonAltitude}\n        polygonCapColor={polygonCapColor}\n        polygonSideColor={() => 'rgba(34,197,94,0.85)'}\n        polygonStrokeColor={() => 'rgba(34,197,94,0.65)'}\n        polygonLabel={poly => getSubregionName(poly)}\n        polygonsTransitionDuration={260}\n        onPolygonHover={poly => {\n          setHoverPoly(poly || null);\n        }}\n        onPolygonClick={(poly, event) => {\n          if (!poly) return;\n\n          const id = getSubregionId(poly);\n          const name = getSubregionName(poly);\n\n          setSelectedId(id || null);\n\n          const clickCoords =\n            event && typeof (event as any).clientX === 'number'\n              ? {\n                  x: (event as any).clientX as number,\n                  y: (event as any).clientY as number,\n                }\n              : undefined;\n\n          if (onStateSelect) {\n            onStateSelect(id || null, name, clickCoords);\n          }\n\n          // Optional: when clicking a region border polygon that\n          // *represents* the whole region, you could trigger onRegionChange.\n          // Here we assume tabs handle region changes, so we don't.\n        }}\n      />\n    </div>\n  );\n};\n\nexport default GlobeStates;\n"],"names":[],"mappings":"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"}}]
}