{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jesse/Documents/cartfax_complete_v2/components/GlobeStates.tsx"],"sourcesContent":["// components/GlobeStates.tsx\n\n// Replaces the broken file-loading logic with direct use of the embedded TopoJSON object.\n\nimport React, { useCallback, useEffect, useMemo, useState } from \"react\";\nimport * as THREE from \"three\";\nimport { feature } from \"topojson-client\";\nimport dynamic from \"next/dynamic\";\nimport {\n  EMBEDDED_TOPOJSON_DATA, // <-- Import the embedded data\n  JURISDICTIONS,\n  getCountryRegion,\n} from \"../lib/jurisdictions\";\nimport { useGlobeStore } from \"../lib/store\";\n\n// Use dynamic import for the Globe component as it requires the window object\nconst Globe = dynamic(() => import(\"react-globe.gl\"), { ssr: false });\n\n// --- Globe Data Processing ---\nconst allPolygons = EMBEDDED_TOPOJSON_DATA.objects?.states_provinces?.geometries || [];\n\nconst isState = (poly: any) => poly.properties.name !== \"land\";\nconst getStatePostal = (poly: any) => poly.properties.adm1_code;\nconst isCountry = (poly: any) => !!poly.properties.adm0_a3; // Simple check\n\n// Function to convert TopoJSON to GeoJSON features for consumption by react-globe.gl\nconst getFeatures = (topojson: any, layerName: string) => {\n  if (!topojson || !topojson.objects || !topojson.objects[layerName]) {\n    console.error(\"Invalid TopoJSON object or layer name.\");\n    return { features: [] };\n  }\n  return feature(topojson, topojson.objects[layerName]);\n};\n\n// --- Main Component ---\nconst GlobeStates = ({ region }: { region: string }) => {\n  const { selectedStateId, setSelectedStateId } = useGlobeStore();\n  const [hoverPoly, setHoverPoly] = useState(null);\n  const globeMaterial = useMemo(\n    () =>\n      new THREE.MeshPhongMaterial({\n        color: new THREE.Color(\"#020617\"), // Dark background\n        side: THREE.DoubleSide,\n        shininess: 0.1,\n      }),\n    []\n  );\n\n  const filteredPolygons = useMemo(() => {\n    if (region === \"ALL\") return allPolygons;\n\n    const countryCodes = JURISDICTIONS.filter((j) => j.region === region).map((j) => j.code);\n    return allPolygons.filter((poly: any) => countryCodes.includes(poly.properties.adm0_a3));\n  }, [region]);\n\n  const polygonAltitude = useCallback(\n    (poly: any) => {\n      if (!isState(poly)) return 0.001;\n\n      const id = getStatePostal(poly);\n      const isSelected = id && selectedStateId && id === selectedStateId;\n      const isHovered = hoverPoly === poly;\n\n      // Restored explosion effect: Lift polygons on hover/select\n      if (isSelected) return 0.04;\n      if (isHovered) return 0.02;\n\n      // Country explode/rise effect for regions like Canada (CAN)\n      const reg = getCountryRegion(poly);\n      const isActiveCountry = reg && reg === region;\n      if (isActiveCountry && region !== 'ALL') return 0.006;\n\n      return 0.001;\n    },\n    [hoverPoly, selectedStateId, region]\n  );\n\n  const polygonCapMaterial = useCallback(\n    (poly: any) => {\n      // Base material for non-interactive areas (e.g., non-Admin 1 land)\n      if (!isCountry(poly) || !isState(poly)) {\n        return new THREE.MeshStandardMaterial({\n          color: new THREE.Color(\"#0f172a\"),\n          transparent: true,\n          opacity: 0.8,\n        });\n      }\n\n      const id = getStatePostal(poly);\n      const isSelected = id && selectedStateId && id === selectedStateId;\n      const isHovered = hoverPoly === poly;\n\n      // Color logic based on region (tailwind-inspired colors)\n      const countryCode = poly.properties.adm0_a3;\n      let baseColor = \"#0f172a\"; // Slate-900\n      let highlightColor = \"#22c55e\"; // Emerald-500\n\n      if (countryCode === \"CAN\" || countryCode === \"USA\") {\n        highlightColor = \"#3b82f6\"; // Blue-500\n      } else if (countryCode === \"MEX\") {\n        highlightColor = \"#ef4444\"; // Red-500\n      } else if (countryCode === \"NLD\") {\n        highlightColor = \"#f59e0b\"; // Amber-500\n      }\n\n      const emissiveBase = new THREE.Color(baseColor);\n      const emissiveHighlight = new THREE.Color(highlightColor);\n\n      return new THREE.MeshStandardMaterial({\n        metalness: 0.96,\n        roughness: 0.26,\n        color: new THREE.Color(baseColor),\n        emissive: isHovered || isSelected ? emissiveHighlight : emissiveBase,\n        emissiveIntensity: isHovered ? 0.4 : isSelected ? 0.25 : 0.16,\n      });\n    },\n    [hoverPoly, selectedStateId, region]\n  );\n\n  const handlePolygonClick = useCallback(\n    (poly: any) => {\n      if (!isState(poly)) return;\n\n      const id = getStatePostal(poly);\n      setSelectedStateId(id === selectedStateId ? null : id);\n    },\n    [selectedStateId, setSelectedStateId]\n  );\n\n  return (\n    <Globe\n      animateIn\n      showAtmosphere={false}\n      globeMaterial={globeMaterial}\n      hexPolygonResolution={3}\n      hexPolygonMargin={0.4}\n      polygonsData={filteredPolygons}\n      polygonAltitude={polygonAltitude}\n      polygonCapMaterial={polygonCapMaterial}\n      polygonSideMaterial={() =>\n        new THREE.MeshPhongMaterial({\n          color: new THREE.Color(\"#020617\"),\n          side: THREE.DoubleSide,\n        })\n      }\n      onPolygonClick={handlePolygonClick}\n      onPolygonHover={setHoverPoly}\n      onGlobeClick={() => setSelectedStateId(null)}\n      backgroundColor=\"rgba(0,0,0,0)\" // Transparent background\n    />\n  );\n};\n\nexport default GlobeStates;"],"names":[],"mappings":"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"}}]
}