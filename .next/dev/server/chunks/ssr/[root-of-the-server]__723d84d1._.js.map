{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jesse/Documents/cartfax_complete_v2/pages/admin/uploads/%5Bid%5D.tsx"],"sourcesContent":["import { useRouter } from 'next/router';\r\nimport { useSession } from 'next-auth/react';\r\nimport { useEffect, useState } from 'react';\r\n\r\ntype LabResult = {\r\n  id: number;\r\n  batchId?: number | null;\r\n  thcPercent?: number | null;\r\n  cbdPercent?: number | null;\r\n  totalCannabinoidsPercent?: number | null;\r\n  passed?: boolean | null;\r\n  createdAt: string;\r\n};\r\n\r\ntype UploadedDocumentDetail = {\r\n  id: number;\r\n  fileName: string;\r\n  mimeType: string;\r\n  size: number;\r\n  sha256: string;\r\n  batchCode?: string | null;\r\n  labName?: string | null;\r\n  createdAt: string;\r\n  verified: boolean;\r\n  extractedText?: string | null;\r\n  filePath?: string | null;\r\n  labResult?: LabResult | null;\r\n};\r\n\r\nexport default function AdminUploadFullDebug() {\r\n  const router = useRouter();\r\n  const { id } = router.query;\r\n  const { data: session } = useSession();\r\n\r\n  const [doc, setDoc] = useState<UploadedDocumentDetail | null>(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!id || !session) return;\r\n    const idStr = Array.isArray(id) ? id[0] : id;\r\n    void fetchDoc(idStr);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [id, session]);\r\n\r\n  async function fetchDoc(idStr: string) {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n      const res = await fetch(`/api/admin/uploads/${idStr}`);\r\n      if (!res.ok) {\r\n        const txt = await res.text();\r\n        throw new Error(txt || 'Failed to load document');\r\n      }\r\n      const data = await res.json();\r\n      setDoc(data);\r\n    } catch (e: any) {\r\n      console.error('Failed to load upload detail', e);\r\n      setError(e.message || 'Failed to load document');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  if (!session) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <p className=\"text-sm text-slate-300\">\r\n          Sign in as an admin to view COA debug details.\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (loading && !doc) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <p className=\"text-sm text-slate-300\">Loading COA…</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error && !doc) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <p className=\"text-sm text-red-400\">Error: {error}</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!doc) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <button\r\n          onClick={() => router.push('/admin/uploads')}\r\n          className=\"text-xs text-slate-400 hover:text-emerald-400 mb-2\"\r\n        >\r\n          ← Back to COA uploads\r\n        </button>\r\n        <p className=\"text-sm text-slate-300\">Document not found.</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const sizeKb = (doc.size / 1024).toFixed(1);\r\n\r\n  return (\r\n    <div className=\"p-6 max-w-6xl mx-auto space-y-4\">\r\n      {/* Top bar / breadcrumb */}\r\n      <div className=\"flex items-center justify-between gap-3\">\r\n        <div>\r\n          <button\r\n            onClick={() => router.push('/admin/uploads')}\r\n            className=\"text-xs text-slate-400 hover:text-emerald-400 mb-1\"\r\n          >\r\n            ← Back to COA uploads\r\n          </button>\r\n          <h1 className=\"text-2xl font-semibold text-slate-100\">\r\n            COA #{doc.id}\r\n          </h1>\r\n          <p className=\"text-sm text-slate-400\">\r\n            {doc.fileName}{' '}\r\n            <span className=\"text-slate-600\">\r\n              ({sizeKb} KB · {doc.mimeType})\r\n            </span>\r\n          </p>\r\n        </div>\r\n        <div className=\"flex flex-col items-end gap-1\">\r\n          <span className=\"text-[11px] text-slate-500 font-mono break-all\">\r\n            SHA256: {doc.sha256}\r\n          </span>\r\n          <span\r\n            className={`px-2 py-1 rounded-full text-[11px] border ${\r\n              doc.verified\r\n                ? 'border-emerald-500 text-emerald-300'\r\n                : 'border-slate-600 text-slate-300'\r\n            }`}\r\n          >\r\n            {doc.verified ? 'Verified' : 'Unverified'}\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Main grid: left metadata, right raw text */}\r\n      <div className=\"grid gap-4 md:grid-cols-[minmax(0,1.1fr)_minmax(0,1.7fr)]\">\r\n        {/* Metadata / parsed view */}\r\n        <div className=\"space-y-4\">\r\n          <div className=\"rounded-xl border border-slate-800 bg-slate-900/70 p-4 text-sm\">\r\n            <h2 className=\"text-sm font-semibold text-slate-200 mb-2\">\r\n              Parsed metadata\r\n            </h2>\r\n            <div className=\"grid gap-2 text-xs\">\r\n              <div>\r\n                <div className=\"text-slate-400\">Batch code</div>\r\n                <div className=\"text-slate-100\">\r\n                  {doc.batchCode || <span className=\"text-slate-500\">Not detected</span>}\r\n                </div>\r\n              </div>\r\n              <div>\r\n                <div className=\"text-slate-400\">Lab name</div>\r\n                <div className=\"text-slate-100\">\r\n                  {doc.labName || <span className=\"text-slate-500\">Not detected</span>}\r\n                </div>\r\n              </div>\r\n              <div>\r\n                <div className=\"text-slate-400\">Uploaded</div>\r\n                <div className=\"text-slate-100\">\r\n                  {new Date(doc.createdAt).toLocaleString()}\r\n                </div>\r\n              </div>\r\n              <div>\r\n                <div className=\"text-slate-400\">File path (backend)</div>\r\n                <div className=\"text-[11px] text-slate-500 break-all\">\r\n                  {doc.filePath || 'Not stored on disk (in-memory upload)'}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* LabResult summary if present */}\r\n          <div className=\"rounded-xl border border-slate-800 bg-slate-900/70 p-4 text-sm\">\r\n            <h2 className=\"text-sm font-semibold text-slate-200 mb-2\">\r\n              Linked lab result\r\n            </h2>\r\n            {!doc.labResult ? (\r\n              <div className=\"text-xs text-slate-500\">\r\n                No LabResult record linked to this COA yet.\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-2 text-xs\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"text-slate-200\">\r\n                    LabResult #{doc.labResult.id}\r\n                  </div>\r\n                  <div className=\"text-slate-500\">\r\n                    {new Date(doc.labResult.createdAt).toLocaleString()}\r\n                  </div>\r\n                </div>\r\n                <div className=\"grid gap-2 grid-cols-2\">\r\n                  <div>\r\n                    <div className=\"text-slate-400\">THC %</div>\r\n                    <div className=\"text-slate-100\">\r\n                      {doc.labResult.thcPercent != null\r\n                        ? `${doc.labResult.thcPercent.toFixed(2)}%`\r\n                        : '—'}\r\n                    </div>\r\n                  </div>\r\n                  <div>\r\n                    <div className=\"text-slate-400\">CBD %</div>\r\n                    <div className=\"text-slate-100\">\r\n                      {doc.labResult.cbdPercent != null\r\n                        ? `${doc.labResult.cbdPercent.toFixed(2)}%`\r\n                        : '—'}\r\n                    </div>\r\n                  </div>\r\n                  <div>\r\n                    <div className=\"text-slate-400\">Total cannabinoids %</div>\r\n                    <div className=\"text-slate-100\">\r\n                      {doc.labResult.totalCannabinoidsPercent != null\r\n                        ? `${doc.labResult.totalCannabinoidsPercent.toFixed(2)}%`\r\n                        : '—'}\r\n                    </div>\r\n                  </div>\r\n                  <div>\r\n                    <div className=\"text-slate-400\">Overall result</div>\r\n                    <div className=\"text-slate-100\">\r\n                      {doc.labResult.passed == null\r\n                        ? 'Unknown'\r\n                        : doc.labResult.passed\r\n                        ? 'Pass'\r\n                        : 'Fail'}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <div className=\"text-[11px] text-slate-500\">\r\n                  Batch link:{' '}\r\n                  {doc.labResult.batchId\r\n                    ? `Batch #${doc.labResult.batchId}`\r\n                    : 'not linked'}\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Raw extracted text */}\r\n        <div className=\"rounded-xl border border-slate-800 bg-slate-900/70 p-4 flex flex-col\">\r\n          <div className=\"flex items-center justify-between mb-2\">\r\n            <h2 className=\"text-sm font-semibold text-slate-200\">\r\n              Raw extracted text\r\n            </h2>\r\n            <span className=\"text-[11px] text-slate-500\">\r\n              Use this to refine per-lab parsing rules.\r\n            </span>\r\n          </div>\r\n          <div className=\"flex-1 rounded-md border border-slate-800 bg-slate-950 text-[11px] text-slate-200 p-3 overflow-auto whitespace-pre-wrap\">\r\n            {doc.extractedText\r\n              ? doc.extractedText\r\n              : 'No extracted text stored for this COA.'}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}