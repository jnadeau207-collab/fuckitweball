{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jesse/Documents/cartfax_complete_v2/pages/admin/uploads/%5Bid%5D.tsx"],"sourcesContent":["import { useRouter } from 'next/router';\nimport { useSession } from 'next-auth/react';\nimport { useEffect, useState } from 'react';\n\ntype LabResult = {\n  id: number;\n  batchId?: number | null;\n  thcPercent?: number | null;\n  cbdPercent?: number | null;\n  totalCannabinoidsPercent?: number | null;\n  passed?: boolean | null;\n  createdAt: string;\n};\n\ntype UploadedDocumentDetail = {\n  id: number;\n  fileName: string;\n  mimeType: string;\n  size: number;\n  sha256: string;\n  batchCode?: string | null;\n  labName?: string | null;\n  createdAt: string;\n  verified: boolean;\n  extractedText?: string | null;\n  filePath?: string | null;\n  labResult?: LabResult | null;\n};\n\nexport default function AdminUploadFullDebug() {\n  const router = useRouter();\n  const { id } = router.query;\n  const { data: session } = useSession();\n\n  const [doc, setDoc] = useState<UploadedDocumentDetail | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (!id || !session) return;\n    const idStr = Array.isArray(id) ? id[0] : id;\n    void fetchDoc(idStr);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [id, session]);\n\n  async function fetchDoc(idStr: string) {\n    try {\n      setLoading(true);\n      setError(null);\n      const res = await fetch(`/api/admin/uploads/${idStr}`);\n      if (!res.ok) {\n        const txt = await res.text();\n        throw new Error(txt || 'Failed to load document');\n      }\n      const data = await res.json();\n      setDoc(data);\n    } catch (e: any) {\n      console.error('Failed to load upload detail', e);\n      setError(e.message || 'Failed to load document');\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  if (!session) {\n    return (\n      <div className=\"p-6\">\n        <p className=\"text-sm text-slate-300\">\n          Sign in as an admin to view COA debug details.\n        </p>\n      </div>\n    );\n  }\n\n  if (loading && !doc) {\n    return (\n      <div className=\"p-6\">\n        <p className=\"text-sm text-slate-300\">Loading COA…</p>\n      </div>\n    );\n  }\n\n  if (error && !doc) {\n    return (\n      <div className=\"p-6\">\n        <p className=\"text-sm text-red-400\">Error: {error}</p>\n      </div>\n    );\n  }\n\n  if (!doc) {\n    return (\n      <div className=\"p-6\">\n        <button\n          onClick={() => router.push('/admin/uploads')}\n          className=\"text-xs text-slate-400 hover:text-emerald-400 mb-2\"\n        >\n          ← Back to COA uploads\n        </button>\n        <p className=\"text-sm text-slate-300\">Document not found.</p>\n      </div>\n    );\n  }\n\n  const sizeKb = (doc.size / 1024).toFixed(1);\n\n  return (\n    <div className=\"p-6 max-w-6xl mx-auto space-y-4\">\n      {/* Top bar / breadcrumb */}\n      <div className=\"flex items-center justify-between gap-3\">\n        <div>\n          <button\n            onClick={() => router.push('/admin/uploads')}\n            className=\"text-xs text-slate-400 hover:text-emerald-400 mb-1\"\n          >\n            ← Back to COA uploads\n          </button>\n          <h1 className=\"text-2xl font-semibold text-slate-100\">\n            COA #{doc.id}\n          </h1>\n          <p className=\"text-sm text-slate-400\">\n            {doc.fileName}{' '}\n            <span className=\"text-slate-600\">\n              ({sizeKb} KB · {doc.mimeType})\n            </span>\n          </p>\n        </div>\n        <div className=\"flex flex-col items-end gap-1\">\n          <span className=\"text-[11px] text-slate-500 font-mono break-all\">\n            SHA256: {doc.sha256}\n          </span>\n          <span\n            className={`px-2 py-1 rounded-full text-[11px] border ${\n              doc.verified\n                ? 'border-emerald-500 text-emerald-300'\n                : 'border-slate-600 text-slate-300'\n            }`}\n          >\n            {doc.verified ? 'Verified' : 'Unverified'}\n          </span>\n        </div>\n      </div>\n\n      {/* Main grid: left metadata, right raw text */}\n      <div className=\"grid gap-4 md:grid-cols-[minmax(0,1.1fr)_minmax(0,1.7fr)]\">\n        {/* Metadata / parsed view */}\n        <div className=\"space-y-4\">\n          <div className=\"rounded-xl border border-slate-800 bg-slate-900/70 p-4 text-sm\">\n            <h2 className=\"text-sm font-semibold text-slate-200 mb-2\">\n              Parsed metadata\n            </h2>\n            <div className=\"grid gap-2 text-xs\">\n              <div>\n                <div className=\"text-slate-400\">Batch code</div>\n                <div className=\"text-slate-100\">\n                  {doc.batchCode || (\n                    <span className=\"text-slate-500\">Not detected</span>\n                  )}\n                </div>\n              </div>\n              <div>\n                <div className=\"text-slate-400\">Lab name</div>\n                <div className=\"text-slate-100\">\n                  {doc.labName || (\n                    <span className=\"text-slate-500\">Not detected</span>\n                  )}\n                </div>\n              </div>\n              <div>\n                <div className=\"text-slate-400\">Uploaded</div>\n                <div className=\"text-slate-100\">\n                  {new Date(doc.createdAt).toLocaleString()}\n                </div>\n              </div>\n              <div>\n                <div className=\"text-slate-400\">File path (backend)</div>\n                <div className=\"text-[11px] text-slate-500 break-all\">\n                  {doc.filePath || 'Not stored on disk (in-memory upload)'}\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* LabResult summary if present */}\n          <div className=\"rounded-xl border border-slate-800 bg-slate-900/70 p-4 text-sm\">\n            <h2 className=\"text-sm font-semibold text-slate-200 mb-2\">\n              Linked lab result\n            </h2>\n            {!doc.labResult ? (\n              <div className=\"text-xs text-slate-500\">\n                No LabResult record linked to this COA yet.\n              </div>\n            ) : (\n              <div className=\"space-y-2 text-xs\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"text-slate-200\">\n                    LabResult #{doc.labResult.id}\n                  </div>\n                  <div className=\"text-slate-500\">\n                    {new Date(doc.labResult.createdAt).toLocaleString()}\n                  </div>\n                </div>\n                <div className=\"grid gap-2 grid-cols-2\">\n                  <div>\n                    <div className=\"text-slate-400\">THC %</div>\n                    <div className=\"text-slate-100\">\n                      {doc.labResult.thcPercent != null\n                        ? `${doc.labResult.thcPercent.toFixed(2)}%`\n                        : '—'}\n                    </div>\n                  </div>\n                  <div>\n                    <div className=\"text-slate-400\">CBD %</div>\n                    <div className=\"text-slate-100\">\n                      {doc.labResult.cbdPercent != null\n                        ? `${doc.labResult.cbdPercent.toFixed(2)}%`\n                        : '—'}\n                    </div>\n                  </div>\n                  <div>\n                    <div className=\"text-slate-400\">Total cannabinoids %</div>\n                    <div className=\"text-slate-100\">\n                      {doc.labResult.totalCannabinoidsPercent != null\n                        ? `${doc.labResult.totalCannabinoidsPercent.toFixed(2)}%`\n                        : '—'}\n                    </div>\n                  </div>\n                  <div>\n                    <div className=\"text-slate-400\">Overall result</div>\n                    <div className=\"text-slate-100\">\n                      {doc.labResult.passed == null\n                        ? 'Unknown'\n                        : doc.labResult.passed\n                          ? 'Pass'\n                          : 'Fail'}\n                    </div>\n                  </div>\n                </div>\n                <div className=\"text-[11px] text-slate-500\">\n                  Batch link:{' '}\n                  {doc.labResult.batchId\n                    ? `Batch #${doc.labResult.batchId}`\n                    : 'not linked'}\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Raw extracted text */}\n        <div className=\"rounded-xl border border-slate-800 bg-slate-900/70 p-4 flex flex-col\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <h2 className=\"text-sm font-semibold text-slate-200\">\n              Raw extracted text\n            </h2>\n            <span className=\"text-[11px] text-slate-500\">\n              Use this to refine per-lab parsing rules.\n            </span>\n          </div>\n          <div className=\"flex-1 rounded-md border border-slate-800 bg-slate-950 text-[11px] text-slate-200 p-3 overflow-auto whitespace-pre-wrap\">\n            {doc.extractedText\n              ? doc.extractedText\n              : 'No extracted text stored for this COA.'}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;;;;;AA2Be,SAAS;IACtB,MAAM,SAAS,IAAA,oIAAS;IACxB,MAAM,EAAE,EAAE,EAAE,GAAG,OAAO,KAAK;IAC3B,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,IAAA,iJAAU;IAEpC,MAAM,CAAC,KAAK,OAAO,GAAG,IAAA,+GAAQ,EAAgC;IAC9D,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,+GAAQ,EAAC;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,+GAAQ,EAAgB;IAElD,IAAA,gHAAS,EAAC;QACR,IAAI,CAAC,MAAM,CAAC,SAAS;QACrB,MAAM,QAAQ,MAAM,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,GAAG;QAC1C,KAAK,SAAS;IACd,uDAAuD;IACzD,GAAG;QAAC;QAAI;KAAQ;IAEhB,eAAe,SAAS,KAAa;QACnC,IAAI;YACF,WAAW;YACX,SAAS;YACT,MAAM,MAAM,MAAM,MAAM,CAAC,mBAAmB,EAAE,OAAO;YACrD,IAAI,CAAC,IAAI,EAAE,EAAE;gBACX,MAAM,MAAM,MAAM,IAAI,IAAI;gBAC1B,MAAM,IAAI,MAAM,OAAO;YACzB;YACA,MAAM,OAAO,MAAM,IAAI,IAAI;YAC3B,OAAO;QACT,EAAE,OAAO,GAAQ;YACf,QAAQ,KAAK,CAAC,gCAAgC;YAC9C,SAAS,EAAE,OAAO,IAAI;QACxB,SAAU;YACR,WAAW;QACb;IACF;IAEA,IAAI,CAAC,SAAS;QACZ,qBACE,qKAAC;YAAI,WAAU;sBACb,cAAA,qKAAC;gBAAE,WAAU;0BAAyB;;;;;;;;;;;IAK5C;IAEA,IAAI,WAAW,CAAC,KAAK;QACnB,qBACE,qKAAC;YAAI,WAAU;sBACb,cAAA,qKAAC;gBAAE,WAAU;0BAAyB;;;;;;;;;;;IAG5C;IAEA,IAAI,SAAS,CAAC,KAAK;QACjB,qBACE,qKAAC;YAAI,WAAU;sBACb,cAAA,qKAAC;gBAAE,WAAU;;oBAAuB;oBAAQ;;;;;;;;;;;;IAGlD;IAEA,IAAI,CAAC,KAAK;QACR,qBACE,qKAAC;YAAI,WAAU;;8BACb,qKAAC;oBACC,SAAS,IAAM,OAAO,IAAI,CAAC;oBAC3B,WAAU;8BACX;;;;;;8BAGD,qKAAC;oBAAE,WAAU;8BAAyB;;;;;;;;;;;;IAG5C;IAEA,MAAM,SAAS,CAAC,IAAI,IAAI,GAAG,IAAI,EAAE,OAAO,CAAC;IAEzC,qBACE,qKAAC;QAAI,WAAU;;0BAEb,qKAAC;gBAAI,WAAU;;kCACb,qKAAC;;0CACC,qKAAC;gCACC,SAAS,IAAM,OAAO,IAAI,CAAC;gCAC3B,WAAU;0CACX;;;;;;0CAGD,qKAAC;gCAAG,WAAU;;oCAAwC;oCAC9C,IAAI,EAAE;;;;;;;0CAEd,qKAAC;gCAAE,WAAU;;oCACV,IAAI,QAAQ;oCAAE;kDACf,qKAAC;wCAAK,WAAU;;4CAAiB;4CAC7B;4CAAO;4CAAO,IAAI,QAAQ;4CAAC;;;;;;;;;;;;;;;;;;;kCAInC,qKAAC;wBAAI,WAAU;;0CACb,qKAAC;gCAAK,WAAU;;oCAAiD;oCACtD,IAAI,MAAM;;;;;;;0CAErB,qKAAC;gCACC,WAAW,CAAC,0CAA0C,EACpD,IAAI,QAAQ,GACR,wCACA,mCACJ;0CAED,IAAI,QAAQ,GAAG,aAAa;;;;;;;;;;;;;;;;;;0BAMnC,qKAAC;gBAAI,WAAU;;kCAEb,qKAAC;wBAAI,WAAU;;0CACb,qKAAC;gCAAI,WAAU;;kDACb,qKAAC;wCAAG,WAAU;kDAA4C;;;;;;kDAG1D,qKAAC;wCAAI,WAAU;;0DACb,qKAAC;;kEACC,qKAAC;wDAAI,WAAU;kEAAiB;;;;;;kEAChC,qKAAC;wDAAI,WAAU;kEACZ,IAAI,SAAS,kBACZ,qKAAC;4DAAK,WAAU;sEAAiB;;;;;;;;;;;;;;;;;0DAIvC,qKAAC;;kEACC,qKAAC;wDAAI,WAAU;kEAAiB;;;;;;kEAChC,qKAAC;wDAAI,WAAU;kEACZ,IAAI,OAAO,kBACV,qKAAC;4DAAK,WAAU;sEAAiB;;;;;;;;;;;;;;;;;0DAIvC,qKAAC;;kEACC,qKAAC;wDAAI,WAAU;kEAAiB;;;;;;kEAChC,qKAAC;wDAAI,WAAU;kEACZ,IAAI,KAAK,IAAI,SAAS,EAAE,cAAc;;;;;;;;;;;;0DAG3C,qKAAC;;kEACC,qKAAC;wDAAI,WAAU;kEAAiB;;;;;;kEAChC,qKAAC;wDAAI,WAAU;kEACZ,IAAI,QAAQ,IAAI;;;;;;;;;;;;;;;;;;;;;;;;0CAOzB,qKAAC;gCAAI,WAAU;;kDACb,qKAAC;wCAAG,WAAU;kDAA4C;;;;;;oCAGzD,CAAC,IAAI,SAAS,iBACb,qKAAC;wCAAI,WAAU;kDAAyB;;;;;6DAIxC,qKAAC;wCAAI,WAAU;;0DACb,qKAAC;gDAAI,WAAU;;kEACb,qKAAC;wDAAI,WAAU;;4DAAiB;4DAClB,IAAI,SAAS,CAAC,EAAE;;;;;;;kEAE9B,qKAAC;wDAAI,WAAU;kEACZ,IAAI,KAAK,IAAI,SAAS,CAAC,SAAS,EAAE,cAAc;;;;;;;;;;;;0DAGrD,qKAAC;gDAAI,WAAU;;kEACb,qKAAC;;0EACC,qKAAC;gEAAI,WAAU;0EAAiB;;;;;;0EAChC,qKAAC;gEAAI,WAAU;0EACZ,IAAI,SAAS,CAAC,UAAU,IAAI,OACzB,GAAG,IAAI,SAAS,CAAC,UAAU,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,GACzC;;;;;;;;;;;;kEAGR,qKAAC;;0EACC,qKAAC;gEAAI,WAAU;0EAAiB;;;;;;0EAChC,qKAAC;gEAAI,WAAU;0EACZ,IAAI,SAAS,CAAC,UAAU,IAAI,OACzB,GAAG,IAAI,SAAS,CAAC,UAAU,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,GACzC;;;;;;;;;;;;kEAGR,qKAAC;;0EACC,qKAAC;gEAAI,WAAU;0EAAiB;;;;;;0EAChC,qKAAC;gEAAI,WAAU;0EACZ,IAAI,SAAS,CAAC,wBAAwB,IAAI,OACvC,GAAG,IAAI,SAAS,CAAC,wBAAwB,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,GACvD;;;;;;;;;;;;kEAGR,qKAAC;;0EACC,qKAAC;gEAAI,WAAU;0EAAiB;;;;;;0EAChC,qKAAC;gEAAI,WAAU;0EACZ,IAAI,SAAS,CAAC,MAAM,IAAI,OACrB,YACA,IAAI,SAAS,CAAC,MAAM,GAClB,SACA;;;;;;;;;;;;;;;;;;0DAIZ,qKAAC;gDAAI,WAAU;;oDAA6B;oDAC9B;oDACX,IAAI,SAAS,CAAC,OAAO,GAClB,CAAC,OAAO,EAAE,IAAI,SAAS,CAAC,OAAO,EAAE,GACjC;;;;;;;;;;;;;;;;;;;;;;;;;kCAQd,qKAAC;wBAAI,WAAU;;0CACb,qKAAC;gCAAI,WAAU;;kDACb,qKAAC;wCAAG,WAAU;kDAAuC;;;;;;kDAGrD,qKAAC;wCAAK,WAAU;kDAA6B;;;;;;;;;;;;0CAI/C,qKAAC;gCAAI,WAAU;0CACZ,IAAI,aAAa,GACd,IAAI,aAAa,GACjB;;;;;;;;;;;;;;;;;;;;;;;;AAMhB"}}]
}