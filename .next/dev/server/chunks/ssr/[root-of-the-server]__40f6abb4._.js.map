{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jesse/Documents/cartfax_complete_v2/pages/admin/states/%5BstateCode%5D.tsx"],"sourcesContent":["import { useRouter } from 'next/router';\nimport { useSession } from 'next-auth/react';\nimport { useEffect, useMemo, useState } from 'react';\n\ntype Brand = {\n  id: number;\n  name: string;\n};\n\ntype LabResult = {\n  id: number;\n  thcPercent: number | null;\n  totalCannabinoidsPercent: number | null;\n  passed: boolean | null;\n};\n\ntype Batch = {\n  id: number;\n  batchCode: string;\n  productName?: string | null;\n  productCategory?: string | null;\n  productSubcategory?: string | null;\n  stateCode?: string | null;\n  isActive: boolean;\n  createdAt: string;\n  brand?: Brand | null;\n  labResults?: LabResult[];\n};\n\nexport default function AdminStateDetail() {\n  const router = useRouter();\n  const { data: session } = useSession();\n  const { stateCode } = router.query;\n\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [batches, setBatches] = useState<Batch[]>([]);\n  const [activeBrandId, setActiveBrandId] = useState<number | 'all'>('all');\n  const [search, setSearch] = useState('');\n\n  useEffect(() => {\n    if (!session) return;\n    if (!stateCode || typeof stateCode !== 'string') return;\n    fetchBatches(stateCode);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [session, stateCode]);\n\n  async function fetchBatches(code: string) {\n    try {\n      setLoading(true);\n      setError(null);\n      const params = new URLSearchParams();\n      params.set('stateCode', code);\n      const res = await fetch(`/api/admin/batches?${params.toString()}`);\n      if (!res.ok) {\n        const txt = await res.text();\n        throw new Error(txt || 'Failed to load batches');\n      }\n      const data: Batch[] = await res.json();\n      setBatches(data);\n    } catch (e: any) {\n      console.error('Failed to fetch batches for state', e);\n      setError(e.message || 'Failed to load batches');\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  const brands = useMemo(() => {\n    const map = new Map<number, Brand>();\n    for (const b of batches) {\n      if (b.brand) {\n        map.set(b.brand.id, b.brand);\n      }\n    }\n    return Array.from(map.values()).sort((a, b) =>\n      a.name.localeCompare(b.name),\n    );\n  }, [batches]);\n\n  const filteredBatches = useMemo(() => {\n    let list = batches;\n\n    if (activeBrandId !== 'all') {\n      list = list.filter((b) => b.brand && b.brand.id === activeBrandId);\n    }\n\n    if (search.trim().length > 0) {\n      const q = search.trim().toLowerCase();\n      list = list.filter(\n        (b) =>\n          b.batchCode.toLowerCase().includes(q) ||\n          (b.productName || '').toLowerCase().includes(q) ||\n          (b.productCategory || '').toLowerCase().includes(q),\n      );\n    }\n\n    return list;\n  }, [batches, activeBrandId, search]);\n\n  const totalBatches = batches.length;\n  const totalBrands = brands.length;\n  const totalLabResults = batches.reduce(\n    (acc, b) => acc + (b.labResults?.length || 0),\n    0,\n  );\n\n  const code = typeof stateCode === 'string' ? stateCode.toUpperCase() : '??';\n\n  if (!session) {\n    return (\n      <div className=\"p-6\">\n        <p className=\"text-sm text-slate-300\">\n          Sign in as an admin to view state details.\n        </p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 max-w-6xl mx-auto space-y-6\">\n      <div className=\"flex items-center justify-between gap-3\">\n        <div>\n          <button\n            onClick={() => router.push('/admin/states')}\n            className=\"text-xs text-sky-400 hover:text-sky-300 mb-1\"\n          >\n            ← Back to state map\n          </button>\n          <h1 className=\"text-2xl font-semibold mb-1\">\n            {code} · batches & lab results\n          </h1>\n          <p className=\"text-sm text-slate-400\">\n            Exploring all batches currently assigned to <span>{code}</span>. Use\n            brand filters and search to stay sane with large datasets.\n          </p>\n        </div>\n      </div>\n\n      {/* Summary cards */}\n      <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-3 text-sm\">\n        <div className=\"rounded-xl border border-slate-800 bg-slate-900/70 p-3\">\n          <div className=\"text-slate-400 text-xs mb-1\">\n            Total batches in {code}\n          </div>\n          <div className=\"text-xl font-semibold text-slate-100\">\n            {totalBatches}\n          </div>\n        </div>\n        <div className=\"rounded-xl border border-slate-800 bg-slate-900/70 p-3\">\n          <div className=\"text-slate-400 text-xs mb-1\">Unique brands</div>\n          <div className=\"text-xl font-semibold text-slate-100\">\n            {totalBrands}\n          </div>\n        </div>\n        <div className=\"rounded-xl border border-slate-800 bg-slate-900/70 p-3\">\n          <div className=\"text-slate-400 text-xs mb-1\">Lab results linked</div>\n          <div className=\"text-xl font-semibold text-slate-100\">\n            {totalLabResults}\n          </div>\n        </div>\n      </div>\n\n      {/* Filters */}\n      <div className=\"rounded-xl border border-slate-800 bg-slate-900/70 p-4 space-y-3 text-xs\">\n        {error && (\n          <div className=\"text-red-400 bg-red-950/40 border border-red-700/60 rounded-md px-3 py-2 text-xs\">\n            {error}\n          </div>\n        )}\n\n        <div className=\"flex flex-col md:flex-row gap-3 md:items-end\">\n          <div className=\"flex-1\">\n            <label className=\"block mb-1 text-slate-300 text-xs\">\n              Search batches in {code}\n            </label>\n            <input\n              value={search}\n              onChange={(e) => setSearch(e.target.value)}\n              placeholder=\"Batch code, product name, category…\"\n              className=\"w-full p-1.5 rounded-md bg-slate-950 border border-slate-700 text-slate-100 placeholder:text-slate-500\"\n            />\n          </div>\n        </div>\n\n        {/* Brand filter chips */}\n        <div className=\"space-y-1\">\n          <div className=\"text-slate-400 text-[11px]\">\n            Filter by brand ({totalBrands})\n          </div>\n          <div className=\"flex flex-wrap gap-1\">\n            <button\n              onClick={() => setActiveBrandId('all')}\n              className={`px-2 py-1 rounded-full border text-[11px] ${\n                activeBrandId === 'all'\n                  ? 'bg-sky-500 text-slate-950 border-sky-400'\n                  : 'border-slate-700 text-slate-200 hover:border-sky-500'\n              }`}\n            >\n              All brands\n            </button>\n            {brands.map((b) => (\n              <button\n                key={b.id}\n                onClick={() => setActiveBrandId(b.id)}\n                className={`px-2 py-1 rounded-full border text-[11px] ${\n                  activeBrandId === b.id\n                    ? 'bg-sky-500 text-slate-950 border-sky-400'\n                    : 'border-slate-700 text-slate-200 hover:border-sky-500'\n                }`}\n              >\n                {b.name}\n              </button>\n            ))}\n          </div>\n        </div>\n      </div>\n\n      {/* Batches list */}\n      <div className=\"rounded-xl border border-slate-800 bg-slate-900/70 p-4\">\n        <div className=\"flex items-center justify-between mb-2 text-xs text-slate-400\">\n          <div>\n            Showing{' '}\n            <span className=\"text-slate-100 font-semibold\">\n              {filteredBatches.length}\n            </span>{' '}\n            of <span className=\"font-semibold\">{totalBatches}</span> batches in{' '}\n            {code}\n          </div>\n          <button\n            onClick={() =>\n              stateCode && typeof stateCode === 'string'\n                ? fetchBatches(stateCode)\n                : null\n            }\n            className=\"px-2 py-1 rounded-md border border-slate-700 text-xs text-slate-200\"\n          >\n            Refresh\n          </button>\n        </div>\n\n        {loading && (\n          <div className=\"text-xs text-slate-400\">Loading batches…</div>\n        )}\n\n        {!loading && filteredBatches.length === 0 && (\n          <div className=\"text-xs text-slate-500\">\n            No batches match this filter in {code} yet.\n          </div>\n        )}\n\n        {!loading && filteredBatches.length > 0 && (\n          <div className=\"space-y-2\">\n            {filteredBatches.map((b) => {\n              const latestLab =\n                b.labResults && b.labResults.length > 0\n                  ? b.labResults[0]\n                  : null;\n\n              return (\n                <div\n                  key={b.id}\n                  className=\"rounded-lg border border-slate-800 bg-slate-950/80 p-3 flex flex-col md:flex-row md:items-center md:justify-between gap-2\"\n                >\n                  <div className=\"space-y-1 text-xs\">\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"font-semibold text-slate-100\">\n                        {b.batchCode}\n                      </span>\n                      {b.isActive && (\n                        <span className=\"px-1.5 py-0.5 rounded-full bg-emerald-500/10 border border-emerald-500/40 text-[10px] text-emerald-300\">\n                          Active\n                        </span>\n                      )}\n                    </div>\n                    {b.productName && (\n                      <div className=\"text-slate-200\">{b.productName}</div>\n                    )}\n                    <div className=\"text-slate-400\">\n                      {b.productCategory || 'Uncategorized'}\n                      {b.productSubcategory ? ` · ${b.productSubcategory}` : ''}\n                      {b.brand ? ` · ${b.brand.name}` : ''}\n                    </div>\n                    <div className=\"text-slate-500\">\n                      Created {new Date(b.createdAt).toLocaleDateString()}\n                    </div>\n                  </div>\n                  <div className=\"flex flex-wrap gap-2 text-[11px]\">\n                    {latestLab && (\n                      <>\n                        <div className=\"px-2 py-1 rounded-md border border-slate-700 text-slate-200\">\n                          THC:{' '}\n                          {latestLab.thcPercent != null\n                            ? `${latestLab.thcPercent.toFixed(1)}%`\n                            : '—'}\n                        </div>\n                        <div className=\"px-2 py-1 rounded-md border border-slate-700 text-slate-200\">\n                          Total cannabinoids:{' '}\n                          {latestLab.totalCannabinoidsPercent != null\n                            ? `${latestLab.totalCannabinoidsPercent.toFixed(\n                                1,\n                              )}%`\n                            : '—'}\n                        </div>\n                        {latestLab.passed != null && (\n                          <div\n                            className={`px-2 py-1 rounded-md border ${\n                              latestLab.passed\n                                ? 'border-emerald-500/60 text-emerald-300'\n                                : 'border-red-500/60 text-red-400'\n                            }`}\n                          >\n                            {latestLab.passed ? 'Pass' : 'Fail'}\n                          </div>\n                        )}\n                      </>\n                    )}\n                    {!latestLab && (\n                      <div className=\"px-2 py-1 rounded-md border border-slate-700 text-slate-400\">\n                        No lab result linked\n                      </div>\n                    )}\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;;;;;AA2Be,SAAS;IACtB,MAAM,SAAS,IAAA,oIAAS;IACxB,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,IAAA,iJAAU;IACpC,MAAM,EAAE,SAAS,EAAE,GAAG,OAAO,KAAK;IAElC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,+GAAQ,EAAC;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,+GAAQ,EAAgB;IAClD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,+GAAQ,EAAU,EAAE;IAClD,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,+GAAQ,EAAiB;IACnE,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,+GAAQ,EAAC;IAErC,IAAA,gHAAS,EAAC;QACR,IAAI,CAAC,SAAS;QACd,IAAI,CAAC,aAAa,OAAO,cAAc,UAAU;QACjD,aAAa;IACb,uDAAuD;IACzD,GAAG;QAAC;QAAS;KAAU;IAEvB,eAAe,aAAa,IAAY;QACtC,IAAI;YACF,WAAW;YACX,SAAS;YACT,MAAM,SAAS,IAAI;YACnB,OAAO,GAAG,CAAC,aAAa;YACxB,MAAM,MAAM,MAAM,MAAM,CAAC,mBAAmB,EAAE,OAAO,QAAQ,IAAI;YACjE,IAAI,CAAC,IAAI,EAAE,EAAE;gBACX,MAAM,MAAM,MAAM,IAAI,IAAI;gBAC1B,MAAM,IAAI,MAAM,OAAO;YACzB;YACA,MAAM,OAAgB,MAAM,IAAI,IAAI;YACpC,WAAW;QACb,EAAE,OAAO,GAAQ;YACf,QAAQ,KAAK,CAAC,qCAAqC;YACnD,SAAS,EAAE,OAAO,IAAI;QACxB,SAAU;YACR,WAAW;QACb;IACF;IAEA,MAAM,SAAS,IAAA,8GAAO,EAAC;QACrB,MAAM,MAAM,IAAI;QAChB,KAAK,MAAM,KAAK,QAAS;YACvB,IAAI,EAAE,KAAK,EAAE;gBACX,IAAI,GAAG,CAAC,EAAE,KAAK,CAAC,EAAE,EAAE,EAAE,KAAK;YAC7B;QACF;QACA,OAAO,MAAM,IAAI,CAAC,IAAI,MAAM,IAAI,IAAI,CAAC,CAAC,GAAG,IACvC,EAAE,IAAI,CAAC,aAAa,CAAC,EAAE,IAAI;IAE/B,GAAG;QAAC;KAAQ;IAEZ,MAAM,kBAAkB,IAAA,8GAAO,EAAC;QAC9B,IAAI,OAAO;QAEX,IAAI,kBAAkB,OAAO;YAC3B,OAAO,KAAK,MAAM,CAAC,CAAC,IAAM,EAAE,KAAK,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK;QACtD;QAEA,IAAI,OAAO,IAAI,GAAG,MAAM,GAAG,GAAG;YAC5B,MAAM,IAAI,OAAO,IAAI,GAAG,WAAW;YACnC,OAAO,KAAK,MAAM,CAChB,CAAC,IACC,EAAE,SAAS,CAAC,WAAW,GAAG,QAAQ,CAAC,MACnC,CAAC,EAAE,WAAW,IAAI,EAAE,EAAE,WAAW,GAAG,QAAQ,CAAC,MAC7C,CAAC,EAAE,eAAe,IAAI,EAAE,EAAE,WAAW,GAAG,QAAQ,CAAC;QAEvD;QAEA,OAAO;IACT,GAAG;QAAC;QAAS;QAAe;KAAO;IAEnC,MAAM,eAAe,QAAQ,MAAM;IACnC,MAAM,cAAc,OAAO,MAAM;IACjC,MAAM,kBAAkB,QAAQ,MAAM,CACpC,CAAC,KAAK,IAAM,MAAM,CAAC,EAAE,UAAU,EAAE,UAAU,CAAC,GAC5C;IAGF,MAAM,OAAO,OAAO,cAAc,WAAW,UAAU,WAAW,KAAK;IAEvE,IAAI,CAAC,SAAS;QACZ,qBACE,qKAAC;YAAI,WAAU;sBACb,cAAA,qKAAC;gBAAE,WAAU;0BAAyB;;;;;;;;;;;IAK5C;IAEA,qBACE,qKAAC;QAAI,WAAU;;0BACb,qKAAC;gBAAI,WAAU;0BACb,cAAA,qKAAC;;sCACC,qKAAC;4BACC,SAAS,IAAM,OAAO,IAAI,CAAC;4BAC3B,WAAU;sCACX;;;;;;sCAGD,qKAAC;4BAAG,WAAU;;gCACX;gCAAK;;;;;;;sCAER,qKAAC;4BAAE,WAAU;;gCAAyB;8CACQ,qKAAC;8CAAM;;;;;;gCAAY;;;;;;;;;;;;;;;;;;0BAOrE,qKAAC;gBAAI,WAAU;;kCACb,qKAAC;wBAAI,WAAU;;0CACb,qKAAC;gCAAI,WAAU;;oCAA8B;oCACzB;;;;;;;0CAEpB,qKAAC;gCAAI,WAAU;0CACZ;;;;;;;;;;;;kCAGL,qKAAC;wBAAI,WAAU;;0CACb,qKAAC;gCAAI,WAAU;0CAA8B;;;;;;0CAC7C,qKAAC;gCAAI,WAAU;0CACZ;;;;;;;;;;;;kCAGL,qKAAC;wBAAI,WAAU;;0CACb,qKAAC;gCAAI,WAAU;0CAA8B;;;;;;0CAC7C,qKAAC;gCAAI,WAAU;0CACZ;;;;;;;;;;;;;;;;;;0BAMP,qKAAC;gBAAI,WAAU;;oBACZ,uBACC,qKAAC;wBAAI,WAAU;kCACZ;;;;;;kCAIL,qKAAC;wBAAI,WAAU;kCACb,cAAA,qKAAC;4BAAI,WAAU;;8CACb,qKAAC;oCAAM,WAAU;;wCAAoC;wCAChC;;;;;;;8CAErB,qKAAC;oCACC,OAAO;oCACP,UAAU,CAAC,IAAM,UAAU,EAAE,MAAM,CAAC,KAAK;oCACzC,aAAY;oCACZ,WAAU;;;;;;;;;;;;;;;;;kCAMhB,qKAAC;wBAAI,WAAU;;0CACb,qKAAC;gCAAI,WAAU;;oCAA6B;oCACxB;oCAAY;;;;;;;0CAEhC,qKAAC;gCAAI,WAAU;;kDACb,qKAAC;wCACC,SAAS,IAAM,iBAAiB;wCAChC,WAAW,CAAC,0CAA0C,EACpD,kBAAkB,QACd,6CACA,wDACJ;kDACH;;;;;;oCAGA,OAAO,GAAG,CAAC,CAAC,kBACX,qKAAC;4CAEC,SAAS,IAAM,iBAAiB,EAAE,EAAE;4CACpC,WAAW,CAAC,0CAA0C,EACpD,kBAAkB,EAAE,EAAE,GAClB,6CACA,wDACJ;sDAED,EAAE,IAAI;2CARF,EAAE,EAAE;;;;;;;;;;;;;;;;;;;;;;;0BAgBnB,qKAAC;gBAAI,WAAU;;kCACb,qKAAC;wBAAI,WAAU;;0CACb,qKAAC;;oCAAI;oCACK;kDACR,qKAAC;wCAAK,WAAU;kDACb,gBAAgB,MAAM;;;;;;oCACjB;oCAAI;kDACT,qKAAC;wCAAK,WAAU;kDAAiB;;;;;;oCAAoB;oCAAY;oCACnE;;;;;;;0CAEH,qKAAC;gCACC,SAAS,IACP,aAAa,OAAO,cAAc,WAC9B,aAAa,aACb;gCAEN,WAAU;0CACX;;;;;;;;;;;;oBAKF,yBACC,qKAAC;wBAAI,WAAU;kCAAyB;;;;;;oBAGzC,CAAC,WAAW,gBAAgB,MAAM,KAAK,mBACtC,qKAAC;wBAAI,WAAU;;4BAAyB;4BACL;4BAAK;;;;;;;oBAIzC,CAAC,WAAW,gBAAgB,MAAM,GAAG,mBACpC,qKAAC;wBAAI,WAAU;kCACZ,gBAAgB,GAAG,CAAC,CAAC;4BACpB,MAAM,YACJ,EAAE,UAAU,IAAI,EAAE,UAAU,CAAC,MAAM,GAAG,IAClC,EAAE,UAAU,CAAC,EAAE,GACf;4BAEN,qBACE,qKAAC;gCAEC,WAAU;;kDAEV,qKAAC;wCAAI,WAAU;;0DACb,qKAAC;gDAAI,WAAU;;kEACb,qKAAC;wDAAK,WAAU;kEACb,EAAE,SAAS;;;;;;oDAEb,EAAE,QAAQ,kBACT,qKAAC;wDAAK,WAAU;kEAAyG;;;;;;;;;;;;4CAK5H,EAAE,WAAW,kBACZ,qKAAC;gDAAI,WAAU;0DAAkB,EAAE,WAAW;;;;;;0DAEhD,qKAAC;gDAAI,WAAU;;oDACZ,EAAE,eAAe,IAAI;oDACrB,EAAE,kBAAkB,GAAG,CAAC,GAAG,EAAE,EAAE,kBAAkB,EAAE,GAAG;oDACtD,EAAE,KAAK,GAAG,CAAC,GAAG,EAAE,EAAE,KAAK,CAAC,IAAI,EAAE,GAAG;;;;;;;0DAEpC,qKAAC;gDAAI,WAAU;;oDAAiB;oDACrB,IAAI,KAAK,EAAE,SAAS,EAAE,kBAAkB;;;;;;;;;;;;;kDAGrD,qKAAC;wCAAI,WAAU;;4CACZ,2BACC;;kEACE,qKAAC;wDAAI,WAAU;;4DAA8D;4DACtE;4DACJ,UAAU,UAAU,IAAI,OACrB,GAAG,UAAU,UAAU,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,GACrC;;;;;;;kEAEN,qKAAC;wDAAI,WAAU;;4DAA8D;4DACvD;4DACnB,UAAU,wBAAwB,IAAI,OACnC,GAAG,UAAU,wBAAwB,CAAC,OAAO,CAC3C,GACA,CAAC,CAAC,GACJ;;;;;;;oDAEL,UAAU,MAAM,IAAI,sBACnB,qKAAC;wDACC,WAAW,CAAC,4BAA4B,EACtC,UAAU,MAAM,GACZ,2CACA,kCACJ;kEAED,UAAU,MAAM,GAAG,SAAS;;;;;;;;4CAKpC,CAAC,2BACA,qKAAC;gDAAI,WAAU;0DAA8D;;;;;;;;;;;;;+BAzD5E,EAAE,EAAE;;;;;wBAgEf;;;;;;;;;;;;;;;;;;AAMZ"}}]
}