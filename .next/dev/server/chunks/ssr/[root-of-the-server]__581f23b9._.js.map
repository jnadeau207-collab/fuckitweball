{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 32, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jesse/Documents/cartfax_complete_v2/components/GlobeStates.tsx"],"sourcesContent":["// components/GlobeStates.tsx\nimport React, {\n  useEffect,\n  useRef,\n  useState,\n  useMemo,\n} from 'react';\nimport Globe from 'react-globe.gl';\nimport * as topojson from 'topojson-client';\nimport * as THREE from 'three';\n\nexport type RegionId = 'unitedStates' | 'canada' | 'mexico' | 'netherlands';\n\ninterface GlobeStatesProps {\n  region: RegionId;\n  onStateSelect?: (\n    id: string | number | null,\n    name: string,\n    coords?: { x: number; y: number }\n  ) => void;\n  onViewChange?: (altitude: number) => void;\n  onRegionChange?: (region: RegionId) => void;\n}\n\n// Camera focus targets per region\nconst regionFocus: Record<RegionId, { lat: number; lng: number; altitude: number }> = {\n  unitedStates: { lat: 39, lng: -98, altitude: 1.9 },\n  canada: { lat: 62, lng: -96, altitude: 2.1 },\n  mexico: { lat: 23, lng: -102, altitude: 2.1 },\n  netherlands: { lat: 52.3, lng: 5.3, altitude: 3.0 },\n};\n\nconst usStatesUrl = 'https://unpkg.com/us-atlas@3/states-10m.json';\nconst worldCountriesUrl =\n  'https://unpkg.com/world-atlas@2.0.2/countries-110m.json';\n\n// Mapping from world-atlas numeric country IDs to our RegionId\nconst COUNTRY_ID_TO_REGION: Record<number, RegionId> = {\n  840: 'unitedStates',\n  124: 'canada',\n  484: 'mexico',\n  528: 'netherlands',\n};\n\nconst GlobeStates: React.FC<GlobeStatesProps> = ({\n  region,\n  onStateSelect,\n  onViewChange,\n  onRegionChange,\n}) => {\n  const globeRef = useRef<any>(null);\n\n  const [usPolygons, setUsPolygons] = useState<any[]>([]);\n  const [worldPolygons, setWorldPolygons] = useState<any[]>([]);\n  const [hoverPoly, setHoverPoly] = useState<any | null>(null);\n  const [selectedStateId, setSelectedStateId] = useState<string | null>(null);\n  const [earthTexture, setEarthTexture] = useState<THREE.Texture | null>(null);\n\n  const isUS = region === 'unitedStates';\n\n  // --- helpers --------------------------------------------------------------\n\n  const getStatePostal = (poly: any): string | null => {\n    const postal = poly?.properties?.postal ?? poly?.id;\n    if (!postal) return null;\n    return String(postal).toUpperCase();\n  };\n\n  const isState = (poly: any) =>\n    !!poly?.properties && typeof poly.properties.postal !== 'undefined';\n\n  const isCountry = (poly: any) =>\n    poly?.properties && typeof poly.id !== 'undefined' && !isState(poly);\n\n  const getCountryRegion = (poly: any): RegionId | null => {\n    const idNum =\n      typeof poly.id === 'number'\n        ? poly.id\n        : Number.parseInt(String(poly.id), 10);\n\n    if (Number.isNaN(idNum)) return null;\n    return COUNTRY_ID_TO_REGION[idNum] ?? null;\n  };\n\n  // --- load topojson --------------------------------------------------------\n\n  // US states\n  useEffect(() => {\n    (async () => {\n      try {\n        const res = await fetch(usStatesUrl);\n        const topo = await res.json();\n        const geo = topojson.feature(topo, topo.objects.states) as any;\n        const states = geo.features.map((f: any) => ({\n          ...f,\n          properties: {\n            ...f.properties,\n            postal: f.properties?.postal || f.id,\n          },\n        }));\n        setUsPolygons(states);\n      } catch (err) {\n        console.error('Error loading US states topojson', err);\n      }\n    })();\n  }, []);\n\n  // World countries (for US, CA, MX, NL outlines)\n  useEffect(() => {\n    (async () => {\n      try {\n        const res = await fetch(worldCountriesUrl);\n        const topo = await res.json();\n        const geo = topojson.feature(topo, topo.objects.countries) as any;\n        setWorldPolygons(geo.features);\n      } catch (err) {\n        console.error('Error loading world countries topojson', err);\n      }\n    })();\n  }, []);\n\n  // --- base earth texture (optional) ----------------------------------------\n\n  useEffect(() => {\n    const loader = new THREE.TextureLoader();\n    loader.load(\n      '/textures/earth-night-2016.jpg',\n      tex => {\n        tex.wrapS = tex.wrapT = THREE.ClampToEdgeWrapping;\n        setEarthTexture(tex);\n      },\n      undefined,\n      () => {\n        console.warn(\n          'Could not load /textures/earth-night-2016.jpg; globe will use a flat color instead.'\n        );\n      }\n    );\n  }, []);\n\n  // --- focus camera on region -----------------------------------------------\n\n  useEffect(() => {\n    if (!globeRef.current) return;\n    const focus = regionFocus[region];\n    globeRef.current.pointOfView(\n      {\n        lat: focus.lat,\n        lng: focus.lng,\n        altitude: focus.altitude,\n      },\n      1000\n    );\n  }, [region]);\n\n  // --- altitude reporting ----------------------------------------------------\n\n  useEffect(() => {\n    if (!globeRef.current || !onViewChange) return;\n\n    const globe = globeRef.current;\n    const handle = () => {\n      const { altitude } = globe.pointOfView();\n      onViewChange(altitude);\n    };\n\n    globe.controls().addEventListener('change', handle);\n    return () => {\n      globe.controls().removeEventListener('change', handle);\n    };\n  }, [onViewChange]);\n\n  // --- combined polygon data -------------------------------------------------\n\n  const allPolygons = useMemo(\n    () => [...worldPolygons, ...usPolygons],\n    [worldPolygons, usPolygons],\n  );\n\n  // --- explosion / altitude logic -------------------------------------------\n\n  const BASE_ALT_STATE = 0.015;      // base extrusion for US states\n  const BASE_ALT_COUNTRY = 0.008;    // base extrusion for countries\n  const BASE_ALT_OTHER = 0.004;\n\n  const EXTRA_SELECTED = 0.010;\n  const EXTRA_HOVER = 0.005;\n\n  const polygonAltitude = (poly: any) => {\n    if (isState(poly)) {\n      const id = getStatePostal(poly);\n      const isSelected = id && selectedStateId && id === selectedStateId;\n      const isHovered = hoverPoly === poly;\n\n      let extra = 0;\n      if (isSelected) extra += EXTRA_SELECTED;\n      if (isHovered) extra += EXTRA_HOVER;\n\n      return BASE_ALT_STATE + extra;\n    }\n\n    if (isCountry(poly)) {\n      const reg = getCountryRegion(poly);\n      const isActiveCountry = reg && reg === region;\n      const isHovered = hoverPoly === poly;\n\n      let alt = BASE_ALT_COUNTRY;\n      if (isActiveCountry) alt += EXTRA_SELECTED * 0.7;\n      if (isHovered) alt += EXTRA_HOVER * 0.5;\n      return alt;\n    }\n\n    return BASE_ALT_OTHER;\n  };\n\n  const globeMaterial = useMemo(\n    () =>\n      new THREE.MeshStandardMaterial({\n        metalness: 0.35,\n        roughness: 0.9,\n        color: new THREE.Color('#020617'),\n        map: earthTexture ?? undefined,\n      }),\n    [earthTexture],\n  );\n\n  // --- render ----------------------------------------------------------------\n\n  return (\n    <div className=\"h-full w-full\">\n      <Globe\n        ref={globeRef}\n        backgroundColor=\"rgba(0,0,0,1)\"\n        animateIn\n        showAtmosphere={false}\n        globeMaterial={globeMaterial}\n        hexPolygonResolution={3}\n        hexPolygonMargin={0.4}\n        polygonsData={allPolygons}\n        polygonAltitude={polygonAltitude}\n        polygonCapMaterial={poly => {\n          // state caps\n          if (isState(poly)) {\n            const id = getStatePostal(poly);\n            const isSelected = id && selectedStateId && id === selectedStateId;\n            const isHovered = hoverPoly === poly;\n\n            const emissiveBase = new THREE.Color('#020617');\n            const emissiveHighlight = new THREE.Color('#22c55e');\n\n            return new THREE.MeshStandardMaterial({\n              metalness: 0.96,\n              roughness: 0.26,\n              color: new THREE.Color('#020617'),\n              emissive:\n                isHovered || isSelected ? emissiveHighlight : emissiveBase,\n              emissiveIntensity: isHovered\n                ? 0.4\n                : isSelected\n                ? 0.25\n                : 0.16,\n            });\n          }\n\n          // country caps\n          if (isCountry(poly)) {\n            const reg = getCountryRegion(poly);\n            const isActiveCountry = reg && reg === region;\n\n            return new THREE.MeshStandardMaterial({\n              metalness: 0.7,\n              roughness: 0.5,\n              color: new THREE.Color(isActiveCountry ? '#043b27' : '#020617'),\n              emissive: new THREE.Color(\n                isActiveCountry ? '#16a34a' : '#020617',\n              ),\n              emissiveIntensity: isActiveCountry ? 0.24 : 0.14,\n            });\n          }\n\n          // fallback\n          return new THREE.MeshStandardMaterial({\n            metalness: 0.6,\n            roughness: 0.4,\n            color: new THREE.Color('#020617'),\n          });\n        }}\n        polygonSideColor={poly =>\n          isState(poly)\n            ? 'rgba(34,197,94,0.85)'\n            : 'rgba(15,23,42,0.9)'\n        }\n        polygonStrokeColor={poly =>\n          isState(poly)\n            ? 'rgba(21,94,49,0.7)'\n            : 'rgba(30,64,175,0.25)'\n        }\n        polygonLabel={poly =>\n          isState(poly)\n            ? `${poly.properties?.name ?? ''} (${poly.properties?.postal})`\n            : poly.properties?.name ?? ''\n        }\n        polygonsTransitionDuration={260}\n        onPolygonHover={poly => setHoverPoly(poly)}\n        onPolygonClick={(poly, event) => {\n          const name = poly.properties?.name ?? '';\n\n          const clickCoords =\n            event && typeof (event as any).clientX === 'number'\n              ? {\n                  x: (event as any).clientX as number,\n                  y: (event as any).clientY as number,\n                }\n              : undefined;\n\n          if (isState(poly)) {\n            const id = getStatePostal(poly) ?? poly.id ?? '';\n            setSelectedStateId(id || null);\n\n            if (onStateSelect) {\n              onStateSelect(id, name, clickCoords);\n            }\n            return;\n          }\n\n          if (isCountry(poly)) {\n            const regionFromCountry = getCountryRegion(poly);\n            if (regionFromCountry && onRegionChange) {\n              onRegionChange(regionFromCountry);\n            }\n            if (onStateSelect) {\n              const id = name || poly.id || '';\n              onStateSelect(id, name, clickCoords);\n            }\n          }\n        }}\n      />\n    </div>\n  );\n};\n\nexport default GlobeStates;\n"],"names":[],"mappings":"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"}}]
}