{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 32, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jesse/Documents/cartfax_complete_v2/components/GlobeStates.tsx"],"sourcesContent":["// components/GlobeStates.tsx\nimport React, {\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport Globe from 'react-globe.gl';\nimport * as topojson from 'topojson-client';\nimport * as THREE from 'three';\n\nexport type RegionId = 'unitedStates' | 'canada' | 'mexico' | 'netherlands';\n\ninterface GlobeStatesProps {\n  region: RegionId;\n  onStateSelect?: (\n    id: string | number | null,\n    name: string,\n    coords?: { x: number; y: number }\n  ) => void;\n  onViewChange?: (altitude: number) => void;\n  onRegionChange?: (region: RegionId) => void;\n}\n\nconst regionFocus: Record<\n  RegionId,\n  { lat: number; lng: number; altitude: number }\n> = {\n  unitedStates: { lat: 39, lng: -98, altitude: 1.9 },\n  canada: { lat: 62, lng: -96, altitude: 2.1 },\n  mexico: { lat: 23, lng: -102, altitude: 2.1 },\n  netherlands: { lat: 52.3, lng: 5.3, altitude: 3.0 },\n};\n\nconst usStatesUrl = 'https://unpkg.com/us-atlas@3/states-10m.json';\nconst worldCountriesUrl =\n  'https://unpkg.com/world-atlas@2.0.2/countries-110m.json';\n\nconst COUNTRY_ID_TO_REGION: Record<number, RegionId> = {\n  840: 'unitedStates',\n  124: 'canada',\n  484: 'mexico',\n  528: 'netherlands',\n};\n\nconst GlobeStates: React.FC<GlobeStatesProps> = ({\n  region,\n  onStateSelect,\n  onViewChange,\n  onRegionChange,\n}) => {\n  const globeRef = useRef<any>(null);\n\n  const [usPolygons, setUsPolygons] = useState<any[]>([]);\n  const [worldPolygons, setWorldPolygons] = useState<any[]>([]);\n  const [hoverPoly, setHoverPoly] = useState<any | null>(null);\n  const [selectedStateId, setSelectedStateId] = useState<string | null>(null);\n\n  // texture maps\n  const [envTex, setEnvTex] = useState<THREE.Texture | null>(null);\n  const [stateMetalTex, setStateMetalTex] = useState<THREE.Texture | null>(null);\n  const [countryMetalTex, setCountryMetalTex] = useState<THREE.Texture | null>(\n    null,\n  );\n\n  const isUS = region === 'unitedStates';\n\n  // --- helpers --------------------------------------------------------------\n\n  const getStatePostal = (poly: any): string | null => {\n    const postal = poly?.properties?.postal ?? poly?.id;\n    if (!postal) return null;\n    return String(postal).toUpperCase();\n  };\n\n  const isState = (poly: any) =>\n    !!poly?.properties && typeof poly.properties.postal !== 'undefined';\n\n  const isCountry = (poly: any) =>\n    poly?.properties && typeof poly.id !== 'undefined' && !isState(poly);\n\n  const getCountryRegion = (poly: any): RegionId | null => {\n    const idNum =\n      typeof poly.id === 'number'\n        ? poly.id\n        : Number.parseInt(String(poly.id), 10);\n\n    if (Number.isNaN(idNum)) return null;\n    return COUNTRY_ID_TO_REGION[idNum] ?? null;\n  };\n\n  // --- load topojson --------------------------------------------------------\n\n  useEffect(() => {\n    (async () => {\n      try {\n        const res = await fetch(usStatesUrl);\n        const topo = await res.json();\n        const geo = topojson.feature(topo, topo.objects.states) as any;\n        const states = geo.features.map((f: any) => ({\n          ...f,\n          properties: {\n            ...f.properties,\n            postal: f.properties?.postal || f.id,\n          },\n        }));\n        setUsPolygons(states);\n      } catch (err) {\n        console.error('Error loading US states topojson', err);\n      }\n    })();\n  }, []);\n\n  useEffect(() => {\n    (async () => {\n      try {\n        const res = await fetch(worldCountriesUrl);\n        const topo = await res.json();\n        const geo = topojson.feature(topo, topo.objects.countries) as any;\n        setWorldPolygons(geo.features);\n      } catch (err) {\n        console.error('Error loading world countries topojson', err);\n      }\n    })();\n  }, []);\n\n  // --- textures for materials -----------------------------------------------\n\n  useEffect(() => {\n    const loader = new THREE.TextureLoader();\n\n    loader.load('/textures/state-metal.jpg', tex => {\n      tex.wrapS = tex.wrapT = THREE.RepeatWrapping;\n      tex.repeat.set(2.5, 2.5);\n      setStateMetalTex(tex);\n    });\n\n    loader.load('/textures/country-metal.jpg', tex => {\n      tex.wrapS = tex.wrapT = THREE.RepeatWrapping;\n      tex.repeat.set(3, 3);\n      setCountryMetalTex(tex);\n    });\n\n    loader.load('/textures/globe-env.jpg', tex => {\n      tex.mapping = THREE.EquirectangularReflectionMapping;\n      setEnvTex(tex);\n    });\n  }, []);\n\n  // --- focus camera on region -----------------------------------------------\n\n  useEffect(() => {\n    if (!globeRef.current) return;\n    const focus = regionFocus[region];\n    globeRef.current.pointOfView(\n      {\n        lat: focus.lat,\n        lng: focus.lng,\n        altitude: focus.altitude,\n      },\n      1000,\n    );\n  }, [region]);\n\n  // --- zoom feel / controls tuning ------------------------------------------\n\n  useEffect(() => {\n    if (!globeRef.current) return;\n    const controls = globeRef.current.controls?.();\n    if (!controls) return;\n\n    // generous zoom range â€“ avoids \"tiny zoom after first click\"\n    controls.minDistance = 140;\n    controls.maxDistance = 780;\n    controls.enableDamping = true;\n    controls.dampingFactor = 0.12;\n    controls.zoomSpeed = 0.9;\n  }, []);\n\n  // --- altitude reporting ----------------------------------------------------\n\n  useEffect(() => {\n    if (!globeRef.current || !onViewChange) return;\n\n    const globe = globeRef.current;\n    const controls = globe.controls?.();\n    if (!controls || !controls.addEventListener) return;\n\n    const handle = () => {\n      const { altitude } = globe.pointOfView();\n      onViewChange(altitude);\n    };\n\n    controls.addEventListener('change', handle);\n    return () => {\n      controls.removeEventListener('change', handle);\n    };\n  }, [onViewChange]);\n\n  // --- combined polygon data -------------------------------------------------\n\n  const allPolygons = useMemo(\n    () => [...worldPolygons, ...usPolygons],\n    [worldPolygons, usPolygons],\n  );\n\n  // --- explosion / altitude logic -------------------------------------------\n\n  const BASE_ALT_STATE = 0.015;\n  const BASE_ALT_COUNTRY = 0.008;\n  const BASE_ALT_OTHER = 0.004;\n\n  // turned up slightly for more punch\n  const EXTRA_SELECTED = 0.015;\n  const EXTRA_HOVER = 0.008;\n\n  const polygonAltitude = (poly: any) => {\n    if (isState(poly)) {\n      const id = getStatePostal(poly);\n      const isSelected = id && selectedStateId && id === selectedStateId;\n      const isHovered = hoverPoly === poly;\n\n      let extra = 0;\n      if (isSelected) extra += EXTRA_SELECTED;\n      if (isHovered) extra += EXTRA_HOVER;\n\n      return BASE_ALT_STATE + extra;\n    }\n\n    if (isCountry(poly)) {\n      return BASE_ALT_COUNTRY;\n    }\n\n    return BASE_ALT_OTHER;\n  };\n\n  // --- render ----------------------------------------------------------------\n\n  return (\n    <div className=\"h-full w-full\">\n      <Globe\n        ref={globeRef}\n        backgroundColor=\"rgba(0,0,0,1)\"\n        animateIn\n        hexPolygonResolution={3}\n        hexPolygonMargin={0.4}\n        globeMaterial={\n          new THREE.MeshStandardMaterial({\n            metalness: 0.9,\n            roughness: 0.32,\n            color: new THREE.Color('#020617'),\n            envMap: envTex ?? undefined,\n            envMapIntensity: 0.85,\n          })\n        }\n        polygonsData={allPolygons}\n        polygonAltitude={polygonAltitude}\n        polygonCapMaterial={poly => {\n          // US states: metallic tiles with green emissive lift\n          if (isState(poly)) {\n            const id = getStatePostal(poly);\n            const isSelected = id && selectedStateId && id === selectedStateId;\n            const isHovered = hoverPoly === poly;\n\n            const emissiveBase = new THREE.Color('#020617');\n            const emissiveHighlight = new THREE.Color('#22c55e');\n\n            return new THREE.MeshStandardMaterial({\n              metalness: 0.95,\n              roughness: 0.22,\n              color: new THREE.Color('#020617'),\n              emissive: isHovered || isSelected ? emissiveHighlight : emissiveBase,\n              emissiveIntensity: isHovered\n                ? 0.55\n                : isSelected\n                ? 0.36\n                : 0.18,\n              map: stateMetalTex ?? undefined,\n              envMap: envTex ?? undefined,\n              envMapIntensity: isHovered || isSelected ? 1.3 : 0.9,\n            });\n          }\n\n          // countries: subtle metallic band\n          if (isCountry(poly)) {\n            return new THREE.MeshStandardMaterial({\n              metalness: 0.8,\n              roughness: 0.38,\n              color: new THREE.Color('#020617'),\n              emissive: new THREE.Color('#020617'),\n              emissiveIntensity: 0.2,\n              map: countryMetalTex ?? undefined,\n              envMap: envTex ?? undefined,\n              envMapIntensity: 0.75,\n            });\n          }\n\n          // everything else\n          return new THREE.MeshStandardMaterial({\n            metalness: 0.6,\n            roughness: 0.4,\n            color: new THREE.Color('#020617'),\n            envMap: envTex ?? undefined,\n            envMapIntensity: 0.4,\n          });\n        }}\n        polygonSideColor={poly =>\n          isState(poly)\n            ? 'rgba(34,197,94,0.9)'\n            : '#020617'\n        }\n        polygonStrokeColor={poly =>\n          isState(poly)\n            ? 'rgba(21,94,49,0.5)'\n            : 'rgba(30,64,175,0.25)'\n        }\n        polygonLabel={poly =>\n          isState(poly)\n            ? `${poly.properties?.name ?? ''} (${poly.properties?.postal})`\n            : poly.properties?.name ?? ''\n        }\n        polygonsTransitionDuration={260}\n        polygonCapCurvatureResolution={2}\n        onPolygonHover={poly => setHoverPoly(poly)}\n        onPolygonClick={(poly: any, event: any) => {\n          const name = poly.properties?.name ?? '';\n\n          const clickCoords =\n            event && typeof event.clientX === 'number'\n              ? { x: event.clientX as number, y: event.clientY as number }\n              : undefined;\n\n          if (isState(poly)) {\n            const id = getStatePostal(poly) ?? poly.id ?? '';\n            setSelectedStateId(id || null);\n\n            if (onStateSelect) {\n              onStateSelect(id, name, clickCoords);\n            }\n            return;\n          }\n\n          if (isCountry(poly)) {\n            const regionFromCountry = getCountryRegion(poly);\n            if (regionFromCountry && onRegionChange) {\n              onRegionChange(regionFromCountry);\n            }\n            if (onStateSelect) {\n              const id = name || poly.id || '';\n              onStateSelect(id, name, clickCoords);\n            }\n          }\n        }}\n      />\n    </div>\n  );\n};\n\nexport default GlobeStates;\n"],"names":[],"mappings":"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"}}]
}