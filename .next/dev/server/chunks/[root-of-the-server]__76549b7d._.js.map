{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jesse/Documents/cartfax_complete_v2/lib/coaParsers/novaAnalytic.ts"],"sourcesContent":["// lib/coaParsers/novaAnalytic.ts\r\nimport { LabParser, ParsedCoa } from './types';\r\n\r\nconst STATE_ABBREVS = [\r\n  'AL', 'AK', 'AZ', 'AR', 'CA', 'CO', 'CT', 'DE', 'FL', 'GA',\r\n  'HI', 'ID', 'IL', 'IN', 'IA', 'KS', 'KY', 'LA', 'ME', 'MD',\r\n  'MA', 'MI', 'MN', 'MS', 'MO', 'MT', 'NE', 'NV', 'NH', 'NJ',\r\n  'NM', 'NY', 'NC', 'ND', 'OH', 'OK', 'OR', 'PA', 'RI', 'SC',\r\n  'SD', 'TN', 'TX', 'UT', 'VT', 'VA', 'WA', 'WV', 'WI', 'WY',\r\n];\r\n\r\nfunction detectCityStateFromLine(\r\n  line: string\r\n): { city?: string; state?: string } {\r\n  // e.g. \"65 MILLIKEN STREET, UNIT C PORTLAND ME 04103\"\r\n  const regex = new RegExp(\r\n    `\\\\b([A-Za-z][A-Za-z]+)\\\\s+(${STATE_ABBREVS.join('|')})\\\\s+\\\\d{5}\\\\b`\r\n  );\r\n  const m = line.match(regex);\r\n  if (!m) return {};\r\n  const city = m[1];\r\n  const state = m[2];\r\n  return { city, state };\r\n}\r\n\r\nexport const parseNovaAnalytic: LabParser = (text) => {\r\n  if (!/NOVA ANALYTIC LABS/i.test(text)) {\r\n    return null;\r\n  }\r\n\r\n  const result: ParsedCoa = {\r\n    labName: 'Nova Analytic Labs',\r\n    contaminants: [],\r\n  };\r\n\r\n  const canonicalText = text.replace(/\\r\\n/g, '\\n');\r\n\r\n  // Lab address line\r\n  const labLineMatch = canonicalText.match(\r\n    /NOVA ANALYTIC LABS\\s*\\/\\/\\s*([^\\n]+)/i\r\n  );\r\n  if (labLineMatch) {\r\n    const { city, state } = detectCityStateFromLine(labLineMatch[1]);\r\n    if (city) result.labCity = city;\r\n    if (state) result.labStateCode = state;\r\n  }\r\n\r\n  // Batch code, e.g. \"BATCH: FAIL\"\r\n  const batchMatch =\r\n    canonicalText.match(/BATCH:\\s*([A-Za-z0-9_-]+)/i) ||\r\n    canonicalText.match(/BATCH\\s+RESULT\\s*:\\s*([A-Za-z0-9_-]+)/i);\r\n  if (batchMatch) {\r\n    result.batchCode = batchMatch[1].trim();\r\n  }\r\n\r\n  // Basic cannabinoid metrics\r\n  const thcMatch = canonicalText.match(/Δ-THC:?(\\d+(\\.\\d+)?)\\s*%/i);\r\n  if (thcMatch) result.thcPercent = parseFloat(thcMatch[1]);\r\n\r\n  const totalMatch = canonicalText.match(\r\n    /TOTAL\\s+CANNABINOIDS:?(\\d+(\\.\\d+)?)\\s*%/i\r\n  );\r\n  if (totalMatch) result.totalCannabinoidsPercent = parseFloat(totalMatch[1]);\r\n\r\n  const cbdMatch = canonicalText.match(/CBD:?(\\d+(\\.\\d+)?)\\s*%/i);\r\n  if (cbdMatch) result.cbdPercent = parseFloat(cbdMatch[1]);\r\n\r\n  // Overall batch result: PASS/FAIL\r\n  const batchResultMatch = canonicalText.match(\r\n    /BATCH RESULT:\\s*(PASS|FAIL)/i\r\n  );\r\n  if (batchResultMatch) {\r\n    result.overallPass = batchResultMatch[1].toUpperCase() === 'PASS';\r\n  }\r\n\r\n  // Simple contaminant summary: capture FAIL lines\r\n  const failLines = canonicalText\r\n    .split('\\n')\r\n    .filter((line) => /\\bFAIL\\b/i.test(line));\r\n\r\n  for (const line of failLines) {\r\n    const nameMatch = line.match(/([A-Z][A-Za-z]+)\\s*FAIL/i);\r\n    const name = nameMatch ? nameMatch[1] : 'Unknown';\r\n    result.contaminants.push({\r\n      group: 'OTHER',\r\n      name,\r\n      status: 'FAIL',\r\n      valueRaw: line.trim(),\r\n    });\r\n  }\r\n\r\n  return result;\r\n};\r\n"],"names":[],"mappings":"AAAA,iCAAiC;;;;;AAGjC,MAAM,gBAAgB;IACpB;IAAM;IAAM;IAAM;IAAM;IAAM;IAAM;IAAM;IAAM;IAAM;IACtD;IAAM;IAAM;IAAM;IAAM;IAAM;IAAM;IAAM;IAAM;IAAM;IACtD;IAAM;IAAM;IAAM;IAAM;IAAM;IAAM;IAAM;IAAM;IAAM;IACtD;IAAM;IAAM;IAAM;IAAM;IAAM;IAAM;IAAM;IAAM;IAAM;IACtD;IAAM;IAAM;IAAM;IAAM;IAAM;IAAM;IAAM;IAAM;IAAM;CACvD;AAED,SAAS,wBACP,IAAY;IAEZ,sDAAsD;IACtD,MAAM,QAAQ,IAAI,OAChB,CAAC,2BAA2B,EAAE,cAAc,IAAI,CAAC,KAAK,cAAc,CAAC;IAEvE,MAAM,IAAI,KAAK,KAAK,CAAC;IACrB,IAAI,CAAC,GAAG,OAAO,CAAC;IAChB,MAAM,OAAO,CAAC,CAAC,EAAE;IACjB,MAAM,QAAQ,CAAC,CAAC,EAAE;IAClB,OAAO;QAAE;QAAM;IAAM;AACvB;AAEO,MAAM,oBAA+B,CAAC;IAC3C,IAAI,CAAC,sBAAsB,IAAI,CAAC,OAAO;QACrC,OAAO;IACT;IAEA,MAAM,SAAoB;QACxB,SAAS;QACT,cAAc,EAAE;IAClB;IAEA,MAAM,gBAAgB,KAAK,OAAO,CAAC,SAAS;IAE5C,mBAAmB;IACnB,MAAM,eAAe,cAAc,KAAK,CACtC;IAEF,IAAI,cAAc;QAChB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,wBAAwB,YAAY,CAAC,EAAE;QAC/D,IAAI,MAAM,OAAO,OAAO,GAAG;QAC3B,IAAI,OAAO,OAAO,YAAY,GAAG;IACnC;IAEA,iCAAiC;IACjC,MAAM,aACJ,cAAc,KAAK,CAAC,iCACpB,cAAc,KAAK,CAAC;IACtB,IAAI,YAAY;QACd,OAAO,SAAS,GAAG,UAAU,CAAC,EAAE,CAAC,IAAI;IACvC;IAEA,4BAA4B;IAC5B,MAAM,WAAW,cAAc,KAAK,CAAC;IACrC,IAAI,UAAU,OAAO,UAAU,GAAG,WAAW,QAAQ,CAAC,EAAE;IAExD,MAAM,aAAa,cAAc,KAAK,CACpC;IAEF,IAAI,YAAY,OAAO,wBAAwB,GAAG,WAAW,UAAU,CAAC,EAAE;IAE1E,MAAM,WAAW,cAAc,KAAK,CAAC;IACrC,IAAI,UAAU,OAAO,UAAU,GAAG,WAAW,QAAQ,CAAC,EAAE;IAExD,kCAAkC;IAClC,MAAM,mBAAmB,cAAc,KAAK,CAC1C;IAEF,IAAI,kBAAkB;QACpB,OAAO,WAAW,GAAG,gBAAgB,CAAC,EAAE,CAAC,WAAW,OAAO;IAC7D;IAEA,iDAAiD;IACjD,MAAM,YAAY,cACf,KAAK,CAAC,MACN,MAAM,CAAC,CAAC,OAAS,YAAY,IAAI,CAAC;IAErC,KAAK,MAAM,QAAQ,UAAW;QAC5B,MAAM,YAAY,KAAK,KAAK,CAAC;QAC7B,MAAM,OAAO,YAAY,SAAS,CAAC,EAAE,GAAG;QACxC,OAAO,YAAY,CAAC,IAAI,CAAC;YACvB,OAAO;YACP;YACA,QAAQ;YACR,UAAU,KAAK,IAAI;QACrB;IACF;IAEA,OAAO;AACT"}},
    {"offset": {"line": 178, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jesse/Documents/cartfax_complete_v2/lib/coaParsers/registry.ts"],"sourcesContent":["// lib/coaParsers/registry.ts\r\nimport { LabParser, ParsedCoa } from './types';\r\nimport { parseNovaAnalytic } from './novaAnalytic';\r\n\r\ntype LabRegistryEntry = {\r\n  slug: string;\r\n  displayName: string;\r\n  states: string[];  // where they mainly operate\r\n  patterns: RegExp[]; // name/branding text in COA\r\n  parser: LabParser;\r\n  website?: string;\r\n};\r\n\r\nconst noopParser: LabParser = (text) => ({\r\n  contaminants: [],\r\n});\r\n\r\nexport const LAB_REGISTRY: LabRegistryEntry[] = [\r\n  {\r\n    slug: 'nova-analytic-labs',\r\n    displayName: 'Nova Analytic Labs',\r\n    states: ['ME'],\r\n    patterns: [/NOVA ANALYTIC LABS?/i],\r\n    parser: parseNovaAnalytic,\r\n    website: 'https://www.nova-analyticlabs.com/',\r\n  },\r\n  {\r\n    slug: 'mcr-labs',\r\n    displayName: 'MCR Labs',\r\n    states: ['MA', 'CT', 'PA'],\r\n    patterns: [/MCR LABS?/i],\r\n    parser: noopParser,\r\n    website: 'https://mcrlabs.com/',\r\n  },\r\n  {\r\n    slug: 'proverde-labs',\r\n    displayName: 'ProVerde Laboratories',\r\n    states: ['MA', 'ME'],\r\n    patterns: [/PROVERDE LAB/i],\r\n    parser: noopParser,\r\n    website: 'https://www.proverdelabs.com/',\r\n  },\r\n  {\r\n    slug: 'sc-labs',\r\n    displayName: 'SC Labs',\r\n    states: ['CA', 'CO', 'MI', 'OR', 'TX'],\r\n    patterns: [/SC LABS?/i],\r\n    parser: noopParser,\r\n    website: 'https://www.sclabs.com/',\r\n  },\r\n  {\r\n    slug: 'kaycha-labs',\r\n    displayName: 'Kaycha Labs',\r\n    states: ['FL', 'CA', 'MA', 'NY', 'CO', 'TN'],\r\n    patterns: [/KAYCHA LABS?/i],\r\n    parser: noopParser,\r\n    website: 'https://kaychalabs.com/',\r\n  },\r\n  {\r\n    slug: 'green-leaf-lab',\r\n    displayName: 'Green Leaf Lab',\r\n    states: ['OR', 'CA'],\r\n    patterns: [/GREEN LEAF LAB/i],\r\n    parser: noopParser,\r\n    website: 'https://www.greenleaflab.org/',\r\n  },\r\n  {\r\n    slug: 'confidence-analytics',\r\n    displayName: 'Confidence Analytics',\r\n    states: ['WA'],\r\n    patterns: [/CONFIDENCE ANALYTICS/i],\r\n    parser: noopParser,\r\n    website: 'https://www.confidenceanalytics.com/',\r\n  },\r\n  // Add new labs here as you get COA examples.\r\n];\r\n\r\nexport function findLabEntry(text: string): LabRegistryEntry | null {\r\n  for (const entry of LAB_REGISTRY) {\r\n    if (entry.patterns.some((re) => re.test(text))) {\r\n      return entry;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\nexport function parseCoa(text: string): ParsedCoa {\r\n  const entry = findLabEntry(text);\r\n\r\n  if (entry) {\r\n    const parsed = entry.parser(text);\r\n    if (parsed) {\r\n      return {\r\n        ...parsed,\r\n        labName: parsed.labName ?? entry.displayName,\r\n        labStateCode: parsed.labStateCode ?? entry.states[0],\r\n        contaminants: parsed.contaminants ?? [],\r\n      };\r\n    }\r\n  }\r\n\r\n  // Generic fallback parser (THC/CBD/Total Cannabinoids only)\r\n  const generic: ParsedCoa = {\r\n    contaminants: [],\r\n  };\r\n\r\n  const canonical = text.replace(/\\r\\n/g, '\\n');\r\n\r\n  const thcMatch =\r\n    canonical.match(/TOTAL\\s+THC[:\\s]+(\\d+(\\.\\d+)?)\\s*%/i) ||\r\n    canonical.match(/Δ-?9?[-\\s]*THC[:\\s]+(\\d+(\\.\\d+)?)\\s*%/i);\r\n  if (thcMatch) generic.thcPercent = parseFloat(thcMatch[1]);\r\n\r\n  const cbdMatch =\r\n    canonical.match(/TOTAL\\s+CBD[:\\s]+(\\d+(\\.\\d+)?)\\s*%/i) ||\r\n    canonical.match(/\\bCBD[:\\s]+(\\d+(\\.\\d+)?)\\s*%/i);\r\n  if (cbdMatch) generic.cbdPercent = parseFloat(cbdMatch[1]);\r\n\r\n  const totalCannMatch = canonical.match(\r\n    /TOTAL\\s+CANNABINOIDS?[:\\s]+(\\d+(\\.\\d+)?)\\s*%/i\r\n  );\r\n  if (totalCannMatch) {\r\n    generic.totalCannabinoidsPercent = parseFloat(totalCannMatch[1]);\r\n  }\r\n\r\n  return generic;\r\n}\r\n"],"names":[],"mappings":"AAAA,6BAA6B;;;;;;;;;AAE7B;;AAWA,MAAM,aAAwB,CAAC,OAAS,CAAC;QACvC,cAAc,EAAE;IAClB,CAAC;AAEM,MAAM,eAAmC;IAC9C;QACE,MAAM;QACN,aAAa;QACb,QAAQ;YAAC;SAAK;QACd,UAAU;YAAC;SAAuB;QAClC,QAAQ,+IAAiB;QACzB,SAAS;IACX;IACA;QACE,MAAM;QACN,aAAa;QACb,QAAQ;YAAC;YAAM;YAAM;SAAK;QAC1B,UAAU;YAAC;SAAa;QACxB,QAAQ;QACR,SAAS;IACX;IACA;QACE,MAAM;QACN,aAAa;QACb,QAAQ;YAAC;YAAM;SAAK;QACpB,UAAU;YAAC;SAAgB;QAC3B,QAAQ;QACR,SAAS;IACX;IACA;QACE,MAAM;QACN,aAAa;QACb,QAAQ;YAAC;YAAM;YAAM;YAAM;YAAM;SAAK;QACtC,UAAU;YAAC;SAAY;QACvB,QAAQ;QACR,SAAS;IACX;IACA;QACE,MAAM;QACN,aAAa;QACb,QAAQ;YAAC;YAAM;YAAM;YAAM;YAAM;YAAM;SAAK;QAC5C,UAAU;YAAC;SAAgB;QAC3B,QAAQ;QACR,SAAS;IACX;IACA;QACE,MAAM;QACN,aAAa;QACb,QAAQ;YAAC;YAAM;SAAK;QACpB,UAAU;YAAC;SAAkB;QAC7B,QAAQ;QACR,SAAS;IACX;IACA;QACE,MAAM;QACN,aAAa;QACb,QAAQ;YAAC;SAAK;QACd,UAAU;YAAC;SAAwB;QACnC,QAAQ;QACR,SAAS;IACX;CAED;AAEM,SAAS,aAAa,IAAY;IACvC,KAAK,MAAM,SAAS,aAAc;QAChC,IAAI,MAAM,QAAQ,CAAC,IAAI,CAAC,CAAC,KAAO,GAAG,IAAI,CAAC,QAAQ;YAC9C,OAAO;QACT;IACF;IACA,OAAO;AACT;AAEO,SAAS,SAAS,IAAY;IACnC,MAAM,QAAQ,aAAa;IAE3B,IAAI,OAAO;QACT,MAAM,SAAS,MAAM,MAAM,CAAC;QAC5B,IAAI,QAAQ;YACV,OAAO;gBACL,GAAG,MAAM;gBACT,SAAS,OAAO,OAAO,IAAI,MAAM,WAAW;gBAC5C,cAAc,OAAO,YAAY,IAAI,MAAM,MAAM,CAAC,EAAE;gBACpD,cAAc,OAAO,YAAY,IAAI,EAAE;YACzC;QACF;IACF;IAEA,4DAA4D;IAC5D,MAAM,UAAqB;QACzB,cAAc,EAAE;IAClB;IAEA,MAAM,YAAY,KAAK,OAAO,CAAC,SAAS;IAExC,MAAM,WACJ,UAAU,KAAK,CAAC,0CAChB,UAAU,KAAK,CAAC;IAClB,IAAI,UAAU,QAAQ,UAAU,GAAG,WAAW,QAAQ,CAAC,EAAE;IAEzD,MAAM,WACJ,UAAU,KAAK,CAAC,0CAChB,UAAU,KAAK,CAAC;IAClB,IAAI,UAAU,QAAQ,UAAU,GAAG,WAAW,QAAQ,CAAC,EAAE;IAEzD,MAAM,iBAAiB,UAAU,KAAK,CACpC;IAEF,IAAI,gBAAgB;QAClB,QAAQ,wBAAwB,GAAG,WAAW,cAAc,CAAC,EAAE;IACjE;IAEA,OAAO;AACT"}},
    {"offset": {"line": 331, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jesse/Documents/cartfax_complete_v2/pages/api/admin/uploads/index.ts"],"sourcesContent":["// pages/api/admin/uploads/index.ts\nimport type { NextApiRequest, NextApiResponse } from 'next';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '../auth/[...nextauth]';\nimport { PrismaClient } from '@prisma/client';\nimport multer from 'multer';\nimport pdfParse from 'pdf-parse';\nimport fs from 'fs/promises';\nimport path from 'path';\nimport crypto from 'crypto';\n\nimport { parseCoa } from '../../../../lib/coaParsers/registry';\n\nconst prisma = new PrismaClient();\n\n// Multer setup – use memory storage, we handle disk write ourselves\nconst upload = multer({ storage: multer.memoryStorage() });\n\n// Helper to run multer (or any middleware) in Next API route\nfunction runMiddleware(\n  req: NextApiRequest,\n  res: NextApiResponse,\n  fn: Function\n) {\n  return new Promise<void>((resolve, reject) => {\n    fn(req, res, (result: unknown) => {\n      if (result instanceof Error) return reject(result);\n      return resolve();\n    });\n  });\n}\n\nasync function handleGet(req: NextApiRequest, res: NextApiResponse) {\n  const docs = await prisma.uploadedDocument.findMany({\n    orderBy: { createdAt: 'desc' },\n    include: {\n      labResult: true,\n    },\n  });\n\n  res.status(200).json(docs);\n}\n\nasync function handlePost(req: NextApiRequest, res: NextApiResponse) {\n  await runMiddleware(req, res, upload.single('file'));\n\n  const file = (req as any).file as Express.Multer.File | undefined;\n  if (!file) {\n    res.status(400).json({ error: 'No file uploaded' });\n    return;\n  }\n\n  if (file.mimetype !== 'application/pdf') {\n    res.status(400).json({ error: 'Only PDF files are allowed' });\n    return;\n  }\n\n  const buffer = file.buffer;\n\n  // Compute SHA-256 to deduplicate uploads\n  const sha256 = crypto.createHash('sha256').update(buffer).digest('hex');\n\n  const existing = await prisma.uploadedDocument.findFirst({\n    where: { sha256 },\n    include: {\n      labResult: true,\n    },\n  });\n\n  if (existing) {\n    res.status(200).json({\n      reused: true,\n      document: existing,\n      labResult: existing.labResult ?? null,\n    });\n    return;\n  }\n\n  // Ensure uploads directory exists\n  const uploadDir = path.join(process.cwd(), 'uploads');\n  await fs.mkdir(uploadDir, { recursive: true });\n\n  const filePath = path.join(uploadDir, `${sha256}.pdf`);\n  await fs.writeFile(filePath, buffer);\n\n  // Extract text from PDF\n  let extractedText = '';\n  try {\n    const pdfData = await pdfParse(buffer);\n    extractedText = pdfData.text || '';\n  } catch (err) {\n    console.error('PDF parse failed', err);\n    extractedText = '';\n  }\n\n  // Parse COA text using our registry / lab-specific parser\n  const parsed = parseCoa(extractedText || '');\n\n  const batchCode = parsed.batchCode ?? null;\n  const labName = parsed.labName ?? null;\n\n  // Create UploadedDocument row\n  const document = await prisma.uploadedDocument.create({\n    data: {\n      fileName: file.originalname,\n      mimeType: file.mimetype,\n      size: file.size,\n      sha256,\n      filePath,\n      extractedText: extractedText || null,\n      batchCode,\n      labName,\n      verified: false,\n    },\n  });\n\n  let batch = null;\n  let labResult = null;\n  let lab = null;\n\n  if (batchCode) {\n    // 1) Ensure Lab row if we know labName\n    if (labName) {\n      lab = await prisma.lab.upsert({\n        where: { name: labName },\n        update: {\n          city: parsed.labCity ?? undefined,\n          stateCode: parsed.labStateCode ?? undefined,\n        },\n        create: {\n          name: labName,\n          city: parsed.labCity ?? undefined,\n          stateCode: parsed.labStateCode ?? undefined,\n        },\n      });\n    }\n\n    // 2) Ensure Batch row\n    batch = await prisma.batch.upsert({\n      where: { batchCode },\n      update: {\n        productName: parsed.productName ?? undefined,\n        jurisdiction: parsed.labStateCode ?? undefined,\n      },\n      create: {\n        batchCode,\n        productName: parsed.productName ?? null,\n        jurisdiction: parsed.labStateCode ?? null,\n        isActive: true,\n      },\n    });\n\n    // 3) Create LabResult linked to batch + doc (+ lab if known)\n    labResult = await prisma.labResult.create({\n      data: {\n        uploadedDocument: { connect: { id: document.id } },\n        batch: { connect: { id: batch.id } },\n        ...(lab\n          ? {\n              lab: { connect: { id: lab.id } },\n            }\n          : {}),\n        thcPercent: parsed.thcPercent ?? null,\n        cbdPercent: parsed.cbdPercent ?? null,\n        totalCannabinoidsPercent: parsed.totalCannabinoidsPercent ?? null,\n        passed: parsed.overallPass,\n      },\n    });\n\n    // 4) Link to a Location (LAB) for state map / drill-down\n    if (lab && parsed.labStateCode) {\n      let loc = await prisma.location.findFirst({\n        where: {\n          name: lab.name,\n          state: parsed.labStateCode,\n          type: 'LAB',\n        },\n      });\n\n      if (!loc) {\n        loc = await prisma.location.create({\n          data: {\n            name: lab.name,\n            type: 'LAB',\n            city: parsed.labCity ?? null,\n            state: parsed.labStateCode,\n          },\n        });\n      }\n\n      const existingLink = await prisma.batchLocation.findFirst({\n        where: {\n          batchId: batch.id,\n          locationId: loc.id,\n        },\n      });\n\n      if (!existingLink) {\n        await prisma.batchLocation.create({\n          data: {\n            batchId: batch.id,\n            locationId: loc.id,\n          },\n        });\n      }\n    }\n  }\n\n  res.status(200).json({\n    reused: false,\n    document,\n    batch,\n    labResult,\n  });\n}\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  const session = await getServerSession(req, res, authOptions);\n\n  // Restrict to admins\n  if (!session || (session.user as any)?.role !== 'ADMIN') {\n    res.status(401).json({ error: 'Unauthorized' });\n    return;\n  }\n\n  if (req.method === 'GET') {\n    await handleGet(req, res);\n    return;\n  }\n\n  if (req.method === 'POST') {\n    try {\n      await handlePost(req, res);\n    } catch (err) {\n      console.error('Error handling upload', err);\n      res.status(500).json({ error: 'Upload failed' });\n    }\n    return;\n  }\n\n  res.status(405).end();\n}\n\nexport const config = {\n  api: {\n    bodyParser: false,\n  },\n};\n"],"names":[],"mappings":"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"}}]
}