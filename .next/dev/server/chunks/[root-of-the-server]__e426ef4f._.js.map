{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jesse/Documents/cartfax_complete_v2/pages/api/auth/%5B...nextauth%5D.ts"],"sourcesContent":["import NextAuth, { NextAuthOptions } from 'next-auth';\r\nimport CredentialsProvider from 'next-auth/providers/credentials';\r\nimport { PrismaClient } from '@prisma/client';\r\nimport bcrypt from 'bcrypt';\r\n\r\nconst prisma = new PrismaClient();\r\n\r\nexport const authOptions: NextAuthOptions = {\r\n  session: { strategy: 'jwt' },\r\n  providers: [\r\n    CredentialsProvider({\r\n      name: 'Credentials',\r\n      credentials: {\r\n        email: { label: 'Email', type: 'email', placeholder: 'admin@example.com' },\r\n        password: { label: 'Password', type: 'password' },\r\n      },\r\n      async authorize(credentials) {\r\n        if (!credentials?.email || !credentials?.password) return null;\r\n\r\n        const user = await prisma.adminUser.findUnique({\r\n          where: { email: credentials.email },\r\n        });\r\n        if (!user) return null;\r\n\r\n        const ok = await bcrypt.compare(credentials.password, user.password);\r\n        if (!ok) return null;\r\n\r\n        return {\r\n          id: user.id.toString(),\r\n          email: user.email,\r\n          name: user.name || undefined,\r\n          role: user.role,\r\n        } as any;\r\n      },\r\n    }),\r\n  ],\r\n  callbacks: {\r\n    async jwt({ token, user }) {\r\n      if (user) {\r\n        token.role = (user as any).role ?? 'admin';\r\n        token.id = (user as any).id ?? token.id;\r\n      }\r\n      return token;\r\n    },\r\n    async session({ session, token }) {\r\n      (session as any).user = session.user ?? {};\r\n      (session as any).user.role = token.role;\r\n      (session as any).user.id = token.id;\r\n      return session;\r\n    },\r\n  },\r\n  secret: process.env.NEXTAUTH_SECRET,\r\n};\r\n\r\nexport default NextAuth(authOptions);\r\n\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;;;;AAEA,MAAM,SAAS,IAAI,6IAAY;AAExB,MAAM,cAA+B;IAC1C,SAAS;QAAE,UAAU;IAAM;IAC3B,WAAW;QACT,IAAA,oLAAmB,EAAC;YAClB,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;oBAAS,aAAa;gBAAoB;gBACzE,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW;gBACzB,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU,OAAO;gBAE1D,MAAM,OAAO,MAAM,OAAO,SAAS,CAAC,UAAU,CAAC;oBAC7C,OAAO;wBAAE,OAAO,YAAY,KAAK;oBAAC;gBACpC;gBACA,IAAI,CAAC,MAAM,OAAO;gBAElB,MAAM,KAAK,MAAM,gHAAM,CAAC,OAAO,CAAC,YAAY,QAAQ,EAAE,KAAK,QAAQ;gBACnE,IAAI,CAAC,IAAI,OAAO;gBAEhB,OAAO;oBACL,IAAI,KAAK,EAAE,CAAC,QAAQ;oBACpB,OAAO,KAAK,KAAK;oBACjB,MAAM,KAAK,IAAI,IAAI;oBACnB,MAAM,KAAK,IAAI;gBACjB;YACF;QACF;KACD;IACD,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,IAAI,MAAM;gBACR,MAAM,IAAI,GAAG,AAAC,KAAa,IAAI,IAAI;gBACnC,MAAM,EAAE,GAAG,AAAC,KAAa,EAAE,IAAI,MAAM,EAAE;YACzC;YACA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC7B,QAAgB,IAAI,GAAG,QAAQ,IAAI,IAAI,CAAC;YACxC,QAAgB,IAAI,CAAC,IAAI,GAAG,MAAM,IAAI;YACtC,QAAgB,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;YACnC,OAAO;QACT;IACF;IACA,QAAQ,QAAQ,GAAG,CAAC,eAAe;AACrC;uCAEe,IAAA,4HAAQ,EAAC"}},
    {"offset": {"line": 120, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jesse/Documents/cartfax_complete_v2/lib/parsers/nova.ts"],"sourcesContent":["export type NovaParsed = {\r\n  labName: string;\r\n  batchCode: string | null;\r\n  thcPercent: number | null;\r\n  cbdPercent: number | null;\r\n  totalCannabinoidsPercent: number | null;\r\n  moisturePercent: number | null;\r\n  waterActivity: number | null;\r\n  pesticidesPass: boolean | null;\r\n  microbialsPass: boolean | null;\r\n  heavyMetalsPass: boolean | null;\r\n};\r\n\r\nexport function isNovaLabsCoa(text: string): boolean {\r\n  // Key identity markers for Nova Analytic Labs\r\n  return (\r\n    /NOVA ANALYTIC LABS/i.test(text) ||\r\n    /nova-analyticlabs\\.com/i.test(text) ||\r\n    /NOVA ANALYTIC LABS\\s*\\/\\/\\s*65 MILLIKEN STREET/i.test(text)\r\n  );\r\n}\r\n\r\nfunction matchNumber(re: RegExp, text: string): number | null {\r\n  const m = text.match(re);\r\n  if (!m || !m[1]) return null;\r\n  const v = parseFloat(m[1].replace(',', ''));\r\n  return Number.isNaN(v) ? null : v;\r\n}\r\n\r\nexport function parseNovaLabsCoa(text: string): NovaParsed {\r\n  const labName = 'Nova Analytic Labs';\r\n\r\n  // From line: CLIENT: NOVA - PT ACCOUNT // BATCH: FAIL\r\n  const batchMatch = text.match(/BATCH:\\s*([A-Za-z0-9\\-]+)/i);\r\n  const batchCode = batchMatch ? batchMatch[1].trim() : null;\r\n\r\n  // Δ-THC or TOTAL THC\r\n  const thcPercent =\r\n    matchNumber(/Δ-THC[:\\s]+(\\d+(?:\\.\\d+)?)\\s*%/i, text) ??\r\n    matchNumber(/TOTAL THC\\s*([\\d.]+)\\s*%/i, text);\r\n\r\n  // CBD often ND in this example; leave null unless a % is found\r\n  const cbdPercent = matchNumber(/CBD[:\\s]+(\\d+(?:\\.\\d+)?)\\s*%/i, text);\r\n\r\n  // TOTAL CANNABINOIDS:29.1 %\r\n  const totalCannabinoidsPercent = matchNumber(\r\n    /TOTAL CANNABINOIDS[:\\s]+([\\d.]+)\\s*%/i,\r\n    text\r\n  );\r\n\r\n  // Moisture line: MOISTURE9.000.0100/0.0100N/A  => 9.00 %\r\n  const moisturePercent = matchNumber(\r\n    /MOISTURE\\s*([\\d.]+)\\s*%?/i,\r\n    text\r\n  );\r\n\r\n  // Water activity: WATER ACTIVITY0.65 Aw0.54...\r\n  const waterActivity = matchNumber(\r\n    /WATER ACTIVITY\\s*([\\d.]+)\\s*Aw/i,\r\n    text\r\n  );\r\n\r\n  // Summary flags at top: PESTICIDESFAIL, MICROBIALFAIL, METALSPASS\r\n  const pesticidesFail = /PESTICIDESFAIL/i.test(text);\r\n  const microbialsFail = /MICROBIALFAIL/i.test(text);\r\n  const metalsPass = /METALSPASS/i.test(text);\r\n\r\n  return {\r\n    labName,\r\n    batchCode,\r\n    thcPercent,\r\n    cbdPercent,\r\n    totalCannabinoidsPercent,\r\n    moisturePercent,\r\n    waterActivity,\r\n    pesticidesPass: pesticidesFail ? false : null,\r\n    microbialsPass: microbialsFail ? false : null,\r\n    heavyMetalsPass: metalsPass ? true : null,\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;;;AAaO,SAAS,cAAc,IAAY;IACxC,8CAA8C;IAC9C,OACE,sBAAsB,IAAI,CAAC,SAC3B,0BAA0B,IAAI,CAAC,SAC/B,kDAAkD,IAAI,CAAC;AAE3D;AAEA,SAAS,YAAY,EAAU,EAAE,IAAY;IAC3C,MAAM,IAAI,KAAK,KAAK,CAAC;IACrB,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,EAAE,OAAO;IACxB,MAAM,IAAI,WAAW,CAAC,CAAC,EAAE,CAAC,OAAO,CAAC,KAAK;IACvC,OAAO,OAAO,KAAK,CAAC,KAAK,OAAO;AAClC;AAEO,SAAS,iBAAiB,IAAY;IAC3C,MAAM,UAAU;IAEhB,sDAAsD;IACtD,MAAM,aAAa,KAAK,KAAK,CAAC;IAC9B,MAAM,YAAY,aAAa,UAAU,CAAC,EAAE,CAAC,IAAI,KAAK;IAEtD,qBAAqB;IACrB,MAAM,aACJ,YAAY,mCAAmC,SAC/C,YAAY,6BAA6B;IAE3C,+DAA+D;IAC/D,MAAM,aAAa,YAAY,iCAAiC;IAEhE,4BAA4B;IAC5B,MAAM,2BAA2B,YAC/B,yCACA;IAGF,yDAAyD;IACzD,MAAM,kBAAkB,YACtB,6BACA;IAGF,+CAA+C;IAC/C,MAAM,gBAAgB,YACpB,mCACA;IAGF,kEAAkE;IAClE,MAAM,iBAAiB,kBAAkB,IAAI,CAAC;IAC9C,MAAM,iBAAiB,iBAAiB,IAAI,CAAC;IAC7C,MAAM,aAAa,cAAc,IAAI,CAAC;IAEtC,OAAO;QACL;QACA;QACA;QACA;QACA;QACA;QACA;QACA,gBAAgB,iBAAiB,QAAQ;QACzC,gBAAgB,iBAAiB,QAAQ;QACzC,iBAAiB,aAAa,OAAO;IACvC;AACF"}},
    {"offset": {"line": 172, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jesse/Documents/cartfax_complete_v2/lib/parsers/index.ts"],"sourcesContent":["import { isNovaLabsCoa, parseNovaLabsCoa, NovaParsed } from './nova';\r\n\r\nexport type LabSpecificParsed = NovaParsed & {\r\n  // In future we can extend with labSlug or extra fields per lab\r\n};\r\n\r\nexport function parseWithLabSpecificParsers(\r\n  text: string\r\n): LabSpecificParsed | null {\r\n  // Nova Analytic Labs\r\n  if (isNovaLabsCoa(text)) {\r\n    return parseNovaLabsCoa(text);\r\n  }\r\n\r\n  // future: more labs here\r\n\r\n  return null;\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAMO,SAAS,4BACd,IAAY;IAEZ,qBAAqB;IACrB,IAAI,IAAA,gIAAa,EAAC,OAAO;QACvB,OAAO,IAAA,mIAAgB,EAAC;IAC1B;IAEA,yBAAyB;IAEzB,OAAO;AACT"}},
    {"offset": {"line": 220, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jesse/Documents/cartfax_complete_v2/pages/api/admin/uploads.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from 'next';\r\nimport { PrismaClient } from '@prisma/client';\r\nimport { getServerSession } from 'next-auth/next';\r\nimport { authOptions } from '../auth/[...nextauth]';\r\nimport { parseWithLabSpecificParsers } from '../../../lib/parsers';\r\n\r\n\r\n// @ts-ignore - multer types are optional\r\nimport multer from 'multer';\r\n// @ts-ignore - pdf-parse types are optional\r\nimport pdfParse from 'pdf-parse';\r\n\r\nimport fs from 'fs';\r\nimport path from 'path';\r\nimport crypto from 'crypto';\r\n\r\nconst prisma = new PrismaClient();\r\n\r\n// -------------------- Auth helper --------------------\r\n\r\nasync function requireAdmin(req: any, res: any) {\r\n  const session = await getServerSession(req, res, authOptions as any);\r\n  if (!session || (session.user as any).role !== 'admin') {\r\n    res.status(403).json({ error: 'forbidden' });\r\n    return null;\r\n  }\r\n  return session;\r\n}\r\n\r\n// -------------------- Multer setup --------------------\r\n\r\nconst uploadDir = path.join(process.cwd(), 'uploads', 'coa');\r\n\r\nif (!fs.existsSync(uploadDir)) {\r\n  fs.mkdirSync(uploadDir, { recursive: true });\r\n}\r\n\r\nconst storage = multer.diskStorage({\r\n  destination: (_req, _file, cb) => {\r\n    cb(null, uploadDir);\r\n  },\r\n  filename: (_req, file, cb) => {\r\n    const timestamp = Date.now();\r\n    const safeName = file.originalname.replace(/[^\\w\\-.]+/g, '_');\r\n    cb(null, `${timestamp}-${safeName}`);\r\n  },\r\n});\r\n\r\nconst upload = multer({\r\n  storage,\r\n  fileFilter: (_req, file, cb) => {\r\n    if (file.mimetype !== 'application/pdf') {\r\n      return cb(new Error('Only PDF files are allowed'));\r\n    }\r\n    cb(null, true);\r\n  },\r\n});\r\n\r\nfunction runMiddleware(\r\n  req: NextApiRequest,\r\n  res: NextApiResponse,\r\n  fn: any\r\n): Promise<void> {\r\n  return new Promise((resolve, reject) => {\r\n    fn(req as any, res as any, (result: any) => {\r\n      if (result instanceof Error) return reject(result);\r\n      return resolve(result);\r\n    });\r\n  });\r\n}\r\n\r\n// -------------------- Simple parsers --------------------\r\n\r\ntype ParsedCoaSummary = {\r\n  batchCode?: string | null;\r\n  labName?: string | null;\r\n  thcPercent?: number | null;\r\n  cbdPercent?: number | null;\r\n  totalCannabinoidsPercent?: number | null;\r\n};\r\n\r\nfunction extractBatchCode(text: string): string | null {\r\n  const patterns = [\r\n    // Batch / Lot style labels\r\n    /Batch(?:\\s*(?:ID|Number|No\\.?)?)?\\s*[:#]\\s*([A-Za-z0-9\\-]+)/i,\r\n    /Lot(?:\\s*(?:ID|Number|No\\.?)?)?\\s*[:#]\\s*([A-Za-z0-9\\-]+)/i,\r\n\r\n    // METRC / Package tags that look like 1A4000XXXXXXX\r\n    /(METRC|Package|Tag)\\s*(?:ID|Number|No\\.?)?\\s*[:#]?\\s*([A-Z0-9\\-]{6,})/i,\r\n\r\n    // “Batch … XXXXXX” style\r\n    /Batch\\s+([A-Za-z0-9\\-]{4,})/i,\r\n    /Lot\\s+([A-Za-z0-9\\-]{4,})/i,\r\n  ];\r\n\r\n  for (const p of patterns) {\r\n    const m = text.match(p);\r\n    if (m) {\r\n      const candidate = m[2] || m[1];\r\n      if (candidate) return candidate.trim();\r\n    }\r\n  }\r\n\r\n  // Fallback heuristic: find a line containing \"Batch\" or \"Lot\" and grab a code-like token\r\n  const lines = text.split(/\\r?\\n/);\r\n  for (const line of lines) {\r\n    if (/Batch|Lot|METRC|Package/i.test(line)) {\r\n      const tokens = line.split(/[\\s,]+/);\r\n      for (const t of tokens) {\r\n        if (/[A-Za-z0-9]/.test(t) && t.replace(/[^A-Za-z0-9]/g, '').length >= 4) {\r\n          return t.replace(/[^\\w\\-]/g, '');\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nfunction parseCoaSummary(text: string): ParsedCoaSummary {\r\n  const batchCode = extractBatchCode(text);\r\n  const labName = extractLabName(text);\r\n\r\n  // Basic THC / CBD / Total detection\r\n  let thcPercent =\r\n    extractPercent(/THC[^%\\n\\r]*?(\\d+(?:\\.\\d+)?)\\s*%/i, text) ?? null;\r\n  let cbdPercent =\r\n    extractPercent(/CBD[^%\\n\\r]*?(\\d+(?:\\.\\d+)?)\\s*%/i, text) ?? null;\r\n  let totalCannabinoidsPercent =\r\n    extractPercent(\r\n      /(Total\\s+(?:Cannabinoids|Active Cannabinoids)[^%\\n\\r]*?)(\\d+(?:\\.\\d+)?)\\s*%/i,\r\n      text\r\n    ) ?? null;\r\n\r\n  // If totalCannabinoids isn't explicit, approximate as THC + CBD when both are present\r\n  if (totalCannabinoidsPercent == null && thcPercent != null && cbdPercent != null) {\r\n    totalCannabinoidsPercent = thcPercent + cbdPercent;\r\n  }\r\n\r\n  return {\r\n    batchCode,\r\n    labName,\r\n    thcPercent,\r\n    cbdPercent,\r\n    totalCannabinoidsPercent,\r\n  };\r\n}\r\n\r\n\r\nfunction extractLabName(text: string): string | null {\r\n  // Very naive: take the first non-empty line; many labs put their name at top\r\n  const lines = text.split(/\\r?\\n/).map((l) => l.trim()).filter(Boolean);\r\n  if (lines.length === 0) return null;\r\n  const first = lines[0];\r\n  if (first.length > 3 && first.length < 120) return first;\r\n  return null;\r\n}\r\n\r\nfunction extractPercent(label: RegExp, text: string): number | null {\r\n  const m = text.match(label);\r\n  if (!m) return null;\r\n  const numStr = m[1];\r\n  const val = parseFloat(numStr);\r\n  if (Number.isNaN(val)) return null;\r\n  return val;\r\n}\r\n\r\n\r\nasync function hashFile(filePath: string): Promise<string> {\r\n  const hash = crypto.createHash('sha256');\r\n  const stream = fs.createReadStream(filePath);\r\n\r\n  return new Promise((resolve, reject) => {\r\n    stream.on('data', (data) => hash.update(data));\r\n    stream.on('end', () => resolve(hash.digest('hex')));\r\n    stream.on('error', (err) => reject(err));\r\n  });\r\n}\r\n\r\n// -------------------- Handler --------------------\r\n\r\nexport default async function handler(\r\n  req: NextApiRequest,\r\n  res: NextApiResponse\r\n) {\r\n  const session = await requireAdmin(req, res);\r\n  if (!session) return;\r\n\r\n  if (req.method === 'GET') {\r\n    const docs = await prisma.uploadedDocument.findMany({\r\n      orderBy: { createdAt: 'desc' },\r\n      include: {\r\n        labResult: true,\r\n      },\r\n    });\r\n    return res.json(docs);\r\n  }\r\n\r\n  if (req.method === 'POST') {\r\n    try {\r\n      await runMiddleware(req, res, upload.single('file'));\r\n\r\n      const file = (req as any).file as Express.Multer.File | undefined;\r\n      if (!file) {\r\n        return res.status(400).json({ error: 'No file uploaded' });\r\n      }\r\n\r\n      // Compute SHA-256\r\n      const sha256 = await hashFile(file.path);\r\n\r\n      // If we already saw this file, reuse DB record\r\n      const existing = await prisma.uploadedDocument.findUnique({\r\n        where: { sha256 },\r\n        include: { labResult: true },\r\n      });\r\n\r\n      if (existing) {\r\n        // Clean up duplicate on disk\r\n        try {\r\n          fs.unlinkSync(file.path);\r\n        } catch (_) {\r\n          // ignore\r\n        }\r\n\r\n        return res.json({\r\n          reused: true,\r\n          document: existing,\r\n        });\r\n      }\r\n\r\n      // Extract text from PDF\r\n            const dataBuffer = fs.readFileSync(file.path);\r\n      const pdfData = await pdfParse(dataBuffer);\r\n      const text = pdfData.text || '';\r\n\r\n      // 1) Try lab-specific parser first\r\n      const labParsed = parseWithLabSpecificParsers(text);\r\n\r\n      // 2) Fallback to generic parser\r\n      const genericParsed = parseCoaSummary(text);\r\n\r\n      const effective = {\r\n        batchCode: labParsed?.batchCode ?? genericParsed.batchCode ?? null,\r\n        labName: labParsed?.labName ?? genericParsed.labName ?? null,\r\n        thcPercent: labParsed?.thcPercent ?? genericParsed.thcPercent ?? null,\r\n        cbdPercent: labParsed?.cbdPercent ?? genericParsed.cbdPercent ?? null,\r\n        totalCannabinoidsPercent:\r\n          labParsed?.totalCannabinoidsPercent ??\r\n          genericParsed.totalCannabinoidsPercent ??\r\n          null,\r\n        moisturePercent: labParsed?.moisturePercent ?? null,\r\n        waterActivity: labParsed?.waterActivity ?? null,\r\n        pesticidesPass: labParsed?.pesticidesPass ?? null,\r\n        microbialsPass: labParsed?.microbialsPass ?? null,\r\n        heavyMetalsPass: labParsed?.heavyMetalsPass ?? null,\r\n      };\r\n\r\n      // Store relative file path so it's portable\r\n      const relativePath = path.relative(process.cwd(), file.path);\r\n\r\n\r\n      // Create UploadedDocument\r\n      const uploaderEmail =\r\n        (session.user as any)?.email || (session.user as any)?.name || null;\r\n\r\n            const uploadedDoc = await prisma.uploadedDocument.create({\r\n        data: {\r\n          filePath: relativePath,\r\n          fileName: file.originalname,\r\n          mimeType: file.mimetype,\r\n          size: file.size,\r\n          sha256,\r\n          extractedText: text,\r\n          labName: effective.labName,\r\n          batchCode: effective.batchCode,\r\n          uploader: uploaderEmail,\r\n          verified: false,\r\n        },\r\n      });\r\n\r\n\r\n      // Optionally: auto-create Batch + LabResult if we detected a batch code\r\n      let createdLabResult = null;\r\n\r\n            if (effective.batchCode) {\r\n        // Find or create a Batch by batchCode (very basic for now)\r\n        const existingBatch = await prisma.batch.findFirst({\r\n          where: { batchCode: effective.batchCode },\r\n        });\r\n\r\n        const batch =\r\n          existingBatch ||\r\n          (await prisma.batch.create({\r\n            data: {\r\n              batchCode: effective.batchCode,\r\n              isActive: true,\r\n            },\r\n          }));\r\n\r\n        createdLabResult = await prisma.labResult.create({\r\n          data: {\r\n            batchId: batch.id,\r\n            labId: null, // later: map labName -> Lab entity\r\n            testedAt: null,\r\n            reportedAt: null,\r\n            thcPercent: effective.thcPercent,\r\n            cbdPercent: effective.cbdPercent,\r\n            totalCannabinoidsPercent:\r\n              effective.totalCannabinoidsPercent,\r\n            passed: null, // could infer overall later\r\n            pesticidesPass: effective.pesticidesPass,\r\n            solventsPass: null,\r\n            heavyMetalsPass: effective.heavyMetalsPass,\r\n            microbialsPass: effective.microbialsPass,\r\n            moisturePercent: effective.moisturePercent,\r\n            waterActivity: effective.waterActivity,\r\n            analyteSummary: null,\r\n            rawJson: null,\r\n            sourcePdfUrl: null,\r\n            uploadedDocumentId: uploadedDoc.id,\r\n          },\r\n        });\r\n      }\r\n\r\n\r\n      return res.json({\r\n        reused: false,\r\n        document: uploadedDoc,\r\n        labResult: createdLabResult,\r\n      });\r\n    } catch (err: any) {\r\n      console.error('COA upload error', err);\r\n      return res\r\n        .status(500)\r\n        .json({ error: err?.message || 'Upload failed' });\r\n    }\r\n  }\r\n\r\n  res.status(405).end();\r\n}\r\n\r\nexport const config = {\r\n  api: {\r\n    bodyParser: false, // required for multer\r\n  },\r\n};\r\n"],"names":[],"mappings":"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"}}]
}