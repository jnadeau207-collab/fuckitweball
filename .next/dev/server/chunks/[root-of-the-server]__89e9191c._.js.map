{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jesse/Documents/cartfax_complete_v2/pages/api/auth/%5B...nextauth%5D.ts"],"sourcesContent":["import NextAuth, { NextAuthOptions } from 'next-auth';\nimport CredentialsProvider from 'next-auth/providers/credentials';\nimport { PrismaClient } from '@prisma/client';\nimport bcrypt from 'bcrypt';\n\nconst prisma = new PrismaClient();\n\nexport const authOptions: NextAuthOptions = {\n  session: { strategy: 'jwt' },\n  providers: [\n    CredentialsProvider({\n      name: 'Credentials',\n      credentials: {\n        email: {\n          label: 'Email',\n          type: 'email',\n          placeholder: 'admin@example.com',\n        },\n        password: { label: 'Password', type: 'password' },\n      },\n      async authorize(credentials) {\n        if (!credentials?.email || !credentials?.password) return null;\n\n        const user = await prisma.adminUser.findUnique({\n          where: { email: credentials.email },\n        });\n        if (!user) return null;\n\n        const ok = await bcrypt.compare(credentials.password, user.password);\n        if (!ok) return null;\n\n        return {\n          id: user.id.toString(),\n          email: user.email,\n          name: user.name || undefined,\n          role: user.role,\n        } as any;\n      },\n    }),\n  ],\n  callbacks: {\n    async jwt({ token, user }) {\n      if (user) {\n        token.role = (user as any).role ?? 'admin';\n        token.id = (user as any).id ?? token.id;\n      }\n      return token;\n    },\n    async session({ session, token }) {\n      (session as any).user = session.user ?? {};\n      (session as any).user.role = token.role;\n      (session as any).user.id = token.id;\n      return session;\n    },\n  },\n  secret: process.env.NEXTAUTH_SECRET,\n};\n\nexport default NextAuth(authOptions);\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;;;;AAEA,MAAM,SAAS,IAAI,6IAAY;AAExB,MAAM,cAA+B;IAC1C,SAAS;QAAE,UAAU;IAAM;IAC3B,WAAW;QACT,IAAA,oLAAmB,EAAC;YAClB,MAAM;YACN,aAAa;gBACX,OAAO;oBACL,OAAO;oBACP,MAAM;oBACN,aAAa;gBACf;gBACA,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW;gBACzB,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU,OAAO;gBAE1D,MAAM,OAAO,MAAM,OAAO,SAAS,CAAC,UAAU,CAAC;oBAC7C,OAAO;wBAAE,OAAO,YAAY,KAAK;oBAAC;gBACpC;gBACA,IAAI,CAAC,MAAM,OAAO;gBAElB,MAAM,KAAK,MAAM,gHAAM,CAAC,OAAO,CAAC,YAAY,QAAQ,EAAE,KAAK,QAAQ;gBACnE,IAAI,CAAC,IAAI,OAAO;gBAEhB,OAAO;oBACL,IAAI,KAAK,EAAE,CAAC,QAAQ;oBACpB,OAAO,KAAK,KAAK;oBACjB,MAAM,KAAK,IAAI,IAAI;oBACnB,MAAM,KAAK,IAAI;gBACjB;YACF;QACF;KACD;IACD,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,IAAI,MAAM;gBACR,MAAM,IAAI,GAAG,AAAC,KAAa,IAAI,IAAI;gBACnC,MAAM,EAAE,GAAG,AAAC,KAAa,EAAE,IAAI,MAAM,EAAE;YACzC;YACA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC7B,QAAgB,IAAI,GAAG,QAAQ,IAAI,IAAI,CAAC;YACxC,QAAgB,IAAI,CAAC,IAAI,GAAG,MAAM,IAAI;YACtC,QAAgB,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;YACnC,OAAO;QACT;IACF;IACA,QAAQ,QAAQ,GAAG,CAAC,eAAe;AACrC;uCAEe,IAAA,4HAAQ,EAAC"}},
    {"offset": {"line": 120, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jesse/Documents/cartfax_complete_v2/pages/api/admin/batches/%5Bid%5D.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from 'next';\nimport { PrismaClient } from '@prisma/client';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '../../auth/[...nextauth]';\n\nconst prisma = new PrismaClient();\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse,\n) {\n  const session = await getServerSession(req, res, authOptions as any);\n\n  if (!session || (session.user as any).role !== 'admin') {\n    return res.status(403).json({ error: 'forbidden' });\n  }\n\n  if (req.method !== 'GET') {\n    return res.status(405).end();\n  }\n\n  const { id } = req.query;\n  const idNum = Number(id);\n\n  if (!id || Number.isNaN(idNum)) {\n    return res.status(400).json({ error: 'invalid id' });\n  }\n\n  try {\n    const batch = await prisma.batch.findUnique({\n      where: { id: idNum },\n      include: {\n        brand: true,\n        labResults: {\n          orderBy: { createdAt: 'desc' },\n          include: {\n            lab: true,\n            uploadedDocument: true,\n          },\n        },\n        // If you later add real relations for these, you can include them here:\n        // locations: { include: { location: true } },\n        // verifications: true,\n        // recalls: true,\n        // ratingSources: true,\n      },\n    });\n\n    if (!batch) {\n      return res.status(404).json({ error: 'not found' });\n    }\n\n    // Map Prisma model â†’ shape expected by your BatchDetail type\n    const response = {\n      id: batch.id,\n      batchCode: batch.batchCode,\n      productName: batch.productName ?? null,\n      productSku: (batch as any).productSku ?? (batch as any).sku ?? null,\n      primaryCategory:\n        (batch as any).primaryCategory ?? batch.productCategory ?? null,\n      subCategory:\n        (batch as any).subCategory ?? batch.productSubcategory ?? null,\n      brand: batch.brand\n        ? {\n            id: batch.brand.id,\n            name: batch.brand.name,\n          }\n        : null,\n      harvestDate: (batch as any).harvestDate\n        ? (batch as any).harvestDate.toISOString()\n        : null,\n      productionDate: (batch as any).productionDate\n        ? (batch as any).productionDate.toISOString()\n        : null,\n      packageDate: (batch as any).packageDate\n        ? (batch as any).packageDate.toISOString()\n        : null,\n      expirationDate: (batch as any).expirationDate\n        ? (batch as any).expirationDate.toISOString()\n        : null,\n      isActive: batch.isActive,\n      notes: (batch as any).notes ?? null,\n\n      // These are future features; for now we return null/empty to keep the UI happy\n      reviewAggregate: null,\n      ratingSources: [] as any[],\n      locations: [] as any[],\n      verifications: [] as any[],\n      recalls: [] as any[],\n\n      labResults: batch.labResults.map((lr) => ({\n        id: lr.id,\n        testedAt: lr.testedAt ? lr.testedAt.toISOString() : null,\n        reportedAt: lr.reportedAt ? lr.reportedAt.toISOString() : null,\n        thcPercent: lr.thcPercent,\n        cbdPercent: lr.cbdPercent,\n        totalCannabinoidsPercent: lr.totalCannabinoidsPercent,\n        passed: lr.passed,\n        lab: lr.lab\n          ? {\n              id: lr.lab.id,\n              name: lr.lab.name,\n            }\n          : null,\n        uploadedDocument: lr.uploadedDocument\n          ? {\n              id: lr.uploadedDocument.id,\n              fileName: lr.uploadedDocument.fileName,\n            }\n          : null,\n      })),\n    };\n\n    return res.json(response);\n  } catch (e: any) {\n    console.error('Failed to fetch batch detail', e);\n    return res\n      .status(500)\n      .json({ error: e?.message || 'Failed to fetch batch detail' });\n  }\n}\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;;;;AAEA,MAAM,SAAS,IAAI,6IAAY;AAEhB,eAAe,QAC5B,GAAmB,EACnB,GAAoB;IAEpB,MAAM,UAAU,MAAM,IAAA,qJAAgB,EAAC,KAAK,KAAK,kJAAW;IAE5D,IAAI,CAAC,WAAW,AAAC,QAAQ,IAAI,CAAS,IAAI,KAAK,SAAS;QACtD,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAY;IACnD;IAEA,IAAI,IAAI,MAAM,KAAK,OAAO;QACxB,OAAO,IAAI,MAAM,CAAC,KAAK,GAAG;IAC5B;IAEA,MAAM,EAAE,EAAE,EAAE,GAAG,IAAI,KAAK;IACxB,MAAM,QAAQ,OAAO;IAErB,IAAI,CAAC,MAAM,OAAO,KAAK,CAAC,QAAQ;QAC9B,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAa;IACpD;IAEA,IAAI;QACF,MAAM,QAAQ,MAAM,OAAO,KAAK,CAAC,UAAU,CAAC;YAC1C,OAAO;gBAAE,IAAI;YAAM;YACnB,SAAS;gBACP,OAAO;gBACP,YAAY;oBACV,SAAS;wBAAE,WAAW;oBAAO;oBAC7B,SAAS;wBACP,KAAK;wBACL,kBAAkB;oBACpB;gBACF;YAMF;QACF;QAEA,IAAI,CAAC,OAAO;YACV,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAAY;QACnD;QAEA,6DAA6D;QAC7D,MAAM,WAAW;YACf,IAAI,MAAM,EAAE;YACZ,WAAW,MAAM,SAAS;YAC1B,aAAa,MAAM,WAAW,IAAI;YAClC,YAAY,AAAC,MAAc,UAAU,IAAI,AAAC,MAAc,GAAG,IAAI;YAC/D,iBACE,AAAC,MAAc,eAAe,IAAI,MAAM,eAAe,IAAI;YAC7D,aACE,AAAC,MAAc,WAAW,IAAI,MAAM,kBAAkB,IAAI;YAC5D,OAAO,MAAM,KAAK,GACd;gBACE,IAAI,MAAM,KAAK,CAAC,EAAE;gBAClB,MAAM,MAAM,KAAK,CAAC,IAAI;YACxB,IACA;YACJ,aAAa,AAAC,MAAc,WAAW,GACnC,AAAC,MAAc,WAAW,CAAC,WAAW,KACtC;YACJ,gBAAgB,AAAC,MAAc,cAAc,GACzC,AAAC,MAAc,cAAc,CAAC,WAAW,KACzC;YACJ,aAAa,AAAC,MAAc,WAAW,GACnC,AAAC,MAAc,WAAW,CAAC,WAAW,KACtC;YACJ,gBAAgB,AAAC,MAAc,cAAc,GACzC,AAAC,MAAc,cAAc,CAAC,WAAW,KACzC;YACJ,UAAU,MAAM,QAAQ;YACxB,OAAO,AAAC,MAAc,KAAK,IAAI;YAE/B,+EAA+E;YAC/E,iBAAiB;YACjB,eAAe,EAAE;YACjB,WAAW,EAAE;YACb,eAAe,EAAE;YACjB,SAAS,EAAE;YAEX,YAAY,MAAM,UAAU,CAAC,GAAG,CAAC,CAAC,KAAO,CAAC;oBACxC,IAAI,GAAG,EAAE;oBACT,UAAU,GAAG,QAAQ,GAAG,GAAG,QAAQ,CAAC,WAAW,KAAK;oBACpD,YAAY,GAAG,UAAU,GAAG,GAAG,UAAU,CAAC,WAAW,KAAK;oBAC1D,YAAY,GAAG,UAAU;oBACzB,YAAY,GAAG,UAAU;oBACzB,0BAA0B,GAAG,wBAAwB;oBACrD,QAAQ,GAAG,MAAM;oBACjB,KAAK,GAAG,GAAG,GACP;wBACE,IAAI,GAAG,GAAG,CAAC,EAAE;wBACb,MAAM,GAAG,GAAG,CAAC,IAAI;oBACnB,IACA;oBACJ,kBAAkB,GAAG,gBAAgB,GACjC;wBACE,IAAI,GAAG,gBAAgB,CAAC,EAAE;wBAC1B,UAAU,GAAG,gBAAgB,CAAC,QAAQ;oBACxC,IACA;gBACN,CAAC;QACH;QAEA,OAAO,IAAI,IAAI,CAAC;IAClB,EAAE,OAAO,GAAQ;QACf,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO,IACJ,MAAM,CAAC,KACP,IAAI,CAAC;YAAE,OAAO,GAAG,WAAW;QAA+B;IAChE;AACF"}}]
}