{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jesse/Documents/cartfax_complete_v2/pages/api/auth/%5B...nextauth%5D.ts"],"sourcesContent":["import NextAuth, { NextAuthOptions } from 'next-auth';\r\nimport CredentialsProvider from 'next-auth/providers/credentials';\r\nimport { PrismaClient } from '@prisma/client';\r\nimport bcrypt from 'bcrypt';\r\n\r\nconst prisma = new PrismaClient();\r\n\r\nexport const authOptions: NextAuthOptions = {\r\n  session: { strategy: 'jwt' },\r\n  providers: [\r\n    CredentialsProvider({\r\n      name: 'Credentials',\r\n      credentials: {\r\n        email: { label: 'Email', type: 'email', placeholder: 'admin@example.com' },\r\n        password: { label: 'Password', type: 'password' },\r\n      },\r\n      async authorize(credentials) {\r\n        if (!credentials?.email || !credentials?.password) return null;\r\n\r\n        const user = await prisma.adminUser.findUnique({\r\n          where: { email: credentials.email },\r\n        });\r\n        if (!user) return null;\r\n\r\n        const ok = await bcrypt.compare(credentials.password, user.password);\r\n        if (!ok) return null;\r\n\r\n        return {\r\n          id: user.id.toString(),\r\n          email: user.email,\r\n          name: user.name || undefined,\r\n          role: user.role,\r\n        } as any;\r\n      },\r\n    }),\r\n  ],\r\n  callbacks: {\r\n    async jwt({ token, user }) {\r\n      if (user) {\r\n        token.role = (user as any).role ?? 'admin';\r\n        token.id = (user as any).id ?? token.id;\r\n      }\r\n      return token;\r\n    },\r\n    async session({ session, token }) {\r\n      (session as any).user = session.user ?? {};\r\n      (session as any).user.role = token.role;\r\n      (session as any).user.id = token.id;\r\n      return session;\r\n    },\r\n  },\r\n  secret: process.env.NEXTAUTH_SECRET,\r\n};\r\n\r\nexport default NextAuth(authOptions);\r\n\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;;;;AAEA,MAAM,SAAS,IAAI,6IAAY;AAExB,MAAM,cAA+B;IAC1C,SAAS;QAAE,UAAU;IAAM;IAC3B,WAAW;QACT,IAAA,oLAAmB,EAAC;YAClB,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;oBAAS,aAAa;gBAAoB;gBACzE,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW;gBACzB,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU,OAAO;gBAE1D,MAAM,OAAO,MAAM,OAAO,SAAS,CAAC,UAAU,CAAC;oBAC7C,OAAO;wBAAE,OAAO,YAAY,KAAK;oBAAC;gBACpC;gBACA,IAAI,CAAC,MAAM,OAAO;gBAElB,MAAM,KAAK,MAAM,gHAAM,CAAC,OAAO,CAAC,YAAY,QAAQ,EAAE,KAAK,QAAQ;gBACnE,IAAI,CAAC,IAAI,OAAO;gBAEhB,OAAO;oBACL,IAAI,KAAK,EAAE,CAAC,QAAQ;oBACpB,OAAO,KAAK,KAAK;oBACjB,MAAM,KAAK,IAAI,IAAI;oBACnB,MAAM,KAAK,IAAI;gBACjB;YACF;QACF;KACD;IACD,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,IAAI,MAAM;gBACR,MAAM,IAAI,GAAG,AAAC,KAAa,IAAI,IAAI;gBACnC,MAAM,EAAE,GAAG,AAAC,KAAa,EAAE,IAAI,MAAM,EAAE;YACzC;YACA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC7B,QAAgB,IAAI,GAAG,QAAQ,IAAI,IAAI,CAAC;YACxC,QAAgB,IAAI,CAAC,IAAI,GAAG,MAAM,IAAI;YACtC,QAAgB,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;YACnC,OAAO;QACT;IACF;IACA,QAAQ,QAAQ,GAAG,CAAC,eAAe;AACrC;uCAEe,IAAA,4HAAQ,EAAC"}},
    {"offset": {"line": 120, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Jesse/Documents/cartfax_complete_v2/pages/api/admin/batches/%5Bid%5D.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from 'next';\r\nimport { PrismaClient } from '@prisma/client';\r\nimport { getServerSession } from 'next-auth/next';\r\nimport { authOptions } from '../../auth/[...nextauth]';\r\n\r\nconst prisma = new PrismaClient();\r\n\r\nexport default async function handler(\r\n  req: NextApiRequest,\r\n  res: NextApiResponse\r\n) {\r\n  const session = await getServerSession(req, res, authOptions as any);\r\n\r\n  if (!session || (session.user as any).role !== 'admin') {\r\n    return res.status(403).json({ error: 'forbidden' });\r\n  }\r\n\r\n  if (req.method !== 'GET') {\r\n    return res.status(405).end();\r\n  }\r\n\r\n  const { id } = req.query;\r\n  const idNum = Number(id);\r\n\r\n  if (!id || Number.isNaN(idNum)) {\r\n    return res.status(400).json({ error: 'invalid id' });\r\n  }\r\n\r\n  try {\r\n    const batch = await prisma.batch.findUnique({\r\n      where: { id: idNum },\r\n      include: {\r\n        brand: true,\r\n        labResults: {\r\n          orderBy: { createdAt: 'desc' },\r\n          include: {\r\n            lab: true,\r\n            uploadedDocument: true,\r\n          },\r\n        },\r\n        // If you later add real relations for these, you can include them here:\r\n        // locations: { include: { location: true } },\r\n        // verifications: true,\r\n        // recalls: true,\r\n        // ratingSources: true,\r\n      },\r\n    });\r\n\r\n    if (!batch) {\r\n      return res.status(404).json({ error: 'not found' });\r\n    }\r\n\r\n    // Map Prisma model â†’ shape expected by your BatchDetail type\r\n    const response = {\r\n      id: batch.id,\r\n      batchCode: batch.batchCode,\r\n      productName: batch.productName ?? null,\r\n      productSku: (batch as any).productSku ?? (batch as any).sku ?? null,\r\n      primaryCategory:\r\n        (batch as any).primaryCategory ?? batch.productCategory ?? null,\r\n      subCategory:\r\n        (batch as any).subCategory ?? batch.productSubcategory ?? null,\r\n      brand: batch.brand\r\n        ? {\r\n            id: batch.brand.id,\r\n            name: batch.brand.name,\r\n          }\r\n        : null,\r\n      harvestDate: (batch as any).harvestDate\r\n        ? (batch as any).harvestDate.toISOString()\r\n        : null,\r\n      productionDate: (batch as any).productionDate\r\n        ? (batch as any).productionDate.toISOString()\r\n        : null,\r\n      packageDate: (batch as any).packageDate\r\n        ? (batch as any).packageDate.toISOString()\r\n        : null,\r\n      expirationDate: (batch as any).expirationDate\r\n        ? (batch as any).expirationDate.toISOString()\r\n        : null,\r\n      isActive: batch.isActive,\r\n      notes: (batch as any).notes ?? null,\r\n\r\n      // These are future features; for now we return null/empty to keep the UI happy\r\n      reviewAggregate: null,\r\n      ratingSources: [] as any[],\r\n      locations: [] as any[],\r\n      verifications: [] as any[],\r\n      recalls: [] as any[],\r\n\r\n      labResults: batch.labResults.map((lr) => ({\r\n        id: lr.id,\r\n        testedAt: lr.testedAt ? lr.testedAt.toISOString() : null,\r\n        reportedAt: lr.reportedAt ? lr.reportedAt.toISOString() : null,\r\n        thcPercent: lr.thcPercent,\r\n        cbdPercent: lr.cbdPercent,\r\n        totalCannabinoidsPercent: lr.totalCannabinoidsPercent,\r\n        passed: lr.passed,\r\n        lab: lr.lab\r\n          ? {\r\n              id: lr.lab.id,\r\n              name: lr.lab.name,\r\n            }\r\n          : null,\r\n        uploadedDocument: lr.uploadedDocument\r\n          ? {\r\n              id: lr.uploadedDocument.id,\r\n              fileName: lr.uploadedDocument.fileName,\r\n            }\r\n          : null,\r\n      })),\r\n    };\r\n\r\n    return res.json(response);\r\n  } catch (e: any) {\r\n    console.error('Failed to fetch batch detail', e);\r\n    return res\r\n      .status(500)\r\n      .json({ error: e?.message || 'Failed to fetch batch detail' });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}