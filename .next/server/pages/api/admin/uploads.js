"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/admin/uploads";
exports.ids = ["pages/api/admin/uploads"];
exports.modules = {

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@prisma/client");

/***/ }),

/***/ "bcrypt":
/*!*************************!*\
  !*** external "bcrypt" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("bcrypt");

/***/ }),

/***/ "multer":
/*!*************************!*\
  !*** external "multer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("multer");

/***/ }),

/***/ "next-auth":
/*!****************************!*\
  !*** external "next-auth" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("next-auth");

/***/ }),

/***/ "next-auth/next":
/*!*********************************!*\
  !*** external "next-auth/next" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("next-auth/next");

/***/ }),

/***/ "next-auth/providers/credentials":
/*!**************************************************!*\
  !*** external "next-auth/providers/credentials" ***!
  \**************************************************/
/***/ ((module) => {

module.exports = require("next-auth/providers/credentials");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "pdf-parse":
/*!****************************!*\
  !*** external "pdf-parse" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("pdf-parse");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fadmin%2Fuploads&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cadmin%5Cuploads.ts&middlewareConfigBase64=e30%3D!":
/*!************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fadmin%2Fuploads&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cadmin%5Cuploads.ts&middlewareConfigBase64=e30%3D! ***!
  \************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_admin_uploads_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\admin\\uploads.ts */ \"(api)/./pages/api/admin/uploads.ts\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_admin_uploads_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_admin_uploads_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/admin/uploads\",\n        pathname: \"/api/admin/uploads\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_admin_uploads_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmFkbWluJTJGdXBsb2FkcyZwcmVmZXJyZWRSZWdpb249JmFic29sdXRlUGFnZVBhdGg9LiUyRnBhZ2VzJTVDYXBpJTVDYWRtaW4lNUN1cGxvYWRzLnRzJm1pZGRsZXdhcmVDb25maWdCYXNlNjQ9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNMO0FBQzFEO0FBQzREO0FBQzVEO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQyx3REFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMsd0RBQVE7QUFDcEM7QUFDTyx3QkFBd0IsZ0hBQW1CO0FBQ2xEO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixDQUFDOztBQUVEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY2FydGZheC8/ODY3YyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vcGFnZXNcXFxcYXBpXFxcXGFkbWluXFxcXHVwbG9hZHMudHNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9hZG1pbi91cGxvYWRzXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvYWRtaW4vdXBsb2Fkc1wiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcIlwiXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fadmin%2Fuploads&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cadmin%5Cuploads.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./lib/parsers/index.ts":
/*!******************************!*\
  !*** ./lib/parsers/index.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   parseWithLabSpecificParsers: () => (/* binding */ parseWithLabSpecificParsers)\n/* harmony export */ });\n/* harmony import */ var _nova__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./nova */ \"(api)/./lib/parsers/nova.ts\");\n\nfunction parseWithLabSpecificParsers(text) {\n    // Nova Analytic Labs\n    if ((0,_nova__WEBPACK_IMPORTED_MODULE_0__.isNovaLabsCoa)(text)) {\n        return (0,_nova__WEBPACK_IMPORTED_MODULE_0__.parseNovaLabsCoa)(text);\n    }\n    // future: more labs here\n    return null;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvcGFyc2Vycy9pbmRleC50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUFxRTtBQU05RCxTQUFTRSw0QkFDZEMsSUFBWTtJQUVaLHFCQUFxQjtJQUNyQixJQUFJSCxvREFBYUEsQ0FBQ0csT0FBTztRQUN2QixPQUFPRix1REFBZ0JBLENBQUNFO0lBQzFCO0lBRUEseUJBQXlCO0lBRXpCLE9BQU87QUFDVCIsInNvdXJjZXMiOlsid2VicGFjazovL2NhcnRmYXgvLi9saWIvcGFyc2Vycy9pbmRleC50cz82YmEyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGlzTm92YUxhYnNDb2EsIHBhcnNlTm92YUxhYnNDb2EsIE5vdmFQYXJzZWQgfSBmcm9tICcuL25vdmEnO1xyXG5cclxuZXhwb3J0IHR5cGUgTGFiU3BlY2lmaWNQYXJzZWQgPSBOb3ZhUGFyc2VkICYge1xyXG4gIC8vIEluIGZ1dHVyZSB3ZSBjYW4gZXh0ZW5kIHdpdGggbGFiU2x1ZyBvciBleHRyYSBmaWVsZHMgcGVyIGxhYlxyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlV2l0aExhYlNwZWNpZmljUGFyc2VycyhcclxuICB0ZXh0OiBzdHJpbmdcclxuKTogTGFiU3BlY2lmaWNQYXJzZWQgfCBudWxsIHtcclxuICAvLyBOb3ZhIEFuYWx5dGljIExhYnNcclxuICBpZiAoaXNOb3ZhTGFic0NvYSh0ZXh0KSkge1xyXG4gICAgcmV0dXJuIHBhcnNlTm92YUxhYnNDb2EodGV4dCk7XHJcbiAgfVxyXG5cclxuICAvLyBmdXR1cmU6IG1vcmUgbGFicyBoZXJlXHJcblxyXG4gIHJldHVybiBudWxsO1xyXG59XHJcbiJdLCJuYW1lcyI6WyJpc05vdmFMYWJzQ29hIiwicGFyc2VOb3ZhTGFic0NvYSIsInBhcnNlV2l0aExhYlNwZWNpZmljUGFyc2VycyIsInRleHQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./lib/parsers/index.ts\n");

/***/ }),

/***/ "(api)/./lib/parsers/nova.ts":
/*!*****************************!*\
  !*** ./lib/parsers/nova.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   isNovaLabsCoa: () => (/* binding */ isNovaLabsCoa),\n/* harmony export */   parseNovaLabsCoa: () => (/* binding */ parseNovaLabsCoa)\n/* harmony export */ });\nfunction isNovaLabsCoa(text) {\n    // Key identity markers for Nova Analytic Labs\n    return /NOVA ANALYTIC LABS/i.test(text) || /nova-analyticlabs\\.com/i.test(text) || /NOVA ANALYTIC LABS\\s*\\/\\/\\s*65 MILLIKEN STREET/i.test(text);\n}\nfunction matchNumber(re, text) {\n    const m = text.match(re);\n    if (!m || !m[1]) return null;\n    const v = parseFloat(m[1].replace(\",\", \"\"));\n    return Number.isNaN(v) ? null : v;\n}\nfunction parseNovaLabsCoa(text) {\n    const labName = \"Nova Analytic Labs\";\n    // From line: CLIENT: NOVA - PT ACCOUNT // BATCH: FAIL\n    const batchMatch = text.match(/BATCH:\\s*([A-Za-z0-9\\-]+)/i);\n    const batchCode = batchMatch ? batchMatch[1].trim() : null;\n    // Δ-THC or TOTAL THC\n    const thcPercent = matchNumber(/Δ-THC[:\\s]+(\\d+(?:\\.\\d+)?)\\s*%/i, text) ?? matchNumber(/TOTAL THC\\s*([\\d.]+)\\s*%/i, text);\n    // CBD often ND in this example; leave null unless a % is found\n    const cbdPercent = matchNumber(/CBD[:\\s]+(\\d+(?:\\.\\d+)?)\\s*%/i, text);\n    // TOTAL CANNABINOIDS:29.1 %\n    const totalCannabinoidsPercent = matchNumber(/TOTAL CANNABINOIDS[:\\s]+([\\d.]+)\\s*%/i, text);\n    // Moisture line: MOISTURE9.000.0100/0.0100N/A  => 9.00 %\n    const moisturePercent = matchNumber(/MOISTURE\\s*([\\d.]+)\\s*%?/i, text);\n    // Water activity: WATER ACTIVITY0.65 Aw0.54...\n    const waterActivity = matchNumber(/WATER ACTIVITY\\s*([\\d.]+)\\s*Aw/i, text);\n    // Summary flags at top: PESTICIDESFAIL, MICROBIALFAIL, METALSPASS\n    const pesticidesFail = /PESTICIDESFAIL/i.test(text);\n    const microbialsFail = /MICROBIALFAIL/i.test(text);\n    const metalsPass = /METALSPASS/i.test(text);\n    return {\n        labName,\n        batchCode,\n        thcPercent,\n        cbdPercent,\n        totalCannabinoidsPercent,\n        moisturePercent,\n        waterActivity,\n        pesticidesPass: pesticidesFail ? false : null,\n        microbialsPass: microbialsFail ? false : null,\n        heavyMetalsPass: metalsPass ? true : null\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvcGFyc2Vycy9ub3ZhLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBYU8sU0FBU0EsY0FBY0MsSUFBWTtJQUN4Qyw4Q0FBOEM7SUFDOUMsT0FDRSxzQkFBc0JDLElBQUksQ0FBQ0QsU0FDM0IsMEJBQTBCQyxJQUFJLENBQUNELFNBQy9CLGtEQUFrREMsSUFBSSxDQUFDRDtBQUUzRDtBQUVBLFNBQVNFLFlBQVlDLEVBQVUsRUFBRUgsSUFBWTtJQUMzQyxNQUFNSSxJQUFJSixLQUFLSyxLQUFLLENBQUNGO0lBQ3JCLElBQUksQ0FBQ0MsS0FBSyxDQUFDQSxDQUFDLENBQUMsRUFBRSxFQUFFLE9BQU87SUFDeEIsTUFBTUUsSUFBSUMsV0FBV0gsQ0FBQyxDQUFDLEVBQUUsQ0FBQ0ksT0FBTyxDQUFDLEtBQUs7SUFDdkMsT0FBT0MsT0FBT0MsS0FBSyxDQUFDSixLQUFLLE9BQU9BO0FBQ2xDO0FBRU8sU0FBU0ssaUJBQWlCWCxJQUFZO0lBQzNDLE1BQU1ZLFVBQVU7SUFFaEIsc0RBQXNEO0lBQ3RELE1BQU1DLGFBQWFiLEtBQUtLLEtBQUssQ0FBQztJQUM5QixNQUFNUyxZQUFZRCxhQUFhQSxVQUFVLENBQUMsRUFBRSxDQUFDRSxJQUFJLEtBQUs7SUFFdEQscUJBQXFCO0lBQ3JCLE1BQU1DLGFBQ0pkLFlBQVksbUNBQW1DRixTQUMvQ0UsWUFBWSw2QkFBNkJGO0lBRTNDLCtEQUErRDtJQUMvRCxNQUFNaUIsYUFBYWYsWUFBWSxpQ0FBaUNGO0lBRWhFLDRCQUE0QjtJQUM1QixNQUFNa0IsMkJBQTJCaEIsWUFDL0IseUNBQ0FGO0lBR0YseURBQXlEO0lBQ3pELE1BQU1tQixrQkFBa0JqQixZQUN0Qiw2QkFDQUY7SUFHRiwrQ0FBK0M7SUFDL0MsTUFBTW9CLGdCQUFnQmxCLFlBQ3BCLG1DQUNBRjtJQUdGLGtFQUFrRTtJQUNsRSxNQUFNcUIsaUJBQWlCLGtCQUFrQnBCLElBQUksQ0FBQ0Q7SUFDOUMsTUFBTXNCLGlCQUFpQixpQkFBaUJyQixJQUFJLENBQUNEO0lBQzdDLE1BQU11QixhQUFhLGNBQWN0QixJQUFJLENBQUNEO0lBRXRDLE9BQU87UUFDTFk7UUFDQUU7UUFDQUU7UUFDQUM7UUFDQUM7UUFDQUM7UUFDQUM7UUFDQUksZ0JBQWdCSCxpQkFBaUIsUUFBUTtRQUN6Q0ksZ0JBQWdCSCxpQkFBaUIsUUFBUTtRQUN6Q0ksaUJBQWlCSCxhQUFhLE9BQU87SUFDdkM7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2NhcnRmYXgvLi9saWIvcGFyc2Vycy9ub3ZhLnRzPzBjMjYiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IHR5cGUgTm92YVBhcnNlZCA9IHtcclxuICBsYWJOYW1lOiBzdHJpbmc7XHJcbiAgYmF0Y2hDb2RlOiBzdHJpbmcgfCBudWxsO1xyXG4gIHRoY1BlcmNlbnQ6IG51bWJlciB8IG51bGw7XHJcbiAgY2JkUGVyY2VudDogbnVtYmVyIHwgbnVsbDtcclxuICB0b3RhbENhbm5hYmlub2lkc1BlcmNlbnQ6IG51bWJlciB8IG51bGw7XHJcbiAgbW9pc3R1cmVQZXJjZW50OiBudW1iZXIgfCBudWxsO1xyXG4gIHdhdGVyQWN0aXZpdHk6IG51bWJlciB8IG51bGw7XHJcbiAgcGVzdGljaWRlc1Bhc3M6IGJvb2xlYW4gfCBudWxsO1xyXG4gIG1pY3JvYmlhbHNQYXNzOiBib29sZWFuIHwgbnVsbDtcclxuICBoZWF2eU1ldGFsc1Bhc3M6IGJvb2xlYW4gfCBudWxsO1xyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGlzTm92YUxhYnNDb2EodGV4dDogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgLy8gS2V5IGlkZW50aXR5IG1hcmtlcnMgZm9yIE5vdmEgQW5hbHl0aWMgTGFic1xyXG4gIHJldHVybiAoXHJcbiAgICAvTk9WQSBBTkFMWVRJQyBMQUJTL2kudGVzdCh0ZXh0KSB8fFxyXG4gICAgL25vdmEtYW5hbHl0aWNsYWJzXFwuY29tL2kudGVzdCh0ZXh0KSB8fFxyXG4gICAgL05PVkEgQU5BTFlUSUMgTEFCU1xccypcXC9cXC9cXHMqNjUgTUlMTElLRU4gU1RSRUVUL2kudGVzdCh0ZXh0KVxyXG4gICk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG1hdGNoTnVtYmVyKHJlOiBSZWdFeHAsIHRleHQ6IHN0cmluZyk6IG51bWJlciB8IG51bGwge1xyXG4gIGNvbnN0IG0gPSB0ZXh0Lm1hdGNoKHJlKTtcclxuICBpZiAoIW0gfHwgIW1bMV0pIHJldHVybiBudWxsO1xyXG4gIGNvbnN0IHYgPSBwYXJzZUZsb2F0KG1bMV0ucmVwbGFjZSgnLCcsICcnKSk7XHJcbiAgcmV0dXJuIE51bWJlci5pc05hTih2KSA/IG51bGwgOiB2O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VOb3ZhTGFic0NvYSh0ZXh0OiBzdHJpbmcpOiBOb3ZhUGFyc2VkIHtcclxuICBjb25zdCBsYWJOYW1lID0gJ05vdmEgQW5hbHl0aWMgTGFicyc7XHJcblxyXG4gIC8vIEZyb20gbGluZTogQ0xJRU5UOiBOT1ZBIC0gUFQgQUNDT1VOVCAvLyBCQVRDSDogRkFJTFxyXG4gIGNvbnN0IGJhdGNoTWF0Y2ggPSB0ZXh0Lm1hdGNoKC9CQVRDSDpcXHMqKFtBLVphLXowLTlcXC1dKykvaSk7XHJcbiAgY29uc3QgYmF0Y2hDb2RlID0gYmF0Y2hNYXRjaCA/IGJhdGNoTWF0Y2hbMV0udHJpbSgpIDogbnVsbDtcclxuXHJcbiAgLy8gzpQtVEhDIG9yIFRPVEFMIFRIQ1xyXG4gIGNvbnN0IHRoY1BlcmNlbnQgPVxyXG4gICAgbWF0Y2hOdW1iZXIoL86ULVRIQ1s6XFxzXSsoXFxkKyg/OlxcLlxcZCspPylcXHMqJS9pLCB0ZXh0KSA/P1xyXG4gICAgbWF0Y2hOdW1iZXIoL1RPVEFMIFRIQ1xccyooW1xcZC5dKylcXHMqJS9pLCB0ZXh0KTtcclxuXHJcbiAgLy8gQ0JEIG9mdGVuIE5EIGluIHRoaXMgZXhhbXBsZTsgbGVhdmUgbnVsbCB1bmxlc3MgYSAlIGlzIGZvdW5kXHJcbiAgY29uc3QgY2JkUGVyY2VudCA9IG1hdGNoTnVtYmVyKC9DQkRbOlxcc10rKFxcZCsoPzpcXC5cXGQrKT8pXFxzKiUvaSwgdGV4dCk7XHJcblxyXG4gIC8vIFRPVEFMIENBTk5BQklOT0lEUzoyOS4xICVcclxuICBjb25zdCB0b3RhbENhbm5hYmlub2lkc1BlcmNlbnQgPSBtYXRjaE51bWJlcihcclxuICAgIC9UT1RBTCBDQU5OQUJJTk9JRFNbOlxcc10rKFtcXGQuXSspXFxzKiUvaSxcclxuICAgIHRleHRcclxuICApO1xyXG5cclxuICAvLyBNb2lzdHVyZSBsaW5lOiBNT0lTVFVSRTkuMDAwLjAxMDAvMC4wMTAwTi9BICA9PiA5LjAwICVcclxuICBjb25zdCBtb2lzdHVyZVBlcmNlbnQgPSBtYXRjaE51bWJlcihcclxuICAgIC9NT0lTVFVSRVxccyooW1xcZC5dKylcXHMqJT8vaSxcclxuICAgIHRleHRcclxuICApO1xyXG5cclxuICAvLyBXYXRlciBhY3Rpdml0eTogV0FURVIgQUNUSVZJVFkwLjY1IEF3MC41NC4uLlxyXG4gIGNvbnN0IHdhdGVyQWN0aXZpdHkgPSBtYXRjaE51bWJlcihcclxuICAgIC9XQVRFUiBBQ1RJVklUWVxccyooW1xcZC5dKylcXHMqQXcvaSxcclxuICAgIHRleHRcclxuICApO1xyXG5cclxuICAvLyBTdW1tYXJ5IGZsYWdzIGF0IHRvcDogUEVTVElDSURFU0ZBSUwsIE1JQ1JPQklBTEZBSUwsIE1FVEFMU1BBU1NcclxuICBjb25zdCBwZXN0aWNpZGVzRmFpbCA9IC9QRVNUSUNJREVTRkFJTC9pLnRlc3QodGV4dCk7XHJcbiAgY29uc3QgbWljcm9iaWFsc0ZhaWwgPSAvTUlDUk9CSUFMRkFJTC9pLnRlc3QodGV4dCk7XHJcbiAgY29uc3QgbWV0YWxzUGFzcyA9IC9NRVRBTFNQQVNTL2kudGVzdCh0ZXh0KTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIGxhYk5hbWUsXHJcbiAgICBiYXRjaENvZGUsXHJcbiAgICB0aGNQZXJjZW50LFxyXG4gICAgY2JkUGVyY2VudCxcclxuICAgIHRvdGFsQ2FubmFiaW5vaWRzUGVyY2VudCxcclxuICAgIG1vaXN0dXJlUGVyY2VudCxcclxuICAgIHdhdGVyQWN0aXZpdHksXHJcbiAgICBwZXN0aWNpZGVzUGFzczogcGVzdGljaWRlc0ZhaWwgPyBmYWxzZSA6IG51bGwsXHJcbiAgICBtaWNyb2JpYWxzUGFzczogbWljcm9iaWFsc0ZhaWwgPyBmYWxzZSA6IG51bGwsXHJcbiAgICBoZWF2eU1ldGFsc1Bhc3M6IG1ldGFsc1Bhc3MgPyB0cnVlIDogbnVsbCxcclxuICB9O1xyXG59XHJcbiJdLCJuYW1lcyI6WyJpc05vdmFMYWJzQ29hIiwidGV4dCIsInRlc3QiLCJtYXRjaE51bWJlciIsInJlIiwibSIsIm1hdGNoIiwidiIsInBhcnNlRmxvYXQiLCJyZXBsYWNlIiwiTnVtYmVyIiwiaXNOYU4iLCJwYXJzZU5vdmFMYWJzQ29hIiwibGFiTmFtZSIsImJhdGNoTWF0Y2giLCJiYXRjaENvZGUiLCJ0cmltIiwidGhjUGVyY2VudCIsImNiZFBlcmNlbnQiLCJ0b3RhbENhbm5hYmlub2lkc1BlcmNlbnQiLCJtb2lzdHVyZVBlcmNlbnQiLCJ3YXRlckFjdGl2aXR5IiwicGVzdGljaWRlc0ZhaWwiLCJtaWNyb2JpYWxzRmFpbCIsIm1ldGFsc1Bhc3MiLCJwZXN0aWNpZGVzUGFzcyIsIm1pY3JvYmlhbHNQYXNzIiwiaGVhdnlNZXRhbHNQYXNzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/parsers/nova.ts\n");

/***/ }),

/***/ "(api)/./pages/api/admin/uploads.ts":
/*!************************************!*\
  !*** ./pages/api/admin/uploads.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_auth_next__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next-auth/next */ \"next-auth/next\");\n/* harmony import */ var next_auth_next__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(next_auth_next__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _auth_nextauth___WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../auth/[...nextauth] */ \"(api)/./pages/api/auth/[...nextauth].ts\");\n/* harmony import */ var _lib_parsers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../lib/parsers */ \"(api)/./lib/parsers/index.ts\");\n/* harmony import */ var multer__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! multer */ \"multer\");\n/* harmony import */ var multer__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(multer__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var pdf_parse__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! pdf-parse */ \"pdf-parse\");\n/* harmony import */ var pdf_parse__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(pdf_parse__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_6__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_7__);\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_8__);\n\n\n\n\n// @ts-ignore - multer types are optional\n\n// @ts-ignore - pdf-parse types are optional\n\n\n\n\nconst prisma = new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient();\n// -------------------- Auth helper --------------------\nasync function requireAdmin(req, res) {\n    const session = await (0,next_auth_next__WEBPACK_IMPORTED_MODULE_1__.getServerSession)(req, res, _auth_nextauth___WEBPACK_IMPORTED_MODULE_2__.authOptions);\n    if (!session || session.user.role !== \"admin\") {\n        res.status(403).json({\n            error: \"forbidden\"\n        });\n        return null;\n    }\n    return session;\n}\n// -------------------- Multer setup --------------------\nconst uploadDir = path__WEBPACK_IMPORTED_MODULE_7___default().join(process.cwd(), \"uploads\", \"coa\");\nif (!fs__WEBPACK_IMPORTED_MODULE_6___default().existsSync(uploadDir)) {\n    fs__WEBPACK_IMPORTED_MODULE_6___default().mkdirSync(uploadDir, {\n        recursive: true\n    });\n}\nconst storage = multer__WEBPACK_IMPORTED_MODULE_4___default().diskStorage({\n    destination: (_req, _file, cb)=>{\n        cb(null, uploadDir);\n    },\n    filename: (_req, file, cb)=>{\n        const timestamp = Date.now();\n        const safeName = file.originalname.replace(/[^\\w\\-.]+/g, \"_\");\n        cb(null, `${timestamp}-${safeName}`);\n    }\n});\nconst upload = multer__WEBPACK_IMPORTED_MODULE_4___default()({\n    storage,\n    fileFilter: (_req, file, cb)=>{\n        if (file.mimetype !== \"application/pdf\") {\n            return cb(new Error(\"Only PDF files are allowed\"));\n        }\n        cb(null, true);\n    }\n});\nfunction runMiddleware(req, res, fn) {\n    return new Promise((resolve, reject)=>{\n        fn(req, res, (result)=>{\n            if (result instanceof Error) return reject(result);\n            return resolve(result);\n        });\n    });\n}\nfunction extractBatchCode(text) {\n    const patterns = [\n        // Batch / Lot style labels\n        /Batch(?:\\s*(?:ID|Number|No\\.?)?)?\\s*[:#]\\s*([A-Za-z0-9\\-]+)/i,\n        /Lot(?:\\s*(?:ID|Number|No\\.?)?)?\\s*[:#]\\s*([A-Za-z0-9\\-]+)/i,\n        // METRC / Package tags that look like 1A4000XXXXXXX\n        /(METRC|Package|Tag)\\s*(?:ID|Number|No\\.?)?\\s*[:#]?\\s*([A-Z0-9\\-]{6,})/i,\n        // “Batch … XXXXXX” style\n        /Batch\\s+([A-Za-z0-9\\-]{4,})/i,\n        /Lot\\s+([A-Za-z0-9\\-]{4,})/i\n    ];\n    for (const p of patterns){\n        const m = text.match(p);\n        if (m) {\n            const candidate = m[2] || m[1];\n            if (candidate) return candidate.trim();\n        }\n    }\n    // Fallback heuristic: find a line containing \"Batch\" or \"Lot\" and grab a code-like token\n    const lines = text.split(/\\r?\\n/);\n    for (const line of lines){\n        if (/Batch|Lot|METRC|Package/i.test(line)) {\n            const tokens = line.split(/[\\s,]+/);\n            for (const t of tokens){\n                if (/[A-Za-z0-9]/.test(t) && t.replace(/[^A-Za-z0-9]/g, \"\").length >= 4) {\n                    return t.replace(/[^\\w\\-]/g, \"\");\n                }\n            }\n        }\n    }\n    return null;\n}\nfunction parseCoaSummary(text) {\n    const batchCode = extractBatchCode(text);\n    const labName = extractLabName(text);\n    // Basic THC / CBD / Total detection\n    let thcPercent = extractPercent(/THC[^%\\n\\r]*?(\\d+(?:\\.\\d+)?)\\s*%/i, text) ?? null;\n    let cbdPercent = extractPercent(/CBD[^%\\n\\r]*?(\\d+(?:\\.\\d+)?)\\s*%/i, text) ?? null;\n    let totalCannabinoidsPercent = extractPercent(/(Total\\s+(?:Cannabinoids|Active Cannabinoids)[^%\\n\\r]*?)(\\d+(?:\\.\\d+)?)\\s*%/i, text) ?? null;\n    // If totalCannabinoids isn't explicit, approximate as THC + CBD when both are present\n    if (totalCannabinoidsPercent == null && thcPercent != null && cbdPercent != null) {\n        totalCannabinoidsPercent = thcPercent + cbdPercent;\n    }\n    return {\n        batchCode,\n        labName,\n        thcPercent,\n        cbdPercent,\n        totalCannabinoidsPercent\n    };\n}\nfunction extractLabName(text) {\n    // Very naive: take the first non-empty line; many labs put their name at top\n    const lines = text.split(/\\r?\\n/).map((l)=>l.trim()).filter(Boolean);\n    if (lines.length === 0) return null;\n    const first = lines[0];\n    if (first.length > 3 && first.length < 120) return first;\n    return null;\n}\nfunction extractPercent(label, text) {\n    const m = text.match(label);\n    if (!m) return null;\n    const numStr = m[1];\n    const val = parseFloat(numStr);\n    if (Number.isNaN(val)) return null;\n    return val;\n}\nasync function hashFile(filePath) {\n    const hash = crypto__WEBPACK_IMPORTED_MODULE_8___default().createHash(\"sha256\");\n    const stream = fs__WEBPACK_IMPORTED_MODULE_6___default().createReadStream(filePath);\n    return new Promise((resolve, reject)=>{\n        stream.on(\"data\", (data)=>hash.update(data));\n        stream.on(\"end\", ()=>resolve(hash.digest(\"hex\")));\n        stream.on(\"error\", (err)=>reject(err));\n    });\n}\n// -------------------- Handler --------------------\nasync function handler(req, res) {\n    const session = await requireAdmin(req, res);\n    if (!session) return;\n    if (req.method === \"GET\") {\n        const docs = await prisma.uploadedDocument.findMany({\n            orderBy: {\n                createdAt: \"desc\"\n            },\n            include: {\n                labResult: true\n            }\n        });\n        return res.json(docs);\n    }\n    if (req.method === \"POST\") {\n        try {\n            await runMiddleware(req, res, upload.single(\"file\"));\n            const file = req.file;\n            if (!file) {\n                return res.status(400).json({\n                    error: \"No file uploaded\"\n                });\n            }\n            // Compute SHA-256\n            const sha256 = await hashFile(file.path);\n            // If we already saw this file, reuse DB record\n            const existing = await prisma.uploadedDocument.findUnique({\n                where: {\n                    sha256\n                },\n                include: {\n                    labResult: true\n                }\n            });\n            if (existing) {\n                // Clean up duplicate on disk\n                try {\n                    fs__WEBPACK_IMPORTED_MODULE_6___default().unlinkSync(file.path);\n                } catch (_) {\n                // ignore\n                }\n                return res.json({\n                    reused: true,\n                    document: existing\n                });\n            }\n            // Extract text from PDF\n            const dataBuffer = fs__WEBPACK_IMPORTED_MODULE_6___default().readFileSync(file.path);\n            const pdfData = await pdf_parse__WEBPACK_IMPORTED_MODULE_5___default()(dataBuffer);\n            const text = pdfData.text || \"\";\n            // 1) Try lab-specific parser first\n            const labParsed = (0,_lib_parsers__WEBPACK_IMPORTED_MODULE_3__.parseWithLabSpecificParsers)(text);\n            // 2) Fallback to generic parser\n            const genericParsed = parseCoaSummary(text);\n            const effective = {\n                batchCode: labParsed?.batchCode ?? genericParsed.batchCode ?? null,\n                labName: labParsed?.labName ?? genericParsed.labName ?? null,\n                thcPercent: labParsed?.thcPercent ?? genericParsed.thcPercent ?? null,\n                cbdPercent: labParsed?.cbdPercent ?? genericParsed.cbdPercent ?? null,\n                totalCannabinoidsPercent: labParsed?.totalCannabinoidsPercent ?? genericParsed.totalCannabinoidsPercent ?? null,\n                moisturePercent: labParsed?.moisturePercent ?? null,\n                waterActivity: labParsed?.waterActivity ?? null,\n                pesticidesPass: labParsed?.pesticidesPass ?? null,\n                microbialsPass: labParsed?.microbialsPass ?? null,\n                heavyMetalsPass: labParsed?.heavyMetalsPass ?? null\n            };\n            // Store relative file path so it's portable\n            const relativePath = path__WEBPACK_IMPORTED_MODULE_7___default().relative(process.cwd(), file.path);\n            // Create UploadedDocument\n            const uploaderEmail = session.user?.email || session.user?.name || null;\n            const uploadedDoc = await prisma.uploadedDocument.create({\n                data: {\n                    filePath: relativePath,\n                    fileName: file.originalname,\n                    mimeType: file.mimetype,\n                    size: file.size,\n                    sha256,\n                    extractedText: text,\n                    labName: effective.labName,\n                    batchCode: effective.batchCode,\n                    uploader: uploaderEmail,\n                    verified: false\n                }\n            });\n            // Optionally: auto-create Batch + LabResult if we detected a batch code\n            let createdLabResult = null;\n            if (effective.batchCode) {\n                // Find or create a Batch by batchCode (very basic for now)\n                const existingBatch = await prisma.batch.findFirst({\n                    where: {\n                        batchCode: effective.batchCode\n                    }\n                });\n                const batch = existingBatch || await prisma.batch.create({\n                    data: {\n                        batchCode: effective.batchCode,\n                        isActive: true\n                    }\n                });\n                createdLabResult = await prisma.labResult.create({\n                    data: {\n                        batchId: batch.id,\n                        labId: null,\n                        testedAt: null,\n                        reportedAt: null,\n                        thcPercent: effective.thcPercent,\n                        cbdPercent: effective.cbdPercent,\n                        totalCannabinoidsPercent: effective.totalCannabinoidsPercent,\n                        passed: null,\n                        pesticidesPass: effective.pesticidesPass,\n                        solventsPass: null,\n                        heavyMetalsPass: effective.heavyMetalsPass,\n                        microbialsPass: effective.microbialsPass,\n                        moisturePercent: effective.moisturePercent,\n                        waterActivity: effective.waterActivity,\n                        analyteSummary: null,\n                        rawJson: null,\n                        sourcePdfUrl: null,\n                        uploadedDocumentId: uploadedDoc.id\n                    }\n                });\n            }\n            return res.json({\n                reused: false,\n                document: uploadedDoc,\n                labResult: createdLabResult\n            });\n        } catch (err) {\n            console.error(\"COA upload error\", err);\n            return res.status(500).json({\n                error: err?.message || \"Upload failed\"\n            });\n        }\n    }\n    res.status(405).end();\n}\nconst config = {\n    api: {\n        bodyParser: false\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q1IxQixnQkFBZ0JILFVBQVVHLGNBQWM7d0JBQ3hDMkIsY0FBYzt3QkFDZHpCLGlCQUFpQkwsVUFBVUssZUFBZTt3QkFDMUNELGdCQUFnQkosVUFBVUksY0FBYzt3QkFDeENILGlCQUFpQkQsVUFBVUMsZUFBZTt3QkFDMUNDLGVBQWVGLFVBQVVFLGFBQWE7d0JBQ3RDNkIsZ0JBQWdCO3dCQUNoQkMsU0FBUzt3QkFDVEMsY0FBYzt3QkFDZEMsb0JBQW9CdkIsWUFBWWMsRUFBRTtvQkFDcEM7Z0JBQ0Y7WUFDRjtZQUdBLE9BQU9uSSxJQUFJSyxJQUFJLENBQUM7Z0JBQ2Q4RixRQUFRO2dCQUNSQyxVQUFVaUI7Z0JBQ1YxQixXQUFXa0M7WUFDYjtRQUNGLEVBQUUsT0FBTzNDLEtBQVU7WUFDakIyRCxRQUFRdkksS0FBSyxDQUFDLG9CQUFvQjRFO1lBQ2xDLE9BQU9sRixJQUNKSSxNQUFNLENBQUMsS0FDUEMsSUFBSSxDQUFDO2dCQUFFQyxPQUFPNEUsS0FBSzRELFdBQVc7WUFBZ0I7UUFDbkQ7SUFDRjtJQUVBOUksSUFBSUksTUFBTSxDQUFDLEtBQUsySSxHQUFHO0FBQ3JCO0FBRU8sTUFBTUMsU0FBUztJQUNwQkMsS0FBSztRQUNIQyxZQUFZO0lBQ2Q7QUFDRixFQUFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY2FydGZheC8uL3BhZ2VzL2FwaS9hZG1pbi91cGxvYWRzLnRzPzY0N2EiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XHJcbmltcG9ydCB7IFByaXNtYUNsaWVudCB9IGZyb20gJ0BwcmlzbWEvY2xpZW50JztcclxuaW1wb3J0IHsgZ2V0U2VydmVyU2Vzc2lvbiB9IGZyb20gJ25leHQtYXV0aC9uZXh0JztcclxuaW1wb3J0IHsgYXV0aE9wdGlvbnMgfSBmcm9tICcuLi9hdXRoL1suLi5uZXh0YXV0aF0nO1xyXG5pbXBvcnQgeyBwYXJzZVdpdGhMYWJTcGVjaWZpY1BhcnNlcnMgfSBmcm9tICcuLi8uLi8uLi9saWIvcGFyc2Vycyc7XHJcblxyXG5cclxuLy8gQHRzLWlnbm9yZSAtIG11bHRlciB0eXBlcyBhcmUgb3B0aW9uYWxcclxuaW1wb3J0IG11bHRlciBmcm9tICdtdWx0ZXInO1xyXG4vLyBAdHMtaWdub3JlIC0gcGRmLXBhcnNlIHR5cGVzIGFyZSBvcHRpb25hbFxyXG5pbXBvcnQgcGRmUGFyc2UgZnJvbSAncGRmLXBhcnNlJztcclxuXHJcbmltcG9ydCBmcyBmcm9tICdmcyc7XHJcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xyXG5pbXBvcnQgY3J5cHRvIGZyb20gJ2NyeXB0byc7XHJcblxyXG5jb25zdCBwcmlzbWEgPSBuZXcgUHJpc21hQ2xpZW50KCk7XHJcblxyXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLSBBdXRoIGhlbHBlciAtLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gcmVxdWlyZUFkbWluKHJlcTogYW55LCByZXM6IGFueSkge1xyXG4gIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBnZXRTZXJ2ZXJTZXNzaW9uKHJlcSwgcmVzLCBhdXRoT3B0aW9ucyBhcyBhbnkpO1xyXG4gIGlmICghc2Vzc2lvbiB8fCAoc2Vzc2lvbi51c2VyIGFzIGFueSkucm9sZSAhPT0gJ2FkbWluJykge1xyXG4gICAgcmVzLnN0YXR1cyg0MDMpLmpzb24oeyBlcnJvcjogJ2ZvcmJpZGRlbicgfSk7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbiAgcmV0dXJuIHNlc3Npb247XHJcbn1cclxuXHJcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tIE11bHRlciBzZXR1cCAtLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuY29uc3QgdXBsb2FkRGlyID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICd1cGxvYWRzJywgJ2NvYScpO1xyXG5cclxuaWYgKCFmcy5leGlzdHNTeW5jKHVwbG9hZERpcikpIHtcclxuICBmcy5ta2RpclN5bmModXBsb2FkRGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcclxufVxyXG5cclxuY29uc3Qgc3RvcmFnZSA9IG11bHRlci5kaXNrU3RvcmFnZSh7XHJcbiAgZGVzdGluYXRpb246IChfcmVxLCBfZmlsZSwgY2IpID0+IHtcclxuICAgIGNiKG51bGwsIHVwbG9hZERpcik7XHJcbiAgfSxcclxuICBmaWxlbmFtZTogKF9yZXEsIGZpbGUsIGNiKSA9PiB7XHJcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBEYXRlLm5vdygpO1xyXG4gICAgY29uc3Qgc2FmZU5hbWUgPSBmaWxlLm9yaWdpbmFsbmFtZS5yZXBsYWNlKC9bXlxcd1xcLS5dKy9nLCAnXycpO1xyXG4gICAgY2IobnVsbCwgYCR7dGltZXN0YW1wfS0ke3NhZmVOYW1lfWApO1xyXG4gIH0sXHJcbn0pO1xyXG5cclxuY29uc3QgdXBsb2FkID0gbXVsdGVyKHtcclxuICBzdG9yYWdlLFxyXG4gIGZpbGVGaWx0ZXI6IChfcmVxLCBmaWxlLCBjYikgPT4ge1xyXG4gICAgaWYgKGZpbGUubWltZXR5cGUgIT09ICdhcHBsaWNhdGlvbi9wZGYnKSB7XHJcbiAgICAgIHJldHVybiBjYihuZXcgRXJyb3IoJ09ubHkgUERGIGZpbGVzIGFyZSBhbGxvd2VkJykpO1xyXG4gICAgfVxyXG4gICAgY2IobnVsbCwgdHJ1ZSk7XHJcbiAgfSxcclxufSk7XHJcblxyXG5mdW5jdGlvbiBydW5NaWRkbGV3YXJlKFxyXG4gIHJlcTogTmV4dEFwaVJlcXVlc3QsXHJcbiAgcmVzOiBOZXh0QXBpUmVzcG9uc2UsXHJcbiAgZm46IGFueVxyXG4pOiBQcm9taXNlPHZvaWQ+IHtcclxuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgZm4ocmVxIGFzIGFueSwgcmVzIGFzIGFueSwgKHJlc3VsdDogYW55KSA9PiB7XHJcbiAgICAgIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBFcnJvcikgcmV0dXJuIHJlamVjdChyZXN1bHQpO1xyXG4gICAgICByZXR1cm4gcmVzb2x2ZShyZXN1bHQpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tIFNpbXBsZSBwYXJzZXJzIC0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG50eXBlIFBhcnNlZENvYVN1bW1hcnkgPSB7XHJcbiAgYmF0Y2hDb2RlPzogc3RyaW5nIHwgbnVsbDtcclxuICBsYWJOYW1lPzogc3RyaW5nIHwgbnVsbDtcclxuICB0aGNQZXJjZW50PzogbnVtYmVyIHwgbnVsbDtcclxuICBjYmRQZXJjZW50PzogbnVtYmVyIHwgbnVsbDtcclxuICB0b3RhbENhbm5hYmlub2lkc1BlcmNlbnQ/OiBudW1iZXIgfCBudWxsO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gZXh0cmFjdEJhdGNoQ29kZSh0ZXh0OiBzdHJpbmcpOiBzdHJpbmcgfCBudWxsIHtcclxuICBjb25zdCBwYXR0ZXJucyA9IFtcclxuICAgIC8vIEJhdGNoIC8gTG90IHN0eWxlIGxhYmVsc1xyXG4gICAgL0JhdGNoKD86XFxzKig/OklEfE51bWJlcnxOb1xcLj8pPyk/XFxzKls6I11cXHMqKFtBLVphLXowLTlcXC1dKykvaSxcclxuICAgIC9Mb3QoPzpcXHMqKD86SUR8TnVtYmVyfE5vXFwuPyk/KT9cXHMqWzojXVxccyooW0EtWmEtejAtOVxcLV0rKS9pLFxyXG5cclxuICAgIC8vIE1FVFJDIC8gUGFja2FnZSB0YWdzIHRoYXQgbG9vayBsaWtlIDFBNDAwMFhYWFhYWFhcclxuICAgIC8oTUVUUkN8UGFja2FnZXxUYWcpXFxzKig/OklEfE51bWJlcnxOb1xcLj8pP1xccypbOiNdP1xccyooW0EtWjAtOVxcLV17Nix9KS9pLFxyXG5cclxuICAgIC8vIOKAnEJhdGNoIOKApiBYWFhYWFjigJ0gc3R5bGVcclxuICAgIC9CYXRjaFxccysoW0EtWmEtejAtOVxcLV17NCx9KS9pLFxyXG4gICAgL0xvdFxccysoW0EtWmEtejAtOVxcLV17NCx9KS9pLFxyXG4gIF07XHJcblxyXG4gIGZvciAoY29uc3QgcCBvZiBwYXR0ZXJucykge1xyXG4gICAgY29uc3QgbSA9IHRleHQubWF0Y2gocCk7XHJcbiAgICBpZiAobSkge1xyXG4gICAgICBjb25zdCBjYW5kaWRhdGUgPSBtWzJdIHx8IG1bMV07XHJcbiAgICAgIGlmIChjYW5kaWRhdGUpIHJldHVybiBjYW5kaWRhdGUudHJpbSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gRmFsbGJhY2sgaGV1cmlzdGljOiBmaW5kIGEgbGluZSBjb250YWluaW5nIFwiQmF0Y2hcIiBvciBcIkxvdFwiIGFuZCBncmFiIGEgY29kZS1saWtlIHRva2VuXHJcbiAgY29uc3QgbGluZXMgPSB0ZXh0LnNwbGl0KC9cXHI/XFxuLyk7XHJcbiAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XHJcbiAgICBpZiAoL0JhdGNofExvdHxNRVRSQ3xQYWNrYWdlL2kudGVzdChsaW5lKSkge1xyXG4gICAgICBjb25zdCB0b2tlbnMgPSBsaW5lLnNwbGl0KC9bXFxzLF0rLyk7XHJcbiAgICAgIGZvciAoY29uc3QgdCBvZiB0b2tlbnMpIHtcclxuICAgICAgICBpZiAoL1tBLVphLXowLTldLy50ZXN0KHQpICYmIHQucmVwbGFjZSgvW15BLVphLXowLTldL2csICcnKS5sZW5ndGggPj0gNCkge1xyXG4gICAgICAgICAgcmV0dXJuIHQucmVwbGFjZSgvW15cXHdcXC1dL2csICcnKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiBudWxsO1xyXG59XHJcblxyXG5mdW5jdGlvbiBwYXJzZUNvYVN1bW1hcnkodGV4dDogc3RyaW5nKTogUGFyc2VkQ29hU3VtbWFyeSB7XHJcbiAgY29uc3QgYmF0Y2hDb2RlID0gZXh0cmFjdEJhdGNoQ29kZSh0ZXh0KTtcclxuICBjb25zdCBsYWJOYW1lID0gZXh0cmFjdExhYk5hbWUodGV4dCk7XHJcblxyXG4gIC8vIEJhc2ljIFRIQyAvIENCRCAvIFRvdGFsIGRldGVjdGlvblxyXG4gIGxldCB0aGNQZXJjZW50ID1cclxuICAgIGV4dHJhY3RQZXJjZW50KC9USENbXiVcXG5cXHJdKj8oXFxkKyg/OlxcLlxcZCspPylcXHMqJS9pLCB0ZXh0KSA/PyBudWxsO1xyXG4gIGxldCBjYmRQZXJjZW50ID1cclxuICAgIGV4dHJhY3RQZXJjZW50KC9DQkRbXiVcXG5cXHJdKj8oXFxkKyg/OlxcLlxcZCspPylcXHMqJS9pLCB0ZXh0KSA/PyBudWxsO1xyXG4gIGxldCB0b3RhbENhbm5hYmlub2lkc1BlcmNlbnQgPVxyXG4gICAgZXh0cmFjdFBlcmNlbnQoXHJcbiAgICAgIC8oVG90YWxcXHMrKD86Q2FubmFiaW5vaWRzfEFjdGl2ZSBDYW5uYWJpbm9pZHMpW14lXFxuXFxyXSo/KShcXGQrKD86XFwuXFxkKyk/KVxccyolL2ksXHJcbiAgICAgIHRleHRcclxuICAgICkgPz8gbnVsbDtcclxuXHJcbiAgLy8gSWYgdG90YWxDYW5uYWJpbm9pZHMgaXNuJ3QgZXhwbGljaXQsIGFwcHJveGltYXRlIGFzIFRIQyArIENCRCB3aGVuIGJvdGggYXJlIHByZXNlbnRcclxuICBpZiAodG90YWxDYW5uYWJpbm9pZHNQZXJjZW50ID09IG51bGwgJiYgdGhjUGVyY2VudCAhPSBudWxsICYmIGNiZFBlcmNlbnQgIT0gbnVsbCkge1xyXG4gICAgdG90YWxDYW5uYWJpbm9pZHNQZXJjZW50ID0gdGhjUGVyY2VudCArIGNiZFBlcmNlbnQ7XHJcbiAgfVxyXG5cclxuICByZXR1cm4ge1xyXG4gICAgYmF0Y2hDb2RlLFxyXG4gICAgbGFiTmFtZSxcclxuICAgIHRoY1BlcmNlbnQsXHJcbiAgICBjYmRQZXJjZW50LFxyXG4gICAgdG90YWxDYW5uYWJpbm9pZHNQZXJjZW50LFxyXG4gIH07XHJcbn1cclxuXHJcblxyXG5mdW5jdGlvbiBleHRyYWN0TGFiTmFtZSh0ZXh0OiBzdHJpbmcpOiBzdHJpbmcgfCBudWxsIHtcclxuICAvLyBWZXJ5IG5haXZlOiB0YWtlIHRoZSBmaXJzdCBub24tZW1wdHkgbGluZTsgbWFueSBsYWJzIHB1dCB0aGVpciBuYW1lIGF0IHRvcFxyXG4gIGNvbnN0IGxpbmVzID0gdGV4dC5zcGxpdCgvXFxyP1xcbi8pLm1hcCgobCkgPT4gbC50cmltKCkpLmZpbHRlcihCb29sZWFuKTtcclxuICBpZiAobGluZXMubGVuZ3RoID09PSAwKSByZXR1cm4gbnVsbDtcclxuICBjb25zdCBmaXJzdCA9IGxpbmVzWzBdO1xyXG4gIGlmIChmaXJzdC5sZW5ndGggPiAzICYmIGZpcnN0Lmxlbmd0aCA8IDEyMCkgcmV0dXJuIGZpcnN0O1xyXG4gIHJldHVybiBudWxsO1xyXG59XHJcblxyXG5mdW5jdGlvbiBleHRyYWN0UGVyY2VudChsYWJlbDogUmVnRXhwLCB0ZXh0OiBzdHJpbmcpOiBudW1iZXIgfCBudWxsIHtcclxuICBjb25zdCBtID0gdGV4dC5tYXRjaChsYWJlbCk7XHJcbiAgaWYgKCFtKSByZXR1cm4gbnVsbDtcclxuICBjb25zdCBudW1TdHIgPSBtWzFdO1xyXG4gIGNvbnN0IHZhbCA9IHBhcnNlRmxvYXQobnVtU3RyKTtcclxuICBpZiAoTnVtYmVyLmlzTmFOKHZhbCkpIHJldHVybiBudWxsO1xyXG4gIHJldHVybiB2YWw7XHJcbn1cclxuXHJcblxyXG5hc3luYyBmdW5jdGlvbiBoYXNoRmlsZShmaWxlUGF0aDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuICBjb25zdCBoYXNoID0gY3J5cHRvLmNyZWF0ZUhhc2goJ3NoYTI1NicpO1xyXG4gIGNvbnN0IHN0cmVhbSA9IGZzLmNyZWF0ZVJlYWRTdHJlYW0oZmlsZVBhdGgpO1xyXG5cclxuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgc3RyZWFtLm9uKCdkYXRhJywgKGRhdGEpID0+IGhhc2gudXBkYXRlKGRhdGEpKTtcclxuICAgIHN0cmVhbS5vbignZW5kJywgKCkgPT4gcmVzb2x2ZShoYXNoLmRpZ2VzdCgnaGV4JykpKTtcclxuICAgIHN0cmVhbS5vbignZXJyb3InLCAoZXJyKSA9PiByZWplY3QoZXJyKSk7XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tIEhhbmRsZXIgLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIoXHJcbiAgcmVxOiBOZXh0QXBpUmVxdWVzdCxcclxuICByZXM6IE5leHRBcGlSZXNwb25zZVxyXG4pIHtcclxuICBjb25zdCBzZXNzaW9uID0gYXdhaXQgcmVxdWlyZUFkbWluKHJlcSwgcmVzKTtcclxuICBpZiAoIXNlc3Npb24pIHJldHVybjtcclxuXHJcbiAgaWYgKHJlcS5tZXRob2QgPT09ICdHRVQnKSB7XHJcbiAgICBjb25zdCBkb2NzID0gYXdhaXQgcHJpc21hLnVwbG9hZGVkRG9jdW1lbnQuZmluZE1hbnkoe1xyXG4gICAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH0sXHJcbiAgICAgIGluY2x1ZGU6IHtcclxuICAgICAgICBsYWJSZXN1bHQ6IHRydWUsXHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuICAgIHJldHVybiByZXMuanNvbihkb2NzKTtcclxuICB9XHJcblxyXG4gIGlmIChyZXEubWV0aG9kID09PSAnUE9TVCcpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGF3YWl0IHJ1bk1pZGRsZXdhcmUocmVxLCByZXMsIHVwbG9hZC5zaW5nbGUoJ2ZpbGUnKSk7XHJcblxyXG4gICAgICBjb25zdCBmaWxlID0gKHJlcSBhcyBhbnkpLmZpbGUgYXMgRXhwcmVzcy5NdWx0ZXIuRmlsZSB8IHVuZGVmaW5lZDtcclxuICAgICAgaWYgKCFmaWxlKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdObyBmaWxlIHVwbG9hZGVkJyB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gQ29tcHV0ZSBTSEEtMjU2XHJcbiAgICAgIGNvbnN0IHNoYTI1NiA9IGF3YWl0IGhhc2hGaWxlKGZpbGUucGF0aCk7XHJcblxyXG4gICAgICAvLyBJZiB3ZSBhbHJlYWR5IHNhdyB0aGlzIGZpbGUsIHJldXNlIERCIHJlY29yZFxyXG4gICAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IHByaXNtYS51cGxvYWRlZERvY3VtZW50LmZpbmRVbmlxdWUoe1xyXG4gICAgICAgIHdoZXJlOiB7IHNoYTI1NiB9LFxyXG4gICAgICAgIGluY2x1ZGU6IHsgbGFiUmVzdWx0OiB0cnVlIH0sXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgaWYgKGV4aXN0aW5nKSB7XHJcbiAgICAgICAgLy8gQ2xlYW4gdXAgZHVwbGljYXRlIG9uIGRpc2tcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgZnMudW5saW5rU3luYyhmaWxlLnBhdGgpO1xyXG4gICAgICAgIH0gY2F0Y2ggKF8pIHtcclxuICAgICAgICAgIC8vIGlnbm9yZVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKHtcclxuICAgICAgICAgIHJldXNlZDogdHJ1ZSxcclxuICAgICAgICAgIGRvY3VtZW50OiBleGlzdGluZyxcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gRXh0cmFjdCB0ZXh0IGZyb20gUERGXHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGFCdWZmZXIgPSBmcy5yZWFkRmlsZVN5bmMoZmlsZS5wYXRoKTtcclxuICAgICAgY29uc3QgcGRmRGF0YSA9IGF3YWl0IHBkZlBhcnNlKGRhdGFCdWZmZXIpO1xyXG4gICAgICBjb25zdCB0ZXh0ID0gcGRmRGF0YS50ZXh0IHx8ICcnO1xyXG5cclxuICAgICAgLy8gMSkgVHJ5IGxhYi1zcGVjaWZpYyBwYXJzZXIgZmlyc3RcclxuICAgICAgY29uc3QgbGFiUGFyc2VkID0gcGFyc2VXaXRoTGFiU3BlY2lmaWNQYXJzZXJzKHRleHQpO1xyXG5cclxuICAgICAgLy8gMikgRmFsbGJhY2sgdG8gZ2VuZXJpYyBwYXJzZXJcclxuICAgICAgY29uc3QgZ2VuZXJpY1BhcnNlZCA9IHBhcnNlQ29hU3VtbWFyeSh0ZXh0KTtcclxuXHJcbiAgICAgIGNvbnN0IGVmZmVjdGl2ZSA9IHtcclxuICAgICAgICBiYXRjaENvZGU6IGxhYlBhcnNlZD8uYmF0Y2hDb2RlID8/IGdlbmVyaWNQYXJzZWQuYmF0Y2hDb2RlID8/IG51bGwsXHJcbiAgICAgICAgbGFiTmFtZTogbGFiUGFyc2VkPy5sYWJOYW1lID8/IGdlbmVyaWNQYXJzZWQubGFiTmFtZSA/PyBudWxsLFxyXG4gICAgICAgIHRoY1BlcmNlbnQ6IGxhYlBhcnNlZD8udGhjUGVyY2VudCA/PyBnZW5lcmljUGFyc2VkLnRoY1BlcmNlbnQgPz8gbnVsbCxcclxuICAgICAgICBjYmRQZXJjZW50OiBsYWJQYXJzZWQ/LmNiZFBlcmNlbnQgPz8gZ2VuZXJpY1BhcnNlZC5jYmRQZXJjZW50ID8/IG51bGwsXHJcbiAgICAgICAgdG90YWxDYW5uYWJpbm9pZHNQZXJjZW50OlxyXG4gICAgICAgICAgbGFiUGFyc2VkPy50b3RhbENhbm5hYmlub2lkc1BlcmNlbnQgPz9cclxuICAgICAgICAgIGdlbmVyaWNQYXJzZWQudG90YWxDYW5uYWJpbm9pZHNQZXJjZW50ID8/XHJcbiAgICAgICAgICBudWxsLFxyXG4gICAgICAgIG1vaXN0dXJlUGVyY2VudDogbGFiUGFyc2VkPy5tb2lzdHVyZVBlcmNlbnQgPz8gbnVsbCxcclxuICAgICAgICB3YXRlckFjdGl2aXR5OiBsYWJQYXJzZWQ/LndhdGVyQWN0aXZpdHkgPz8gbnVsbCxcclxuICAgICAgICBwZXN0aWNpZGVzUGFzczogbGFiUGFyc2VkPy5wZXN0aWNpZGVzUGFzcyA/PyBudWxsLFxyXG4gICAgICAgIG1pY3JvYmlhbHNQYXNzOiBsYWJQYXJzZWQ/Lm1pY3JvYmlhbHNQYXNzID8/IG51bGwsXHJcbiAgICAgICAgaGVhdnlNZXRhbHNQYXNzOiBsYWJQYXJzZWQ/LmhlYXZ5TWV0YWxzUGFzcyA/PyBudWxsLFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8gU3RvcmUgcmVsYXRpdmUgZmlsZSBwYXRoIHNvIGl0J3MgcG9ydGFibGVcclxuICAgICAgY29uc3QgcmVsYXRpdmVQYXRoID0gcGF0aC5yZWxhdGl2ZShwcm9jZXNzLmN3ZCgpLCBmaWxlLnBhdGgpO1xyXG5cclxuXHJcbiAgICAgIC8vIENyZWF0ZSBVcGxvYWRlZERvY3VtZW50XHJcbiAgICAgIGNvbnN0IHVwbG9hZGVyRW1haWwgPVxyXG4gICAgICAgIChzZXNzaW9uLnVzZXIgYXMgYW55KT8uZW1haWwgfHwgKHNlc3Npb24udXNlciBhcyBhbnkpPy5uYW1lIHx8IG51bGw7XHJcblxyXG4gICAgICAgICAgICBjb25zdCB1cGxvYWRlZERvYyA9IGF3YWl0IHByaXNtYS51cGxvYWRlZERvY3VtZW50LmNyZWF0ZSh7XHJcbiAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgZmlsZVBhdGg6IHJlbGF0aXZlUGF0aCxcclxuICAgICAgICAgIGZpbGVOYW1lOiBmaWxlLm9yaWdpbmFsbmFtZSxcclxuICAgICAgICAgIG1pbWVUeXBlOiBmaWxlLm1pbWV0eXBlLFxyXG4gICAgICAgICAgc2l6ZTogZmlsZS5zaXplLFxyXG4gICAgICAgICAgc2hhMjU2LFxyXG4gICAgICAgICAgZXh0cmFjdGVkVGV4dDogdGV4dCxcclxuICAgICAgICAgIGxhYk5hbWU6IGVmZmVjdGl2ZS5sYWJOYW1lLFxyXG4gICAgICAgICAgYmF0Y2hDb2RlOiBlZmZlY3RpdmUuYmF0Y2hDb2RlLFxyXG4gICAgICAgICAgdXBsb2FkZXI6IHVwbG9hZGVyRW1haWwsXHJcbiAgICAgICAgICB2ZXJpZmllZDogZmFsc2UsXHJcbiAgICAgICAgfSxcclxuICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgLy8gT3B0aW9uYWxseTogYXV0by1jcmVhdGUgQmF0Y2ggKyBMYWJSZXN1bHQgaWYgd2UgZGV0ZWN0ZWQgYSBiYXRjaCBjb2RlXHJcbiAgICAgIGxldCBjcmVhdGVkTGFiUmVzdWx0ID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIGlmIChlZmZlY3RpdmUuYmF0Y2hDb2RlKSB7XHJcbiAgICAgICAgLy8gRmluZCBvciBjcmVhdGUgYSBCYXRjaCBieSBiYXRjaENvZGUgKHZlcnkgYmFzaWMgZm9yIG5vdylcclxuICAgICAgICBjb25zdCBleGlzdGluZ0JhdGNoID0gYXdhaXQgcHJpc21hLmJhdGNoLmZpbmRGaXJzdCh7XHJcbiAgICAgICAgICB3aGVyZTogeyBiYXRjaENvZGU6IGVmZmVjdGl2ZS5iYXRjaENvZGUgfSxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29uc3QgYmF0Y2ggPVxyXG4gICAgICAgICAgZXhpc3RpbmdCYXRjaCB8fFxyXG4gICAgICAgICAgKGF3YWl0IHByaXNtYS5iYXRjaC5jcmVhdGUoe1xyXG4gICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgYmF0Y2hDb2RlOiBlZmZlY3RpdmUuYmF0Y2hDb2RlLFxyXG4gICAgICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgfSkpO1xyXG5cclxuICAgICAgICBjcmVhdGVkTGFiUmVzdWx0ID0gYXdhaXQgcHJpc21hLmxhYlJlc3VsdC5jcmVhdGUoe1xyXG4gICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICBiYXRjaElkOiBiYXRjaC5pZCxcclxuICAgICAgICAgICAgbGFiSWQ6IG51bGwsIC8vIGxhdGVyOiBtYXAgbGFiTmFtZSAtPiBMYWIgZW50aXR5XHJcbiAgICAgICAgICAgIHRlc3RlZEF0OiBudWxsLFxyXG4gICAgICAgICAgICByZXBvcnRlZEF0OiBudWxsLFxyXG4gICAgICAgICAgICB0aGNQZXJjZW50OiBlZmZlY3RpdmUudGhjUGVyY2VudCxcclxuICAgICAgICAgICAgY2JkUGVyY2VudDogZWZmZWN0aXZlLmNiZFBlcmNlbnQsXHJcbiAgICAgICAgICAgIHRvdGFsQ2FubmFiaW5vaWRzUGVyY2VudDpcclxuICAgICAgICAgICAgICBlZmZlY3RpdmUudG90YWxDYW5uYWJpbm9pZHNQZXJjZW50LFxyXG4gICAgICAgICAgICBwYXNzZWQ6IG51bGwsIC8vIGNvdWxkIGluZmVyIG92ZXJhbGwgbGF0ZXJcclxuICAgICAgICAgICAgcGVzdGljaWRlc1Bhc3M6IGVmZmVjdGl2ZS5wZXN0aWNpZGVzUGFzcyxcclxuICAgICAgICAgICAgc29sdmVudHNQYXNzOiBudWxsLFxyXG4gICAgICAgICAgICBoZWF2eU1ldGFsc1Bhc3M6IGVmZmVjdGl2ZS5oZWF2eU1ldGFsc1Bhc3MsXHJcbiAgICAgICAgICAgIG1pY3JvYmlhbHNQYXNzOiBlZmZlY3RpdmUubWljcm9iaWFsc1Bhc3MsXHJcbiAgICAgICAgICAgIG1vaXN0dXJlUGVyY2VudDogZWZmZWN0aXZlLm1vaXN0dXJlUGVyY2VudCxcclxuICAgICAgICAgICAgd2F0ZXJBY3Rpdml0eTogZWZmZWN0aXZlLndhdGVyQWN0aXZpdHksXHJcbiAgICAgICAgICAgIGFuYWx5dGVTdW1tYXJ5OiBudWxsLFxyXG4gICAgICAgICAgICByYXdKc29uOiBudWxsLFxyXG4gICAgICAgICAgICBzb3VyY2VQZGZVcmw6IG51bGwsXHJcbiAgICAgICAgICAgIHVwbG9hZGVkRG9jdW1lbnRJZDogdXBsb2FkZWREb2MuaWQsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG5cclxuICAgICAgcmV0dXJuIHJlcy5qc29uKHtcclxuICAgICAgICByZXVzZWQ6IGZhbHNlLFxyXG4gICAgICAgIGRvY3VtZW50OiB1cGxvYWRlZERvYyxcclxuICAgICAgICBsYWJSZXN1bHQ6IGNyZWF0ZWRMYWJSZXN1bHQsXHJcbiAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignQ09BIHVwbG9hZCBlcnJvcicsIGVycik7XHJcbiAgICAgIHJldHVybiByZXNcclxuICAgICAgICAuc3RhdHVzKDUwMClcclxuICAgICAgICAuanNvbih7IGVycm9yOiBlcnI/Lm1lc3NhZ2UgfHwgJ1VwbG9hZCBmYWlsZWQnIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmVzLnN0YXR1cyg0MDUpLmVuZCgpO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgY29uZmlnID0ge1xyXG4gIGFwaToge1xyXG4gICAgYm9keVBhcnNlcjogZmFsc2UsIC8vIHJlcXVpcmVkIGZvciBtdWx0ZXJcclxuICB9LFxyXG59O1xyXG4iXSwibmFtZXMiOlsiUHJpc21hQ2xpZW50IiwiZ2V0U2VydmVyU2Vzc2lvbiIsImF1dGhPcHRpb25zIiwicGFyc2VXaXRoTGFiU3BlY2lmaWNQYXJzZXJzIiwibXVsdGVyIiwicGRmUGFyc2UiLCJmcyIsInBhdGgiLCJjcnlwdG8iLCJwcmlzbWEiLCJyZXF1aXJlQWRtaW4iLCJyZXEiLCJyZXMiLCJzZXNzaW9uIiwidXNlciIsInJvbGUiLCJzdGF0dXMiLCJqc29uIiwiZXJyb3IiLCJ1cGxvYWREaXIiLCJqb2luIiwicHJvY2VzcyIsImN3ZCIsImV4aXN0c1N5bmMiLCJta2RpclN5bmMiLCJyZWN1cnNpdmUiLCJzdG9yYWdlIiwiZGlza1N0b3JhZ2UiLCJkZXN0aW5hdGlvbiIsIl9yZXEiLCJfZmlsZSIsImNiIiwiZmlsZW5hbWUiLCJmaWxlIiwidGltZXN0YW1wIiwiRGF0ZSIsIm5vdyIsInNhZmVOYW1lIiwib3JpZ2luYWxuYW1lIiwicmVwbGFjZSIsInVwbG9hZCIsImZpbGVGaWx0ZXIiLCJtaW1ldHlwZSIsIkVycm9yIiwicnVuTWlkZGxld2FyZSIsImZuIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJyZXN1bHQiLCJleHRyYWN0QmF0Y2hDb2RlIiwidGV4dCIsInBhdHRlcm5zIiwicCIsIm0iLCJtYXRjaCIsImNhbmRpZGF0ZSIsInRyaW0iLCJsaW5lcyIsInNwbGl0IiwibGluZSIsInRlc3QiLCJ0b2tlbnMiLCJ0IiwibGVuZ3RoIiwicGFyc2VDb2FTdW1tYXJ5IiwiYmF0Y2hDb2RlIiwibGFiTmFtZSIsImV4dHJhY3RMYWJOYW1lIiwidGhjUGVyY2VudCIsImV4dHJhY3RQZXJjZW50IiwiY2JkUGVyY2VudCIsInRvdGFsQ2FubmFiaW5vaWRzUGVyY2VudCIsIm1hcCIsImwiLCJmaWx0ZXIiLCJCb29sZWFuIiwiZmlyc3QiLCJsYWJlbCIsIm51bVN0ciIsInZhbCIsInBhcnNlRmxvYXQiLCJOdW1iZXIiLCJpc05hTiIsImhhc2hGaWxlIiwiZmlsZVBhdGgiLCJoYXNoIiwiY3JlYXRlSGFzaCIsInN0cmVhbSIsImNyZWF0ZVJlYWRTdHJlYW0iLCJvbiIsImRhdGEiLCJ1cGRhdGUiLCJkaWdlc3QiLCJlcnIiLCJoYW5kbGVyIiwibWV0aG9kIiwiZG9jcyIsInVwbG9hZGVkRG9jdW1lbnQiLCJmaW5kTWFueSIsIm9yZGVyQnkiLCJjcmVhdGVkQXQiLCJpbmNsdWRlIiwibGFiUmVzdWx0Iiwic2luZ2xlIiwic2hhMjU2IiwiZXhpc3RpbmciLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJ1bmxpbmtTeW5jIiwiXyIsInJldXNlZCIsImRvY3VtZW50IiwiZGF0YUJ1ZmZlciIsInJlYWRGaWxlU3luYyIsInBkZkRhdGEiLCJsYWJQYXJzZWQiLCJnZW5lcmljUGFyc2VkIiwiZWZmZWN0aXZlIiwibW9pc3R1cmVQZXJjZW50Iiwid2F0ZXJBY3Rpdml0eSIsInBlc3RpY2lkZXNQYXNzIiwibWljcm9iaWFsc1Bhc3MiLCJoZWF2eU1ldGFsc1Bhc3MiLCJyZWxhdGl2ZVBhdGgiLCJyZWxhdGl2ZSIsInVwbG9hZGVyRW1haWwiLCJlbWFpbCIsIm5hbWUiLCJ1cGxvYWRlZERvYyIsImNyZWF0ZSIsImZpbGVOYW1lIiwibWltZVR5cGUiLCJzaXplIiwiZXh0cmFjdGVkVGV4dCIsInVwbG9hZGVyIiwidmVyaWZpZWQiLCJjcmVhdGVkTGFiUmVzdWx0IiwiZXhpc3RpbmdCYXRjaCIsImJhdGNoIiwiZmluZEZpcnN0IiwiaXNBY3RpdmUiLCJiYXRjaElkIiwiaWQiLCJsYWJJZCIsInRlc3RlZEF0IiwicmVwb3J0ZWRBdCIsInBhc3NlZCIsInNvbHZlbnRzUGFzcyIsImFuYWx5dGVTdW1tYXJ5IiwicmF3SnNvbiIsInNvdXJjZVBkZlVybCIsInVwbG9hZGVkRG9jdW1lbnRJZCIsImNvbnNvbGUiLCJtZXNzYWdlIiwiZW5kIiwiY29uZmlnIiwiYXBpIiwiYm9keVBhcnNlciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/admin/uploads.ts\n");

/***/ }),

/***/ "(api)/./pages/api/auth/[...nextauth].ts":
/*!*****************************************!*\
  !*** ./pages/api/auth/[...nextauth].ts ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authOptions: () => (/* binding */ authOptions),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth */ \"next-auth\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_auth__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next-auth/providers/credentials */ \"next-auth/providers/credentials\");\n/* harmony import */ var next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var bcrypt__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! bcrypt */ \"bcrypt\");\n/* harmony import */ var bcrypt__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(bcrypt__WEBPACK_IMPORTED_MODULE_3__);\n\n\n\n\nconst prisma = new _prisma_client__WEBPACK_IMPORTED_MODULE_2__.PrismaClient();\nconst authOptions = {\n    session: {\n        strategy: \"jwt\"\n    },\n    providers: [\n        next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_1___default()({\n            name: \"Credentials\",\n            credentials: {\n                email: {\n                    label: \"Email\",\n                    type: \"email\",\n                    placeholder: \"admin@example.com\"\n                },\n                password: {\n                    label: \"Password\",\n                    type: \"password\"\n                }\n            },\n            async authorize (credentials) {\n                if (!credentials?.email || !credentials?.password) return null;\n                const user = await prisma.adminUser.findUnique({\n                    where: {\n                        email: credentials.email\n                    }\n                });\n                if (!user) return null;\n                const ok = await bcrypt__WEBPACK_IMPORTED_MODULE_3___default().compare(credentials.password, user.password);\n                if (!ok) return null;\n                return {\n                    id: user.id.toString(),\n                    email: user.email,\n                    name: user.name || undefined,\n                    role: user.role\n                };\n            }\n        })\n    ],\n    callbacks: {\n        async jwt ({ token, user }) {\n            if (user) {\n                token.role = user.role ?? \"admin\";\n                token.id = user.id ?? token.id;\n            }\n            return token;\n        },\n        async session ({ session, token }) {\n            session.user = session.user ?? {};\n            session.user.role = token.role;\n            session.user.id = token.id;\n            return session;\n        }\n    },\n    secret: process.env.NEXTAUTH_SECRET\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (next_auth__WEBPACK_IMPORTED_MODULE_0___default()(authOptions));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvYXV0aC9bLi4ubmV4dGF1dGhdLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBc0Q7QUFDWTtBQUNwQjtBQUNsQjtBQUU1QixNQUFNSSxTQUFTLElBQUlGLHdEQUFZQTtBQUV4QixNQUFNRyxjQUErQjtJQUMxQ0MsU0FBUztRQUFFQyxVQUFVO0lBQU07SUFDM0JDLFdBQVc7UUFDVFAsc0VBQW1CQSxDQUFDO1lBQ2xCUSxNQUFNO1lBQ05DLGFBQWE7Z0JBQ1hDLE9BQU87b0JBQUVDLE9BQU87b0JBQVNDLE1BQU07b0JBQVNDLGFBQWE7Z0JBQW9CO2dCQUN6RUMsVUFBVTtvQkFBRUgsT0FBTztvQkFBWUMsTUFBTTtnQkFBVztZQUNsRDtZQUNBLE1BQU1HLFdBQVVOLFdBQVc7Z0JBQ3pCLElBQUksQ0FBQ0EsYUFBYUMsU0FBUyxDQUFDRCxhQUFhSyxVQUFVLE9BQU87Z0JBRTFELE1BQU1FLE9BQU8sTUFBTWIsT0FBT2MsU0FBUyxDQUFDQyxVQUFVLENBQUM7b0JBQzdDQyxPQUFPO3dCQUFFVCxPQUFPRCxZQUFZQyxLQUFLO29CQUFDO2dCQUNwQztnQkFDQSxJQUFJLENBQUNNLE1BQU0sT0FBTztnQkFFbEIsTUFBTUksS0FBSyxNQUFNbEIscURBQWMsQ0FBQ08sWUFBWUssUUFBUSxFQUFFRSxLQUFLRixRQUFRO2dCQUNuRSxJQUFJLENBQUNNLElBQUksT0FBTztnQkFFaEIsT0FBTztvQkFDTEUsSUFBSU4sS0FBS00sRUFBRSxDQUFDQyxRQUFRO29CQUNwQmIsT0FBT00sS0FBS04sS0FBSztvQkFDakJGLE1BQU1RLEtBQUtSLElBQUksSUFBSWdCO29CQUNuQkMsTUFBTVQsS0FBS1MsSUFBSTtnQkFDakI7WUFDRjtRQUNGO0tBQ0Q7SUFDREMsV0FBVztRQUNULE1BQU1DLEtBQUksRUFBRUMsS0FBSyxFQUFFWixJQUFJLEVBQUU7WUFDdkIsSUFBSUEsTUFBTTtnQkFDUlksTUFBTUgsSUFBSSxHQUFHLEtBQWNBLElBQUksSUFBSTtnQkFDbkNHLE1BQU1OLEVBQUUsR0FBRyxLQUFjQSxFQUFFLElBQUlNLE1BQU1OLEVBQUU7WUFDekM7WUFDQSxPQUFPTTtRQUNUO1FBQ0EsTUFBTXZCLFNBQVEsRUFBRUEsT0FBTyxFQUFFdUIsS0FBSyxFQUFFO1lBQzdCdkIsUUFBZ0JXLElBQUksR0FBR1gsUUFBUVcsSUFBSSxJQUFJLENBQUM7WUFDeENYLFFBQWdCVyxJQUFJLENBQUNTLElBQUksR0FBR0csTUFBTUgsSUFBSTtZQUN0Q3BCLFFBQWdCVyxJQUFJLENBQUNNLEVBQUUsR0FBR00sTUFBTU4sRUFBRTtZQUNuQyxPQUFPakI7UUFDVDtJQUNGO0lBQ0F3QixRQUFRQyxRQUFRQyxHQUFHLENBQUNDLGVBQWU7QUFDckMsRUFBRTtBQUVGLGlFQUFlakMsZ0RBQVFBLENBQUNLLFlBQVlBLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jYXJ0ZmF4Ly4vcGFnZXMvYXBpL2F1dGgvWy4uLm5leHRhdXRoXS50cz8yZThiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBOZXh0QXV0aCwgeyBOZXh0QXV0aE9wdGlvbnMgfSBmcm9tICduZXh0LWF1dGgnO1xyXG5pbXBvcnQgQ3JlZGVudGlhbHNQcm92aWRlciBmcm9tICduZXh0LWF1dGgvcHJvdmlkZXJzL2NyZWRlbnRpYWxzJztcclxuaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xyXG5pbXBvcnQgYmNyeXB0IGZyb20gJ2JjcnlwdCc7XHJcblxyXG5jb25zdCBwcmlzbWEgPSBuZXcgUHJpc21hQ2xpZW50KCk7XHJcblxyXG5leHBvcnQgY29uc3QgYXV0aE9wdGlvbnM6IE5leHRBdXRoT3B0aW9ucyA9IHtcclxuICBzZXNzaW9uOiB7IHN0cmF0ZWd5OiAnand0JyB9LFxyXG4gIHByb3ZpZGVyczogW1xyXG4gICAgQ3JlZGVudGlhbHNQcm92aWRlcih7XHJcbiAgICAgIG5hbWU6ICdDcmVkZW50aWFscycsXHJcbiAgICAgIGNyZWRlbnRpYWxzOiB7XHJcbiAgICAgICAgZW1haWw6IHsgbGFiZWw6ICdFbWFpbCcsIHR5cGU6ICdlbWFpbCcsIHBsYWNlaG9sZGVyOiAnYWRtaW5AZXhhbXBsZS5jb20nIH0sXHJcbiAgICAgICAgcGFzc3dvcmQ6IHsgbGFiZWw6ICdQYXNzd29yZCcsIHR5cGU6ICdwYXNzd29yZCcgfSxcclxuICAgICAgfSxcclxuICAgICAgYXN5bmMgYXV0aG9yaXplKGNyZWRlbnRpYWxzKSB7XHJcbiAgICAgICAgaWYgKCFjcmVkZW50aWFscz8uZW1haWwgfHwgIWNyZWRlbnRpYWxzPy5wYXNzd29yZCkgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBwcmlzbWEuYWRtaW5Vc2VyLmZpbmRVbmlxdWUoe1xyXG4gICAgICAgICAgd2hlcmU6IHsgZW1haWw6IGNyZWRlbnRpYWxzLmVtYWlsIH0sXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYgKCF1c2VyKSByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgICAgY29uc3Qgb2sgPSBhd2FpdCBiY3J5cHQuY29tcGFyZShjcmVkZW50aWFscy5wYXNzd29yZCwgdXNlci5wYXNzd29yZCk7XHJcbiAgICAgICAgaWYgKCFvaykgcmV0dXJuIG51bGw7XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBpZDogdXNlci5pZC50b1N0cmluZygpLFxyXG4gICAgICAgICAgZW1haWw6IHVzZXIuZW1haWwsXHJcbiAgICAgICAgICBuYW1lOiB1c2VyLm5hbWUgfHwgdW5kZWZpbmVkLFxyXG4gICAgICAgICAgcm9sZTogdXNlci5yb2xlLFxyXG4gICAgICAgIH0gYXMgYW55O1xyXG4gICAgICB9LFxyXG4gICAgfSksXHJcbiAgXSxcclxuICBjYWxsYmFja3M6IHtcclxuICAgIGFzeW5jIGp3dCh7IHRva2VuLCB1c2VyIH0pIHtcclxuICAgICAgaWYgKHVzZXIpIHtcclxuICAgICAgICB0b2tlbi5yb2xlID0gKHVzZXIgYXMgYW55KS5yb2xlID8/ICdhZG1pbic7XHJcbiAgICAgICAgdG9rZW4uaWQgPSAodXNlciBhcyBhbnkpLmlkID8/IHRva2VuLmlkO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiB0b2tlbjtcclxuICAgIH0sXHJcbiAgICBhc3luYyBzZXNzaW9uKHsgc2Vzc2lvbiwgdG9rZW4gfSkge1xyXG4gICAgICAoc2Vzc2lvbiBhcyBhbnkpLnVzZXIgPSBzZXNzaW9uLnVzZXIgPz8ge307XHJcbiAgICAgIChzZXNzaW9uIGFzIGFueSkudXNlci5yb2xlID0gdG9rZW4ucm9sZTtcclxuICAgICAgKHNlc3Npb24gYXMgYW55KS51c2VyLmlkID0gdG9rZW4uaWQ7XHJcbiAgICAgIHJldHVybiBzZXNzaW9uO1xyXG4gICAgfSxcclxuICB9LFxyXG4gIHNlY3JldDogcHJvY2Vzcy5lbnYuTkVYVEFVVEhfU0VDUkVULFxyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgTmV4dEF1dGgoYXV0aE9wdGlvbnMpO1xyXG5cclxuIl0sIm5hbWVzIjpbIk5leHRBdXRoIiwiQ3JlZGVudGlhbHNQcm92aWRlciIsIlByaXNtYUNsaWVudCIsImJjcnlwdCIsInByaXNtYSIsImF1dGhPcHRpb25zIiwic2Vzc2lvbiIsInN0cmF0ZWd5IiwicHJvdmlkZXJzIiwibmFtZSIsImNyZWRlbnRpYWxzIiwiZW1haWwiLCJsYWJlbCIsInR5cGUiLCJwbGFjZWhvbGRlciIsInBhc3N3b3JkIiwiYXV0aG9yaXplIiwidXNlciIsImFkbWluVXNlciIsImZpbmRVbmlxdWUiLCJ3aGVyZSIsIm9rIiwiY29tcGFyZSIsImlkIiwidG9TdHJpbmciLCJ1bmRlZmluZWQiLCJyb2xlIiwiY2FsbGJhY2tzIiwiand0IiwidG9rZW4iLCJzZWNyZXQiLCJwcm9jZXNzIiwiZW52IiwiTkVYVEFVVEhfU0VDUkVUIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./pages/api/auth/[...nextauth].ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fadmin%2Fuploads&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cadmin%5Cuploads.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();